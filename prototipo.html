<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartilla Verde - Antecedentes y Promoción de la Salud</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            color: #2c3e50;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
        }

        .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .info-cards-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .patient-summary,
        .doctor-summary {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .patient-summary {
            border-left: 6px solid #27ae60;
        }

        .doctor-summary {
            border-left: 6px solid #3498db;
        }

        .patient-avatar,
        .doctor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
        }

        .patient-avatar {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .doctor-avatar {
            background: linear-gradient(135deg, #3498db, #5dade2);
        }

        .patient-info h2,
        .doctor-info h2 {
            color: #27ae60;
            margin-bottom: 5px;
            font-size: 18px;
        }

        .patient-meta,
        .doctor-meta {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 3px;
        }

        .tabs-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab-btn {
            min-width: 200px;
            padding: 20px 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #6c757d;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: #27ae60;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #e9ecef;
            color: #27ae60;
        }

        .tab-content {
            padding: 40px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 40px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            background: #f8f9fa;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #27ae60;
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .section-info h3 {
            font-size: 22px;
            color: #27ae60;
            margin-bottom: 5px;
        }

        .section-description {
            color: #7f8c8d;
            font-size: 14px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-input {
            width: 20px;
            height: 20px;
            accent-color: #27ae60;
            cursor: pointer;
        }

        .radio-label {
            font-size: 14px;
            color: #495057;
            cursor: pointer;
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .input-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .input-addon {
            background: #e9ecef;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            color: #6c757d;
            font-weight: 500;
        }

        .tamizajes-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .tamiz-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .tamiz-item.selected {
            border-color: #27ae60;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.1);
        }

        .tamiz-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .tamiz-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #27ae60;
        }

        .tamiz-label {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            flex: 1;
        }

        .tamiz-details {
            display: none;
            padding: 20px;
            background: #fdfdfd;
        }

        .tamiz-details.show {
            display: block;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            border-color: #27ae60;
            background: #f0f8f0;
        }

        .checkbox-item.checked {
            border-color: #27ae60;
            background: #d4edda;
        }

        .checkbox-input {
            width: 18px;
            height: 18px;
            accent-color: #27ae60;
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 14px;
            color: #495057;
            cursor: pointer;
            flex: 1;
        }

        .promocion-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .promocion-item:hover {
            border-color: #27ae60;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.1);
        }

        .promocion-item.selected {
            border-color: #27ae60;
            background: #f0f8f0;
        }

        .promocion-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .promocion-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #27ae60;
            cursor: pointer;
        }

        .promocion-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
            cursor: pointer;
        }

        .promocion-date-group {
            display: none;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }

        .promocion-date-group.show {
            display: block;
        }

        .date-input {
            width: 100%;
            max-width: 200px;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .date-input:focus {
            outline: none;
            border-color: #27ae60;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .development-form {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .date-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .date-section h4 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .date-input-large {
            width: 100%;
            max-width: 300px;
            padding: 15px 20px;
            border: 3px solid #27ae60;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            background: white;
            color: #2c3e50;
            font-weight: 600;
        }

        .age-selector-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .age-selector-section h4 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .age-select {
            width: 100%;
            max-width: 300px;
            padding: 12px 20px;
            border: 3px solid #27ae60;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            color: #2c3e50;
            font-weight: 600;
            cursor: pointer;
        }

        .age-questions-section {
            margin-top: 30px;
        }

        .age-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .age-title h3 {
            color: #27ae60;
            font-size: 24px;
            border-bottom: 3px solid #27ae60;
            padding-bottom: 10px;
            display: inline-block;
        }

        .no-age-selected {
            text-align: center;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-top: 30px;
        }

        .empty-state h4 {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .empty-state p {
            color: #adb5bd;
            font-size: 16px;
        }

        .development-category {
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .category-header {
            padding: 15px 25px;
            font-weight: bold;
            color: white;
            text-align: center;
        }

        .category-header h4 {
            margin: 0;
            font-size: 18px;
            letter-spacing: 1px;
        }

        .motor-category .category-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .motor-category {
            border: 3px solid #27ae60;
        }

        .lenguaje-category .category-header {
            background: linear-gradient(135deg, #e91e63, #f06292);
        }

        .lenguaje-category {
            border: 3px solid #e91e63;
        }

        .social-category .category-header {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
        }

        .social-category {
            border: 3px solid #f39c12;
        }

        .conocimiento-category .category-header {
            background: linear-gradient(135deg, #9b59b6, #bb73e0);
        }

        .conocimiento-category {
            border: 3px solid #9b59b6;
        }

        .alarma-category .category-header {
            background: linear-gradient(135deg, #e74c3c, #ec7063);
        }

        .alarma-category {
            border: 3px solid #e74c3c;
        }

        .question-item {
            background: white;
            padding: 20px 25px;
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .question-item:hover {
            background: #f8f9fa;
        }

        .question-text {
            font-size: 16px;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .radio-item.selected {
            background: #d4edda;
            border-color: #27ae60;
            border-radius: 25px;
            padding: 8px 16px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: #27ae60;
            color: white;
        }

        .btn-primary:hover {
            background: #219a52;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: #27ae60;
            border: 2px solid #27ae60;
        }

        .btn-outline:hover {
            background: #27ae60;
            color: white;
        }

        .historial-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        /* CSS para historial compacto con scroll a la derecha */

        .historial-item {
            background: white;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.1);
            transition: all 0.3s ease;
            margin-bottom: 10px;
            min-height: 80px;
        }

        .historial-item:hover {
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
            transform: translateY(-2px);
        }

        .historial-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .historial-cartilla {
            background: #e8f5e8;
            color: #27ae60;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            width: fit-content;
        }

        .actividad-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .actividad-titulo {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 250px;
            flex-shrink: 0;
        }

        .historial-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
            line-height: 1.3;
        }

        .fechas-contador {
            background: #27ae60;
            color: white;
            font-size: 11px;
            font-weight: bold;
            padding: 3px 7px;
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            text-align: center;
            line-height: 14px;
            flex-shrink: 0;
        }

        .fechas-scroll-compacto {
            max-height: 60px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding-right: 5px;
            flex: 1;
            max-width: 200px;
        }

        /* Personalizar scrollbar compacto */
        .fechas-scroll-compacto::-webkit-scrollbar {
            width: 4px;
        }

        .fechas-scroll-compacto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .fechas-scroll-compacto::-webkit-scrollbar-thumb {
            background: #27ae60;
            border-radius: 10px;
        }

        .fechas-scroll-compacto::-webkit-scrollbar-thumb:hover {
            background: #219a52;
        }

        .fecha-item-compacto {
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            font-size: 12px;
            color: #495057;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            min-height: 18px;
            white-space: nowrap;
        }

        .fecha-item-compacto:hover {
            border-color: #27ae60;
            background: #f0f8f0;
        }

        .btn-delete-fecha-compacto {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-left: 6px;
            flex-shrink: 0;
        }

        .btn-delete-fecha-compacto:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .historial-actions {
            margin-left: 15px;
            flex-shrink: 0;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-delete:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .historial-item {
                flex-direction: column;
                align-items: stretch;
                padding: 12px;
                min-height: auto;
            }

            .actividad-info {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .actividad-titulo {
                min-width: auto;
                justify-content: space-between;
            }

            .fechas-scroll-compacto {
                max-width: 100%;
                max-height: 50px;
            }

            .historial-actions {
                margin-left: 0;
                margin-top: 10px;
                text-align: center;
            }

            .historial-title {
                font-size: 13px;
            }
        }

        /* Animación para nuevas fechas compactas */
        @keyframes nuevaFechaCompacta {
            from {
                opacity: 0;
                transform: translateX(-5px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .fecha-item-compacto {
            animation: nuevaFechaCompacta 0.3s ease-out;
        }

        .historial-cartilla {
            background: #e8f5e8;
            color: #27ae60;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            display: inline-block;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .btn-link {
            background: #3498db;
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            border: none;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-link:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            color: white;
            text-decoration: none;
        }

        .btn-link:active {
            transform: translateY(0);
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: popupSlideIn 0.3s ease-out;
        }



        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #27ae60;
            padding-bottom: 15px;
        }

        .popup-title {
            color: #27ae60;
            font-size: 22px;
            font-weight: bold;
            margin: 0;
        }

        .popup-close {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .popup-close:hover {
            background: #c0392b;
        }

        .popup-body {
            color: #2c3e50;
            line-height: 1.6;
        }

        .btn-info {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .btn-info:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .contenido-formato {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
        }

        .mensaje-principal {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            border-left: 5px solid #27ae60;
        }

        .icono-grande {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .titulo-mensaje {
            color: #27ae60;
            margin: 10px 0;
            font-size: 22px;
            font-weight: bold;
        }

        .contenido-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .texto-destacado {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f8f0;
            border-radius: 10px;
        }

        .punto-clave {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .icono-punto {
            font-size: 24px;
            margin-right: 15px;
            margin-top: 2px;
        }

        .icono-corazon {
            font-size: 24px;
            margin-right: 10px;
        }

        .introduccion {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #2196f3;
        }

        .actividades-container {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .actividad-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #9c27b0;
        }

        .actividad-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .icono-actividad {
            font-size: 24px;
            margin-right: 12px;
        }

        .actividad-header h5 {
            color: #9c27b0;
            margin: 0;
            font-size: 16px;
            font-weight: bold;
        }

        .highlight {
            background: #fff3e0;
            padding: 2px 6px;
            border-radius: 4px;
            color: #f57c00;
            font-weight: 600;
        }

        .introduccion-importante {
            margin-bottom: 25px;
        }

        .alerta-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: flex-start;
        }

        .icono-alerta {
            font-size: 24px;
            margin-right: 15px;
            margin-top: 2px;
        }

        .pregunta-central {
            text-align: center;
            margin: 30px 0;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #5dade2);
            color: white;
            border-radius: 10px;
        }

        .pregunta-central h5 {
            margin: 0;
            font-size: 20px;
        }

        .estrategias-container {
            display: grid;
            gap: 20px;
            margin: 25px 0;
        }

        .estrategia-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #e74c3c;
        }

        .estrategia-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .icono-estrategia {
            font-size: 24px;
            margin-right: 12px;
        }

        .estrategia-header h6 {
            color: #e74c3c;
            margin: 0;
            font-size: 16px;
            font-weight: bold;
        }

        .pregunta-ejemplo {
            font-style: italic;
            color: #3498db;
            font-weight: 600;
        }

        .conclusion {
            margin-top: 30px;
        }

        .mensaje-motivacional {
            background: linear-gradient(135deg, #f39c12, #f1c40f);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icono-estrella {
            font-size: 32px;
            margin-right: 15px;
        }

        .mensaje-motivacional p {
            margin: 0;
            font-size: 16px;
        }

        .promocion-header-with-date {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            cursor: pointer;
        }

        .promocion-check-title {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .promocion-date-inline {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .date-label {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            white-space: nowrap;
        }

        .date-input-header {
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            background: white;
            width: 150px;
            transition: all 0.3s ease;
        }

        .date-input-header:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 2px rgba(39, 174, 96, 0.1);
        }

        /* Modificar el item de promoción para quitar padding duplicado */
        .promocion-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .promocion-item:hover {
            border-color: #27ae60;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.1);
        }

        .promocion-item.selected {
            border-color: #27ae60;
            background: #f0f8f0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .promocion-header-with-date {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .promocion-check-title {
                justify-content: flex-start;
            }

            .promocion-date-inline {
                justify-content: flex-end;
            }

            .date-input-header {
                width: 140px;
            }
        }

        @media (max-width: 768px) {
            .tabs-nav {
                flex-direction: column;
            }

            .tab-btn {
                min-width: auto;
                flex: 1;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .input-group {
                flex-direction: column;
                gap: 10px;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .info-cards-container {
                grid-template-columns: 1fr;
            }
        }

        .herramientas-container {
            margin-top: 30px;
            text-align: center;
            padding: 20px 0;
        }

        .btn-herramientas {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 15px 30px;
            background: white;
            color: #2c3e50;
            text-decoration: none;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .btn-herramientas:hover {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
            text-decoration: none;
        }

        .btn-herramientas:active {
            transform: translateY(0);
        }

        .herramientas-icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .btn-herramientas:hover .herramientas-icon {
            transform: scale(1.1) rotate(10deg);
        }

        .herramientas-arrow {
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .btn-herramientas:hover .herramientas-arrow {
            transform: translateX(5px);
        }

        /* Efecto de onda al hacer hover */
        .btn-herramientas::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            z-index: 0;
        }

        .btn-herramientas:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-herramientas span {
            position: relative;
            z-index: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .btn-herramientas {
                padding: 12px 20px;
                font-size: 14px;
                gap: 8px;
            }

            .herramientas-icon {
                font-size: 18px;
            }

            .herramientas-arrow {
                font-size: 16px;
            }
        }

        .semaforo-container {
            margin-top: 40px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #3498db;
        }

        .semaforo-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .semaforo-header h4 {
            color: #3498db;
            font-size: 24px;
            margin: 0;
        }

        .contadores-resultados {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .contador-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .contador-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .contador-icon {
            font-size: 32px;
        }

        .contador-info {
            display: flex;
            flex-direction: column;
        }

        .contador-numero {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }

        .contador-label {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
        }

        .semaforo-resultado {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .semaforo-luz {
            padding: 20px;
            border-radius: 12px;
            border: 3px solid transparent;
            opacity: 0.3;
            transition: all 0.5s ease;
            transform: scale(0.95);
        }

        .semaforo-luz.activa {
            opacity: 1;
            transform: scale(1);
            animation: pulso 2s infinite ease-in-out;
        }

        .semaforo-luz.verde {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-color: #28a745;
        }

        .semaforo-luz.verde.activa {
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        .semaforo-luz.amarillo {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-color: #ffc107;
        }

        .semaforo-luz.amarillo.activa {
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
        }

        .semaforo-luz.rojo {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-color: #dc3545;
        }

        .semaforo-luz.rojo.activa {
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
        }

        .luz-contenido {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .luz-icon {
            font-size: 48px;
        }

        .luz-texto h5 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .luz-texto p {
            margin: 0;
            color: #6c757d;
            font-size: 14px;
            line-height: 1.4;
        }

        /* CSS para historial con múltiples fechas */

        .historial-item {
            background: white;
            border: 2px solid #27ae60;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.1);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .historial-item:hover {
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
            transform: translateY(-2px);
        }

        .historial-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .historial-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
            margin: 0;
        }

        .historial-cartilla {
            background: #e8f5e8;
            color: #27ae60;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            width: fit-content;
        }

        .fechas-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #dee2e6;
        }

        .fechas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #dee2e6;
        }

        .fechas-label {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .fechas-contador {
            background: #27ae60;
            color: white;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 50%;
            min-width: 24px;
            text-align: center;
            line-height: 1;
        }

        .fechas-scroll {
            max-height: 90px;
            /* Altura fija para exactamente 3 filas */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding-right: 5px;
        }

        /* Personalizar scrollbar */
        .fechas-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .fechas-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .fechas-scroll::-webkit-scrollbar-thumb {
            background: #27ae60;
            border-radius: 10px;
        }

        .fechas-scroll::-webkit-scrollbar-thumb:hover {
            background: #219a52;
        }

        .fecha-item {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-size: 13px;
            color: #495057;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            min-height: 24px;
            /* Altura fija para cada fila */
        }

        .fecha-item:hover {
            border-color: #27ae60;
            background: #f0f8f0;
        }

        .historial-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 15px;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-delete:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .historial-item {
                flex-direction: column;
                align-items: stretch;
            }

            .historial-actions {
                flex-direction: row;
                justify-content: center;
                margin-left: 0;
                margin-top: 15px;
            }

            .fechas-scroll {
                max-height: 75px;
                /* Ajustar altura en móviles */
            }

            .fecha-item {
                font-size: 12px;
                padding: 6px 10px;
            }
        }

        /* Animación para nuevas fechas */
        @keyframes nuevaFecha {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .fecha-item {
            animation: nuevaFecha 0.3s ease-out;
        }

        @keyframes pulso {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .contadores-resultados {
                grid-template-columns: 1fr;
            }

            .luz-contenido {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .luz-icon {
                font-size: 40px;
            }

            .luz-texto h5 {
                font-size: 16px;
            }
        }

        /* Estilos específicos para vacunación */
        .vacunas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .vacuna-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .vacuna-card:hover {
            border-color: #3498db;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
        }

        .vacuna-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .vacuna-header h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: bold;
        }

        .enfermedad-badge {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .prevencion-badge {
            background: rgb(158, 151, 253);
            color: white;
            padding: 4px 15px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .dosis-container {
            padding: 15px 20px;
        }

        .dosis-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f1f1;
            transition: all 0.3s ease;
        }

        .dosis-item:last-child {
            border-bottom: none;
        }

        .dosis-item:hover {
            background: #f8f9fa;
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .dosis-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dosis-numero {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }

        .edad-oportuna {
            color: #7f8c8d;
            font-size: 12px;
            font-style: italic;
        }

        .fecha-aplicacion {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fecha-input {
            padding: 6px 10px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            width: 140px;
            transition: all 0.3s ease;
        }

        .fecha-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }

        .fecha-input.completada {
            background: #d4edda;
            border-color: #28a745;
        }

        .btn-detalles {
            background: #84c0f5;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-detalles:hover {
            background: #5a6268;
            transform: scale(1.1);
        }

        .btn-detalles.completado {
            background: #28a745;
        }

        .btn-detalles.completado:hover {
            background: #218838;
        }

        .otras-vacunas-form {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .vacuna-agregada {
            background: #f8f9fa;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vacuna-agregada-info {
            flex: 1;
        }

        .vacuna-agregada-titulo {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .vacuna-agregada-detalles {
            font-size: 14px;
            color: #6c757d;
        }

        .btn-eliminar-vacuna {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-eliminar-vacuna:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        /* Estilos para molestias en el modal */
        #molestias_section .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        #molestias_section .checkbox-item {
            padding: 8px 12px;
            font-size: 14px;
        }

        /* Indicador de vacuna completada */
        .dosis-item.completada {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .dosis-item.completada .dosis-numero {
            color: #155724;
        }

        .dosis-item.completada .edad-oportuna {
            color: #155724;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .vacunas-grid {
                grid-template-columns: 1fr;
            }

            .dosis-item {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .fecha-aplicacion {
                justify-content: space-between;
            }

            .fecha-input {
                width: auto;
                flex: 1;
            }
        }

        .esquema-especial {
            border: 2px solid #f39c12;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .esquema-especial h5 {
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        /* Estilos específicos para prevención de enfermedades si los necesitas */
        #prevencion .form-section:nth-child(5) .section-header {
            border-bottom: 2px solid #e91e63;
        }

        #prevencion .form-section:nth-child(5) .section-info h3 {
            color: #e91e63;
        }

        .agudeza-visual-container {
            width: 100%;
        }

        .resultado-select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
            background: white;
        }

        .resultado-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn-add-registro {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .btn-add-registro:hover {
            background: #2980b9;
        }

        .registro-agudeza {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        /* Estilos específicos para combos/selects */
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
            background-color: #fafbfc;
            color: #333;
            appearance: none;
            /* Remueve el estilo por defecto del navegador */
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 45px;
            /* Espacio para la flecha */
        }

        /* Estados de focus para combos */
        select:focus {
            outline: none;
            border-color: #3498db;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* Estado disabled para combos */
        select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Hover effect para combos */
        select:hover:not(:disabled) {
            border-color: #3498db;
            background-color: white;
        }

        /* Estilos para las opciones del select */
        select option {
            padding: 10px;
            background-color: white;
            color: #333;
            font-size: 14px;
        }

        select option:hover {
            background-color: #f8f9fa;
        }

        select option:checked {
            background-color: #3498db;
            color: white;
        }

        /* ESTILOS CSS PARA HISTORIAL DE VACUNACIÓN CON DETALLES */
        .fecha-item-compacto.con-detalles-disponibles {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: #2196f3;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .fecha-item-compacto.con-detalles-disponibles:hover {
            background: linear-gradient(135deg, #bbdefb, #90caf9);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .fecha-item-compacto .icono-detalles {
            font-size: 14px;
            margin-left: 6px;
            opacity: 0.8;
        }

        .fecha-item-compacto.con-detalles-disponibles .icono-detalles {
            animation: pulsoIcono 2s infinite ease-in-out;
        }

        @keyframes pulsoIcono {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        /* Estilos para el modal de detalles */
        .detalles-vacuna-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .detalle-header h4 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .detalles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .detalle-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            transition: all 0.3s ease;
        }

        .detalle-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .detalle-item strong {
            display: block;
            color: #495057;
            font-size: 13px;
            margin-bottom: 6px;
        }

        .detalle-valor {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }

        /* Estilos específicos para valores */
        .rescate-si,
        .reaccion-si {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .rescate-no,
        .reaccion-no {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        /* Sección de molestias */
        .molestias-section {
            animation: slideInMolestias 0.3s ease-out;
        }

        @keyframes slideInMolestias {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .molestias-lista {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .molestia-badge {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid #f5c6cb;
            transition: all 0.3s ease;
        }

        .molestia-badge:hover {
            background: #f1b0b7;
            transform: scale(1.05);
        }

        /* Mejorar el indicador visual en el historial */
        .fecha-item-compacto .fecha-texto {
            display: inline-block;
            flex: 1;
        }

        /* Tooltip mejorado */
        .fecha-item-compacto.con-detalles-disponibles::after {
            content: "Clic para ver detalles";
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .fecha-item-compacto.con-detalles-disponibles:hover::after {
            opacity: 1;
        }

        /* Responsive para el modal de detalles */
        @media (max-width: 768px) {
            .detalles-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .popup-content {
                max-width: 95vw;
                margin: 10px;
            }

            .detalle-item {
                padding: 10px;
            }

            .molestias-lista {
                flex-direction: column;
                gap: 5px;
            }

            .molestia-badge {
                text-align: center;
            }
        }

        /* Animación para el modal */
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        #modalDetallesHistorial .popup-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        /* Mejorar la apariencia del botón de cerrar */
        #modalDetallesHistorial .popup-close {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #modalDetallesHistorial .popup-close:hover {
            background: #c0392b;
            transform: rotate(90deg);
        }

        /* Indicador visual mejorado para fechas con detalles */
        .fecha-item-compacto.con-detalles-disponibles {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border: 2px solid #28a745;
            position: relative;
        }

        .fecha-item-compacto.con-detalles-disponibles::before {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: #007bff;
            border-radius: 50%;
            border: 2px solid white;
        }
    </style>

</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>🧒</span>
                <span>Cartilla Verde - Captura de Datos</span>
            </div>
            <div class="breadcrumb">
                📋 Sistema de Salud > Cartilla Verde > Captura
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Resumen del Paciente -->
        <div class="info-cards-container">
            <!-- Resumen del Paciente -->
            <div class="patient-summary">
                <div class="patient-avatar">👶</div>
                <div class="patient-info">
                    <h2>Ana Sofía Martínez López</h2>
                    <div class="patient-meta">5 años, 4 meses</div>
                    <p class="patient-meta">CV-2024-001</p>
                    <p class="patient-meta">Fecha de nacimiento: 15/03/2020</p>
                </div>
            </div>

            <!-- Información del Doctor -->
            <div class="doctor-summary">
                <div class="doctor-avatar">👨‍⚕️</div>
                <div class="doctor-info">
                    <h2>Dr. Luis Antonio Pérez González</h2>
                    <div class="doctor-meta">Médico Familiar</div>
                    <p class="doctor-meta">UMF 11 Peralvillo</p>
                    <p class="doctor-meta">Turno: Vespertino • Consultorio: 5</p>
                </div>
            </div>
        </div>

        <!-- Sistema de Pestañas -->
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="antecedentes">
                    <span>📋</span>
                    <span>Antecedentes</span>
                </button>
                <button class="tab-btn" data-tab="promocion">
                    <span>🌟</span>
                    <span>Promoción de la Salud</span>
                </button>
                <button class="tab-btn" data-tab="desarrollo">
                    <span>👶</span>
                    <span>Desarrollo Infantil</span>
                </button>
                <button class="tab-btn" data-tab="nutricion">
                    <span>🍎</span>
                    <span>Nutrición</span>
                </button>
                <button class="tab-btn" data-tab="vacunacion">
                    <span>💉</span>
                    <span>Vacunación</span>
                </button>

                <button class="tab-btn" data-tab="prevencion">
                    <span>🛡️</span>
                    <span>Prevención</span>
                </button>

                <button class="tab-btn" data-tab="deteccion">
                    <span>🔎</span>
                    <span>Detección</span>
                </button>

                <button class="tab-btn" data-tab="derivacion">
                    <span>📄</span>
                    <span>Derivaciones</span>
                </button>

            </div>

            <!-- TAB: Antecedentes -->
            <div class="tab-content active" id="antecedentes">
                <form id="antecedentesForm">
                    <!-- Sección: Datos del Parto y Nacimiento -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">👶</div>
                            <div class="section-info">
                                <h3>Datos del Parto y Nacimiento</h3>
                                <p class="section-description">Información sobre el parto y medidas antropométricas al
                                    nacer</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <!-- Tipo de Parto -->
                            <div class="form-group">
                                <label class="form-label">Tipo de Parto <span class="required">*</span></label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="parto" name="tipoParto" value="parto"
                                            class="radio-input" required>
                                        <label for="parto" class="radio-label">Parto</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="cesarea" name="tipoParto" value="cesarea"
                                            class="radio-input" required>
                                        <label for="cesarea" class="radio-label">Cesárea</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Peso al Nacer -->
                            <div class="form-group">
                                <label for="pesoNacer" class="form-label">Peso al Nacer <span
                                        class="required">*</span></label>
                                <div class="input-group">
                                    <input type="number" id="pesoNacer" name="pesoNacer" class="form-input"
                                        placeholder="Ej. 3200" min="500" max="6000" step="1" required>
                                    <div class="input-addon">gramos</div>
                                </div>
                            </div>

                            <!-- Talla al Nacer -->
                            <div class="form-group">
                                <label for="tallaNacer" class="form-label">Talla al Nacer <span
                                        class="required">*</span></label>
                                <div class="input-group">
                                    <input type="number" id="tallaNacer" name="tallaNacer" class="form-input"
                                        placeholder="Ej. 50" min="30" max="70" step="0.1" required>
                                    <div class="input-addon">cm</div>
                                </div>
                            </div>

                            <!-- Perímetro Cefálico -->
                            <div class="form-group">
                                <label for="perimetroCefalico" class="form-label">Perímetro Cefálico <span
                                        class="required">*</span></label>
                                <div class="input-group">
                                    <input type="number" id="perimetroCefalico" name="perimetroCefalico"
                                        class="form-input" placeholder="Ej. 35" min="25" max="45" step="0.1" required>
                                    <div class="input-addon">cm</div>
                                </div>
                            </div>

                            <!-- APGAR -->
                            <div class="form-group">
                                <label class="form-label">APGAR <span class="required">*</span></label>
                                <div class="input-group">
                                    <div class="form-group">
                                        <label for="apgar1" class="form-label">1 minuto</label>
                                        <input type="number" id="apgar1" name="apgar1" class="form-input"
                                            placeholder="0-10" min="0" max="10" step="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="apgar5" class="form-label">5 minutos</label>
                                        <input type="number" id="apgar5" name="apgar5" class="form-input"
                                            placeholder="0-10" min="0" max="10" step="1" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Profilaxis Oftálmica -->
                            <div class="promocion-item" style="margin-bottom: 20px;">
                                <div class="promocion-header-with-date" style="flex-wrap: wrap; gap: 15px;">
                                    <div class="promocion-check-title" style="flex: 1; min-width: 200px;">
                                        <input type="checkbox" id="profilaxisOftalmica" name="antecedentes[]"
                                            value="profilaxis_oftalmica" class="promocion-checkbox">
                                        <label for="profilaxisOftalmica" class="promocion-title">👁️ Profilaxis
                                            Oftálmica</label>
                                    </div>
                                    <div class="promocion-date-inline">
                                        <label for="fecha_profilaxis_oftalmica" class="date-label">Fecha:</label>
                                        <input type="date" id="fecha_profilaxis_oftalmica"
                                            name="fecha_profilaxis_oftalmica" class="date-input-header">
                                    </div>
                                </div>
                            </div>

                            <!-- Vitamina K -->
                            <div class="promocion-item" style="margin-bottom: 20px;">
                                <div class="promocion-header-with-date" style="flex-wrap: wrap; gap: 15px">
                                    <div class="promocion-check-title">
                                        <input type="checkbox" id="vitaminaK" name="antecedentes[]" value="vitamina_k"
                                            class="promocion-checkbox">
                                        <label for="vitaminaK" class="promocion-title">💉 Vitamina K</label>
                                    </div>
                                    <div class="promocion-date-inline">
                                        <label for="fecha_vitamina_k" class="date-label">Fecha:</label>
                                        <input type="date" id="fecha_vitamina_k" name="fecha_vitamina_k"
                                            class="date-input-header">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Complicaciones -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">⚠️</div>
                            <div class="section-info">
                                <h3>Complicaciones</h3>
                                <p class="section-description">Información sobre complicaciones durante el embarazo y
                                    nacimiento</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <!-- Complicaciones en el Embarazo -->
                            <div class="form-group">
                                <label for="complicacionesEmbarazo" class="form-label">Complicaciones en el
                                    embarazo</label>
                                <select id="complicacionesEmbarazo" name="complicacionesEmbarazo" class="form-select">
                                    <option value="">Seleccione...</option>
                                    <option value="aborto_espontaneo_no_especificado">Aborto espontáneo no especificado
                                    </option>
                                    <option value="anomalias_uterinas">Anomalías uterinas complicando el embarazo
                                    </option>
                                    <option value="crecimiento_fetal_retardado">Crecimiento fetal retardado</option>
                                    <option value="diabetes_gestacional">Diabetes gestacional</option>
                                    <option value="embarazo_ectopico_tubarico">Embarazo ectópico tubárico</option>
                                    <option value="embolia_liquido_amniotico">Embolia por líquido amniótico</option>
                                    <option value="hemorragia_primer_trimestre">Hemorragia del primer trimestre</option>
                                    <option value="hiperemesis_gravidica_leve">Hiperemesis gravídica leve</option>
                                    <option value="hipertension_gestacional">Hipertensión gestacional</option>
                                    <option value="huevo_muerto_retenido">Huevo muerto retenido</option>
                                    <option value="infeccion_tracto_urinario">Infección del tracto urinario</option>
                                    <option value="itu_segundo_trimestre">ITU segundo trimestre</option>
                                    <option value="otras_complicaciones_obstetricas">Otras complicaciones obstétricas
                                        especificadas</option>
                                    <option value="parto_pretermino_espontaneo">Parto pretérmino espontáneo</option>
                                    <option value="placenta_previa_sin_hemorragia">Placenta previa sin hemorragia
                                    </option>
                                    <option value="polihidramnios">Polihidramnios</option>
                                    <option value="preeclampsia_leve_moderada">Preeclampsia leve a moderada</option>
                                    <option value="preeclampsia_severa">Preeclampsia severa</option>
                                    <option value="retraso_trabajo_parto">Retraso del trabajo de parto</option>
                                    <option value="rotura_prematura_membranas">Rotura prematura de membranas</option>
                                    <option value="sin_complicaciones">Sin complicaciones</option>
                                </select>
                            </div>

                            <!-- Complicaciones al Nacimiento -->
                            <div class="form-group">
                                <label for="complicacionesNacimiento" class="form-label">Complicaciones en el
                                    nacimiento</label>
                                <select id="complicacionesNacimiento" name="complicacionesNacimiento"
                                    class="form-select">
                                    <option value="">Seleccione...</option>
                                    <option value="apnea_recien_nacido">Apnea del recién nacido</option>
                                    <option value="asfixia_al_nacer">Asfixia al nacer</option>
                                    <option value="aspiracion_neonatal">Aspiración neonatal</option>
                                    <option value="bajo_peso_edad_gestacional">Bajo peso para edad gestacional</option>
                                    <option value="hipoxia_intrauterina">Hipoxia intrauterina</option>
                                    <option value="ictericia_neonatal_inespecifica">Ictericia neonatal inespecífica
                                    </option>
                                    <option value="insuficiencia_cardiaca_neonatal">Insuficiencia cardíaca neonatal
                                    </option>
                                    <option value="macrosomia_fetal">Macrosomía fetal</option>
                                    <option value="sepsis_bacteriana_rn">Sepsis bacteriana del RN</option>
                                    <option value="sindrome_dificultad_respiratoria">Síndrome de dificultad respiratoria
                                    </option>
                                    <option value="sin_complicaciones">Sin complicaciones</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Tamizajes -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">🔍</div>
                            <div class="section-info">
                                <h3>Tamizajes Neonatales</h3>
                                <p class="section-description">Indique qué tamizajes se realizaron al recién nacido</p>
                            </div>
                        </div>

                        <div class="alert alert-warning">
                            <span>⚠️</span>
                            <div><strong>Importante:</strong> Los tamizajes neonatales son fundamentales para la
                                detección temprana de enfermedades.</div>
                        </div>

                        <div class="tamizajes-grid">
                            <!-- Tamiz Metabólico -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="tamiz_metabolico" name="tamizajes[]"
                                        value="tamiz_metabolico" class="tamiz-checkbox">
                                    <label for="tamiz_metabolico" class="tamiz-label">🧪 Tamiz metabólico
                                        neonatal</label>
                                </div>
                                <div class="tamiz-details" id="details_tamiz_metabolico">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_tamiz_metabolico" class="form-label">Fecha de
                                                realización:</label>
                                            <input type="date" id="fecha_tamiz_metabolico" name="fecha_tamiz_metabolico"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_tamiz_metabolico"
                                                class="form-label">Observaciones/Resultados:</label>
                                            <textarea id="observaciones_tamiz_metabolico"
                                                name="observaciones_tamiz_metabolico" class="form-input" rows="2"
                                                placeholder="Escriba aquí observaciones o resultados..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tamiz Auditivo -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="tamiz_auditivo" name="tamizajes[]" value="tamiz_auditivo"
                                        class="tamiz-checkbox">
                                    <label for="tamiz_auditivo" class="tamiz-label">👂 Tamiz auditivo</label>
                                </div>
                                <div class="tamiz-details" id="details_tamiz_auditivo">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_tamiz_auditivo" class="form-label">Fecha de
                                                realización:</label>
                                            <input type="date" id="fecha_tamiz_auditivo" name="fecha_tamiz_auditivo"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_tamiz_auditivo"
                                                class="form-label">Observaciones/Resultados:</label>
                                            <textarea id="observaciones_tamiz_auditivo"
                                                name="observaciones_tamiz_auditivo" class="form-input" rows="2"
                                                placeholder="Escriba aquí observaciones o resultados..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tamiz Oftalmológico -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="tamiz_oftalmologico" name="tamizajes[]"
                                        value="tamiz_oftalmologico" class="tamiz-checkbox">
                                    <label for="tamiz_oftalmologico" class="tamiz-label">👁️ Tamiz oftalmológico</label>
                                </div>
                                <div class="tamiz-details" id="details_tamiz_oftalmologico">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_tamiz_oftalmologico" class="form-label">Fecha de
                                                realización:</label>
                                            <input type="date" id="fecha_tamiz_oftalmologico"
                                                name="fecha_tamiz_oftalmologico" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_tamiz_oftalmologico"
                                                class="form-label">Observaciones/Resultados:</label>
                                            <textarea id="observaciones_tamiz_oftalmologico"
                                                name="observaciones_tamiz_oftalmologico" class="form-input" rows="2"
                                                placeholder="Escriba aquí observaciones o resultados..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tamiz Cardíaco -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="tamiz_cardiaco" name="tamizajes[]" value="tamiz_cardiaco"
                                        class="tamiz-checkbox">
                                    <label for="tamiz_cardiaco" class="tamiz-label">❤️ Tamiz cardíaco</label>
                                </div>
                                <div class="tamiz-details" id="details_tamiz_cardiaco">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_tamiz_cardiaco" class="form-label">Fecha de
                                                realización:</label>
                                            <input type="date" id="fecha_tamiz_cardiaco" name="fecha_tamiz_cardiaco"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_tamiz_cardiaco"
                                                class="form-label">Observaciones/Resultados:</label>
                                            <textarea id="observaciones_tamiz_cardiaco"
                                                name="observaciones_tamiz_cardiaco" class="form-input" rows="2"
                                                placeholder="Escriba aquí observaciones o resultados..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tamiz de Cadera -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="tamiz_cadera" name="tamizajes[]" value="tamiz_cadera"
                                        class="tamiz-checkbox">
                                    <label for="tamiz_cadera" class="tamiz-label">🦴 Tamiz de cadera</label>
                                </div>
                                <div class="tamiz-details" id="details_tamiz_cadera">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_tamiz_cadera" class="form-label">Fecha de
                                                realización:</label>
                                            <input type="date" id="fecha_tamiz_cadera" name="fecha_tamiz_cadera"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_tamiz_cadera"
                                                class="form-label">Observaciones/Resultados:</label>
                                            <textarea id="observaciones_tamiz_cadera" name="observaciones_tamiz_cadera"
                                                class="form-input" rows="2"
                                                placeholder="Escriba aquí observaciones o resultados..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Otras Complicaciones -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">🏥</div>
                            <div class="section-info">
                                <h3>Otras Complicaciones</h3>
                                <p class="section-description">Seleccione todas las complicaciones que apliquen para el
                                    paciente</p>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <span>ℹ️</span>
                            <div><strong>Instrucciones:</strong> Marque todas las casillas que correspondan al historial
                                médico del paciente.</div>
                        </div>

                        <div class="checkbox-grid">
                            <div class="checkbox-item">
                                <input type="checkbox" id="alergias" name="otras_complicaciones[]" value="alergias"
                                    class="checkbox-input">
                                <label for="alergias" class="checkbox-label">🤧 Alergias</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="discapacidad" name="otras_complicaciones[]"
                                    value="discapacidad" class="checkbox-input">
                                <label for="discapacidad" class="checkbox-label">♿ Discapacidad</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="malformaciones_congenitas" name="otras_complicaciones[]"
                                    value="malformaciones_congenitas" class="checkbox-input">
                                <label for="malformaciones_congenitas" class="checkbox-label">🧬 Malformaciones
                                    congénitas</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cirugias" name="otras_complicaciones[]" value="cirugias"
                                    class="checkbox-input">
                                <label for="cirugias" class="checkbox-label">⚕️ Cirugías</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="otras_enfermedades" name="otras_complicaciones[]"
                                    value="otras_enfermedades" class="checkbox-input">
                                <label for="otras_enfermedades" class="checkbox-label">🏥 Otras enfermedades</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tuberculosis" name="otras_complicaciones[]"
                                    value="tuberculosis" class="checkbox-input">
                                <label for="tuberculosis" class="checkbox-label">🦠 Tuberculosis</label>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-outline" id="limpiarAntecedentes">
                            <span>🗑️</span> Limpiar Formulario
                        </button>
                        <button type="button" class="btn btn-secondary" id="guardarBorradorAnt">
                            <span>💾</span> Guardar Borrador
                        </button>
                        <button type="submit" class="btn btn-primary" id="guardarAntecedentes">
                            <span>✅</span> Guardar Antecedentes
                        </button>
                    </div>
                </form>
            </div>

            <!-- TAB: Promoción de la Salud -->
            <div class="tab-content" id="promocion">
                <form id="promocionForm">
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">🌟</div>
                            <div class="section-info">
                                <h3>Promoción de la Salud</h3>
                                <p class="section-description">Acciones educativas y preventivas realizadas con el
                                    paciente y familia</p>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <span>ℹ️</span>
                            <div><strong>Instrucciones:</strong> Primero seleccione el estado de la Cartilla Nacional de
                                Salud, luego las acciones de promoción realizadas y registre la fecha de aplicación
                                correspondiente.</div>
                        </div>

                        <!-- Selector de Estado de Cartilla -->
                        <div class="form-section"
                            style="margin-bottom: 30px; background: #fff; border: 3px solid #27ae60;">
                            <div class="section-header" style="border-bottom: 2px solid #27ae60; margin-bottom: 20px;">
                                <div class="section-icon"
                                    style="background: linear-gradient(135deg, #27ae60, #2ecc71);">📋</div>
                                <div class="section-info">
                                    <h3 style="color: #27ae60;">Estado de Cartilla Nacional de Salud</h3>
                                    <p class="section-description">Seleccione el estado actual de la Cartilla Nacional
                                        de Salud del paciente</p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="estadoCartilla" class="form-label"
                                    style="font-size: 16px; font-weight: bold;">Estado de la Cartilla <span
                                        class="required">*</span></label>
                                <select id="estadoCartilla" name="estadoCartilla" class="form-select"
                                    style="font-size: 16px; font-weight: 600; border: 3px solid #27ae60; padding: 15px;">
                                    <option value="">Seleccione el estado de la cartilla...</option>
                                    <option value="primera_vez">Entrega por primera vez de Cartilla Nacional de Salud
                                    </option>
                                    <option value="ya_tiene">Ya tiene Cartilla Nacional de Salud</option>
                                    <option value="reposicion">Reposición de Cartilla Nacional de Salud</option>
                                </select>
                            </div>
                        </div>


                        <!-- CUIDADOS DEL RECIÉN NACIDO Y SUEÑO SEGURO -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="cuidados_rn_sueno" name="promocion[]"
                                        value="cuidados_rn_sueno" class="promocion-checkbox">
                                    <label for="cuidados_rn_sueno" class="promocion-title">👶 CUIDADOS DEL RECIÉN
                                        NACIDO, DE LA NIÑA Y EL NIÑO Y SUEÑO SEGURO</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_cuidados_rn_sueno" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_cuidados_rn_sueno" name="fecha_cuidados_rn_sueno"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- LACTANCIA MATERNA -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="lactancia_materna" name="promocion[]"
                                        value="lactancia_materna" class="promocion-checkbox">
                                    <label for="lactancia_materna" class="promocion-title">🤱 LACTANCIA MATERNA</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_lactancia_materna" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_lactancia_materna" name="fecha_lactancia_materna"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- ALIMENTACIÓN COMPLEMENTARIA -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="alimentacion_complementaria" name="promocion[]"
                                        value="alimentacion_complementaria" class="promocion-checkbox">
                                    <label for="alimentacion_complementaria" class="promocion-title">🥄 ALIMENTACIÓN
                                        COMPLEMENTARIA</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_alimentacion_complementaria" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_alimentacion_complementaria"
                                        name="fecha_alimentacion_complementaria" class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- NUTRICIÓN DE LA NIÑA Y EL NIÑO -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="nutricion_nina_nino" name="promocion[]"
                                        value="nutricion_nina_nino" class="promocion-checkbox">
                                    <label for="nutricion_nina_nino" class="promocion-title">🍎 NUTRICIÓN DE LA NIÑA Y
                                        EL NIÑO</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_nutricion_nina_nino" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_nutricion_nina_nino" name="fecha_nutricion_nina_nino"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- HIGIENE BUCAL -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="higiene_bucal" name="promocion[]" value="higiene_bucal"
                                        class="promocion-checkbox">
                                    <label for="higiene_bucal" class="promocion-title">🦷 HIGIENE BUCAL</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_higiene_bucal" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_higiene_bucal" name="fecha_higiene_bucal"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- PREVENCIÓN DE ACCIDENTES -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="prevencion_accidentes" name="promocion[]"
                                        value="prevencion_accidentes" class="promocion-checkbox">
                                    <label for="prevencion_accidentes" class="promocion-title">🛡️ PREVENCIÓN DE
                                        ACCIDENTES</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_prevencion_accidentes" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_prevencion_accidentes"
                                        name="fecha_prevencion_accidentes" class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- ESTIMULACIÓN TEMPRANA -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="estimulacion_temprana" name="promocion[]"
                                        value="estimulacion_temprana" class="promocion-checkbox">
                                    <label for="estimulacion_temprana" class="promocion-title">🧸 ESTIMULACIÓN
                                        TEMPRANA</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_estimulacion_temprana" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_estimulacion_temprana"
                                        name="fecha_estimulacion_temprana" class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- DETECCIÓN DE VIOLENCIA -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="deteccion_violencia" name="promocion[]"
                                        value="deteccion_violencia" class="promocion-checkbox">
                                    <label for="deteccion_violencia" class="promocion-title">⚠️ DETECCIÓN DE
                                        VIOLENCIA</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_deteccion_violencia" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_deteccion_violencia" name="fecha_deteccion_violencia"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- OTROS -->
                        <div class="promocion-item" id="otrosPromocion">
                            <div class="promocion-header">
                                <input type="checkbox" id="otros" name="promocion[]" value="otros"
                                    class="promocion-checkbox">
                                <label for="otros" class="promocion-title">📋 OTROS</label>
                            </div>

                            <!-- Selector de acciones -->
                            <div class="age-selector-section">
                                <select class="age-select" id="otrosSelect">
                                    <option value="">Selecciona</option>
                                    <option value="acciones-prevencion-colapso-cuidador">Acciones de prevención de
                                        colapso del cuidador</option>
                                    <option value="acciones-mejoramiento-conducta-comportamiento">Acciones para el
                                        mejoramiento en la conducta del comportamiento</option>
                                    <option value="administracion-vitamina-a">Administración de vitamina "A"</option>
                                    <option value="alimentacion-saludable">Alimentación saludable</option>
                                    <option value="consejos-crianza-salud-mental">Consejos de crianza</option>
                                    <option value="consejos-salud-visual-tiempo-pantalla">Consejos sobre Salud
                                        Visual:Tiempo de pantalla</option>
                                    <option value="control-esfinteres">Control de esfínteres</option>
                                    <option value="control-fiebre">Control de fiebre</option>
                                    <option value="crecimiento-desarrollo-nina-nino">Crecimiento y desarrollo de la niña
                                        y niño</option>
                                    <option value="cuidados-nina-nino-enfermo">Cuidados de la niña y el niño enfermo
                                    </option>
                                    <option value="cuidados-embarazo">Cuidados del embarazo</option>
                                    <option value="cuidados-despues-parto">Cuidados después del parto</option>
                                    <option value="cultura-donacion-organos-tejidos">Cultura para la donación de órganos
                                        y tejidos</option>
                                    <option value="desarrollo-infantil-temprano">Desarrollo Infantil Temprano:</option>
                                    <option value="desparasitacion-intestinal">Desparasitación intestinal</option>
                                    <option value="deteccion-atresia-vias-biliares">Detección de atresia de vías
                                        biliares</option>
                                    <option value="duenos-responsables-animales-compania">Dueños responsables con
                                        animales de compañía</option>
                                    <option value="educacion-duelo">Educación del duelo</option>
                                    <option value="ensenanza-tecnica-cepillado-dental">Enseñanza de la técnica de
                                        Cepillado Dental</option>
                                    <option value="ensenanza-uso-hilo-dental">Enseñanza del uso del Hilo Dental (a
                                        partir de los 6 años)</option>
                                    <option value="entorno-favorable-salud">Entorno favorable a la salud</option>
                                    <option value="evaluacion-neurodesarrollo">Evaluación del Neurodesarrollo</option>
                                    <option value="factores-riesgo-salud-bucal">Factores de riesgo que afectan la salud
                                        bucal</option>
                                    <option value="guia-cuidado-salud">Guía para el Cuidado de la Salud</option>
                                    <option value="higiene-bucal">Higiene bucal</option>
                                    <option value="higiene-sueno">Higiene del sueño</option>
                                    <option value="ojo-seco">Ojo seco</option>
                                    <option value="orientacion-emociones-autoestima-apoyo-emocional">Orientación sobre
                                        emociones, autoestima y apoyo emocional (Trastornos psicológicos - Depresión o
                                        Tristeza)</option>
                                    <option value="orientacion-consejeria-madres-padres-tutores">Orientación/Consejería
                                        para madres, padres o tutores o representante legal</option>
                                    <option value="prevencion-anemia">Prevención anemia</option>
                                    <option value="prevencion-acoso-escolar">Prevención de Acoso Escolar</option>
                                    <option value="prevencion-adicciones">Prevención de adicciones</option>
                                    <option value="prevencion-desnutricion">Prevención de desnutrición</option>
                                    <option value="prevencion-enfermedades-bucales">Prevención de enfermedades bucales
                                    </option>
                                    <option value="prevencion-muerte-subita-lactante">Prevención de la muerte súbita de
                                        la y el lactante</option>
                                    <option value="prevencion-raquitismo">Prevención de raquitismo</option>
                                    <option value="prevencion-autolesion-conducta-suicida">Prevención en la Autolesión y
                                        conducta suicida</option>
                                    <option value="prevencion-posvencion">Prevención en la Posvención</option>
                                    <option value="prevencion-control-enfermedades-respiratorias-asma">Prevención y
                                        control de enfermedades respiratorias no transmisibles: Asma</option>
                                    <option value="prevenimss-familiar">PrevenIMSS Familiar</option>
                                    <option value="primera-visita-medico">Primera visita al médico</option>
                                    <option value="resolucion-problemas-nucleo-familiar">Resolución de problemas en el
                                        núcleo familiar</option>
                                    <option value="tamiz-auditivo-deteccion-hipoacusia">Tamiz Auditivo: Detección de
                                        hipoacusia</option>
                                    <option value="tamiz-cadera-displasia-cadera-desarrollo">Tamiz de Cadera: Displasia
                                        de la Cadera en Desarrollo</option>
                                    <option value="tamiz-neonatal-enfermedades-metabolicas-congenitas">Tamiz Neonatal:
                                        Enfermedades Metabólicas Congénitas</option>
                                    <option value="tamiz-visual">Tamiz visual</option>
                                    <option value="tecnicas-relajacion-autocuidado-autocontrol-emocional-irritable">
                                        Técnicas de relajación, autocuidado y autocontrol emocional (Trastorno
                                        psicológico - Irritable o enojos)</option>
                                    <option value="tecnicas-relajacion-autocuidado-autocontrol-emocional-olvidos">
                                        Técnicas de relajación, autocuidado y autocontrol emocional (Trastorno
                                        psicológico - Olvidos)</option>
                                    <option value="tecnicas-relajacion-autocuidado-autocontrol-emocional-ansiedad">
                                        Técnicas de relajación, autocuidado y autocontrol emocional (Trastornos
                                        psicológicos - Ansiedad)</option>
                                    <option value="vacunacion">Vacunación</option>
                                    <option value="vigilancia-evaluacion-estado-nutricional">Vigilancia y evaluación del
                                        estado nutricional</option>
                                </select>
                            </div>

                            <div class="popup-overlay" id="infoPopup">
                                <div class="popup-content">
                                    <div class="popup-header">
                                        <h3 class="popup-title" id="popupTitle">Información</h3>
                                        <button class="popup-close" onclick="cerrarPopup()">×</button>
                                    </div>
                                    <div class="popup-body" id="popupBody">
                                        <!-- El contenido se cargará dinámicamente -->
                                    </div>
                                </div>
                            </div>
                            <!-- Fecha -->
                            <div class="promocion-date-group show">
                                <label for="fecha_otros" class="form-label">Fecha de aplicación:</label>
                                <input type="date" id="fecha_otros" class="date-input">
                            </div>

                            <!-- Botón Agregar -->
                            <div style="margin-top: 15px;">
                                <button type="button" class="btn btn-outline" id="agregarOtro">➕ Agregar</button>
                            </div>

                            <!-- Contenedor donde se mostrarán las acciones agregadas -->
                            <div id="otrosAgregados" style="margin-top: 20px;"></div>
                        </div>
                    </div>

                    <!-- Botón de Herramientas -->
                    <div class="herramientas-container">
                        <a href="https://www.google.com" target="_blank" class="btn-herramientas">
                            <span class="herramientas-icon">🛠️</span>
                            <span>Herramientas de Promoción de la Salud</span>
                            <span class="herramientas-arrow">→</span>
                        </a>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-outline" id="limpiarPromocion">
                            <span>🗑️</span> Limpiar Formulario
                        </button>
                        <button type="button" class="btn btn-secondary" id="guardarBorradorProm">
                            <span>💾</span> Guardar Borrador
                        </button>
                        <button type="submit" class="btn btn-primary" id="guardarPromocion">
                            <span>✅</span> Guardar Promoción
                        </button>
                    </div>

                    <!-- Historial de Promociones Guardadas -->
                    <div class="form-section" id="historialPromocion" style="display: none;">
                        <div class="section-header">
                            <div class="section-icon">📚</div>
                            <div class="section-info">
                                <h3>Historial de Promociones de la Salud</h3>
                                <p class="section-description">Actividades de promoción registradas previamente</p>
                            </div>
                        </div>

                        <div id="historialPromociones" class="historial-container">
                            <!-- Aquí se mostrarán las promociones guardadas -->
                        </div>
                    </div>
                </form>
            </div>

            <!-- TAB: Desarrollo Infantil -->
            <div class="tab-content" id="desarrollo">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">👶</div>
                        <div class="section-info">
                            <h3>Desarrollo Infantil</h3>
                            <p class="section-description">Marca los logros que tu niña o niño ha alcanzado de acuerdo a
                                su edad y muéstralo en cada consulta</p>
                        </div>
                    </div>

                    <div class="development-form">
                        <!-- Fecha de Evaluación -->
                        <div class="date-section">
                            <h4>📅 Fecha de Evaluación del Desarrollo</h4>
                            <input type="date" id="fecha_evaluacion_desarrollo" name="fecha_evaluacion_desarrollo"
                                class="date-input-large">
                        </div>
                        <!-- Selector de Edad -->
                        <div class="age-selector-section">
                            <h4>📆Edad del Niño(a)</h4>
                            <select id="edad_nino" name="edad_nino" class="age-select">
                                <option value="">Selecciona la edad...</option>
                                <option value="1mes">1 mes</option>
                                <option value="2meses">2 meses</option>
                                <option value="3meses">3 meses</option>
                                <option value="6meses">6 meses</option>
                                <option value="1ano">1 año</option>
                                <option value="18meses">1 año 6 meses</option>
                                <option value="2anos">2 años</option>
                                <option value="3anos">3 años</option>
                                <option value="4anos">4 años</option>
                                <option value="5anos">5 años</option>
                                <option value="6anos">6 años</option>
                                <option value="7anos">7 años</option>
                                <option value="8anos">8 años</option>
                            </select>
                        </div>

                        <!-- UN MES -->

                        <div class="age-questions-section" id="questions-1mes" style="display: none;">
                            <div class="age-title">
                                <h3>👶 Evaluación - 1 mes</h3>
                            </div>

                            <!-- MOTOR -->
                            <div>
                                <div class="development-category motor-category">
                                    <div class="category-header">
                                        <h4>🏃‍♂️ MOTOR</h4>
                                    </div>

                                    <div class="question-item">
                                        <p class="question-text">¿Puede voltear su cabeza para los dos lados cuando está
                                            boca abajo?</p>
                                        <div class="radio-group">
                                            <div class="radio-item">
                                                <input type="radio" id="motor_1m_q1_si" name="motor_1m_q1" value="si"
                                                    class="radio-input">
                                                <label for="motor_1m_q1_si" class="radio-label">Sí</label>
                                            </div>
                                            <div class="radio-item">
                                                <input type="radio" id="motor_1m_q1_no" name="motor_1m_q1" value="no"
                                                    class="radio-input">
                                                <label for="motor_1m_q1_no" class="radio-label">No</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="question-item">
                                        <p class="question-text">Reflejos primarios positivos (succión, presión palmar,
                                            deglución)</p>
                                        <div class="radio-group">
                                            <div class="radio-item">
                                                <input type="radio" id="motor_1m_q2_si" name="motor_1m_q2" value="si"
                                                    class="radio-input">
                                                <label for="motor_1m_q2_si" class="radio-label">Sí</label>
                                            </div>
                                            <div class="radio-item">
                                                <input type="radio" id="motor_1m_q2_no" name="motor_1m_q2" value="no"
                                                    class="radio-input">
                                                <label for="motor_1m_q2_no" class="radio-label">No</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- LENGUAJE -->
                            <div class="development-category lenguaje-category">
                                <div class="category-header">
                                    <h4>💬 LENGUAJE</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Llora o hace ruido al estar incómoda(o) o querer comer?
                                    </p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_1m_q1_si" name="lenguaje_1m_q1" value="si"
                                                class="radio-input">
                                            <label for="lenguaje_1m_q1_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_1m_q1_no" name="lenguaje_1m_q1" value="no"
                                                class="radio-input">
                                            <label for="lenguaje_1m_q1_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Emite sonidos para expresar placer</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_1m_q2_si" name="lenguaje_1m_q2" value="si"
                                                class="radio-input">
                                            <label for="lenguaje_1m_q2_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_1m_q2_no" name="lenguaje_1m_q2" value="no"
                                                class="radio-input">
                                            <label for="lenguaje_1m_q2_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SOCIAL -->
                            <div class="development-category social-category">
                                <div class="category-header">
                                    <h4>👥 SOCIAL</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Se tranquiliza al hablarle o levantarla(o)?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="social_1m_q1_si" name="social_1m_q1" value="si"
                                                class="radio-input">
                                            <label for="social_1m_q1_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="social_1m_q1_no" name="social_1m_q1" value="no"
                                                class="radio-input">
                                            <label for="social_1m_q1_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Fija la mirada en los rostros y los sigue a 180°</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="social_1m_q2_si" name="social_1m_q2" value="si"
                                                class="radio-input">
                                            <label for="social_1m_q2_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="social_1m_q2_no" name="social_1m_q2" value="no"
                                                class="radio-input">
                                            <label for="social_1m_q2_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SIGNOS DE ALARMA -->
                            <div class="development-category alarma-category">
                                <div class="category-header">
                                    <h4>⚠️ SIGNOS DE ALARMA</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Totalmente flácido (reflejos primarios negativos)</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q1_ausente" name="alarma_1m_q1"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q1_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q1_presente" name="alarma_1m_q1"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q1_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Posición de arqueo</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q2_ausente" name="alarma_1m_q2"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q2_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q2_presente" name="alarma_1m_q2"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q2_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Succión negativa</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q3_ausente" name="alarma_1m_q3"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q3_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q3_presente" name="alarma_1m_q3"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q3_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Hipertonicidad e hipotonicidad</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q4_ausente" name="alarma_1m_q4"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q4_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q4_presente" name="alarma_1m_q4"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q4_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">No sigue objetos</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q5_ausente" name="alarma_1m_q5"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q5_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q5_presente" name="alarma_1m_q5"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q5_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Manos empuñadas con el pulgar adentro</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q6_ausente" name="alarma_1m_q6"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q6_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q6_presente" name="alarma_1m_q6"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q6_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Cabeza en gota</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q7_ausente" name="alarma_1m_q7"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q7_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q7_presente" name="alarma_1m_q7"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q7_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">No responde a sonidos llorando</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q8_ausente" name="alarma_1m_q8"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_1m_q8_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_1m_q8_presente" name="alarma_1m_q8"
                                                value="presente" class="radio-input">
                                            <label for="alarma_1m_q8_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CINCO AÑOS -->
                        <div class="age-questions-section" id="questions-5anos" style="display: none;">
                            <div class="age-title">
                                <h3>🧒 Evaluación - 5 años</h3>
                            </div>

                            <!-- MOTOR -->
                            <div class="development-category motor-category">
                                <div class="category-header">
                                    <h4>🏃‍♂️ MOTOR</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede brincar hacia atrás con los pies juntos?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q1_si" name="motor_5a_q1" value="si"
                                                class="radio-input">
                                            <label for="motor_5a_q1_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q1_no" name="motor_5a_q1" value="no"
                                                class="radio-input">
                                            <label for="motor_5a_q1_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede darse marometas?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q2_si" name="motor_5a_q2" value="si"
                                                class="radio-input">
                                            <label for="motor_5a_q2_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q2_no" name="motor_5a_q2" value="no"
                                                class="radio-input">
                                            <label for="motor_5a_q2_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede brincar en un solo pie, tres veces seguidas?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q3_si" name="motor_5a_q3" value="si"
                                                class="radio-input">
                                            <label for="motor_5a_q3_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q3_no" name="motor_5a_q3" value="no"
                                                class="radio-input">
                                            <label for="motor_5a_q3_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Sabe escribir 2 o más letras?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q4_si" name="motor_5a_q4" value="si"
                                                class="radio-input">
                                            <label for="motor_5a_q4_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q4_no" name="motor_5a_q4" value="no"
                                                class="radio-input">
                                            <label for="motor_5a_q4_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Sabe dibujar un círculo?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q5_si" name="motor_5a_q5" value="si"
                                                class="radio-input">
                                            <label for="motor_5a_q5_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="motor_5a_q5_no" name="motor_5a_q5" value="no"
                                                class="radio-input">
                                            <label for="motor_5a_q5_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- LENGUAJE -->
                            <div class="development-category lenguaje-category">
                                <div class="category-header">
                                    <h4>💬 LENGUAJE</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Comunica sus emociones cuando está "feliz, triste o
                                        enojado"?
                                    </p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_5a_q1_si" name="lenguaje_5a_q1" value="si"
                                                class="radio-input">
                                            <label for="lenguaje_5a_q1_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_5a_q1_no" name="lenguaje_5a_q1" value="no"
                                                class="radio-input">
                                            <label for="lenguaje_5a_q1_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede contar cuentos?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_5a_q2_si" name="lenguaje_5a_q2" value="si"
                                                class="radio-input">
                                            <label for="lenguaje_5a_q2_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_5a_q2_no" name="lenguaje_5a_q2" value="no"
                                                class="radio-input">
                                            <label for="lenguaje_5a_q2_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Sabe usar el tiempo futuro?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_5a_q3_si" name="lenguaje_5a_q3" value="si"
                                                class="radio-input">
                                            <label for="lenguaje_5a_q3_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="lenguaje_5a_q3_no" name="lenguaje_5a_q3" value="no"
                                                class="radio-input">
                                            <label for="lenguaje_5a_q3_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SOCIAL -->
                            <div class="development-category social-category">
                                <div class="category-header">
                                    <h4>👥 SOCIAL</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Le gusta ir a la escuela?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="social_5a_q1_si" name="social_5a_q1" value="si"
                                                class="radio-input">
                                            <label for="social_5a_q1_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="social_5a_q1_no" name="social_5a_q1" value="no"
                                                class="radio-input">
                                            <label for="social_5a_q1_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Se puede bañar solo?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="social_5a_q2_si" name="social_5a_q2" value="si"
                                                class="radio-input">
                                            <label for="social_5a_q2_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="social_5a_q2_no" name="social_5a_q2" value="no"
                                                class="radio-input">
                                            <label for="social_5a_q2_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede decir el nombre de dos de sus amigos?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="social_5a_q3_si" name="social_5a_q3" value="si"
                                                class="radio-input">
                                            <label for="social_5a_q3_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="social_5a_q3_no" name="social_5a_q3" value="no"
                                                class="radio-input">
                                            <label for="social_5a_q3_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- CONOCIMIENTOS -->
                            <div class="development-category conocimiento-category">
                                <div class="category-header">
                                    <h4>🧠 CONOCIMIENTOS</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede escribir dos números o letras?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="conocimiento_5a_q1_si" name="conocimiento_5a_q1"
                                                value="si" class="radio-input">
                                            <label for="conocimiento_5a_q1_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="conocimiento_5a_q1_no" name="conocimiento_5a_q1"
                                                value="no" class="radio-input">
                                            <label for="conocimiento_5a_q1_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Puede contar correctamente hasta diez?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="conocimiento_5a_q2_si" name="conocimiento_5a_q2"
                                                value="si" class="radio-input">
                                            <label for="conocimiento_5a_q2_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="conocimiento_5a_q2_no" name="conocimiento_5a_q2"
                                                value="no" class="radio-input">
                                            <label for="conocimiento_5a_q2_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿Utiliza correctamente las palabras ayer, hoy y mañana?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="conocimiento_5a_q3_si" name="conocimiento_5a_q3"
                                                value="si" class="radio-input">
                                            <label for="conocimiento_5a_q3_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="conocimiento_5a_q3_no" name="conocimiento_5a_q3"
                                                value="no" class="radio-input">
                                            <label for="conocimiento_5a_q3_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SIGNOS DE ALARMA - 5 AÑOS -->
                            <div class="development-category alarma-category">
                                <div class="category-header">
                                    <h4>⚠️ SIGNOS DE ALARMA</h4>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">Cuando está con otros niños ¿los ignora y prefiere jugar
                                        solo?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_5a_q1_ausente" name="alarma_5a_q1"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_5a_q1_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_5a_q1_presente" name="alarma_5a_q1"
                                                value="presente" class="radio-input">
                                            <label for="alarma_5a_q1_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="question-item">
                                    <p class="question-text">¿La madre, padre o cuidador primario reporta que el niño ha
                                        experimentado una pérdida importante y constante de las habilidades que en algún
                                        momento tuvo?</p>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_5a_q2_ausente" name="alarma_5a_q2"
                                                value="ausente" class="radio-input">
                                            <label for="alarma_5a_q2_ausente" class="radio-label">Ausente</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="alarma_5a_q2_presente" name="alarma_5a_q2"
                                                value="presente" class="radio-input">
                                            <label for="alarma_5a_q2_presente" class="radio-label">Presente</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Placeholder para otras edades -->
                        <div class="no-age-selected" id="no-age-message">
                            <div class="empty-state">
                                <h4>📋 Selecciona una edad</h4>
                                <p>Por favor, selecciona la edad del niño(a) para mostrar las preguntas de evaluación
                                    correspondientes.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Semáforo de Resultados - Agregar después de las preguntas de desarrollo -->
                <div class="semaforo-container" id="semaforoDesarrollo" style="display: none;">
                    <div class="semaforo-header">
                        <h4>📊 Resultado de la Evaluación</h4>
                    </div>

                    <div class="contadores-resultados">
                        <div class="contador-item">
                            <div class="contador-icon">✅</div>
                            <div class="contador-info">
                                <span class="contador-numero" id="conteoSi">0</span>
                                <span class="contador-label">Sí lo hace</span>
                            </div>
                        </div>

                        <div class="contador-item">
                            <div class="contador-icon">❌</div>
                            <div class="contador-info">
                                <span class="contador-numero" id="conteoNo">0</span>
                                <span class="contador-label">No lo hace</span>
                            </div>
                        </div>

                        <div class="contador-item">
                            <div class="contador-icon">⚠️</div>
                            <div class="contador-info">
                                <span class="contador-numero" id="conteoPresente">0</span>
                                <span class="contador-label">Señales de alarma presentes</span>
                            </div>
                        </div>

                        <div class="contador-item">
                            <div class="contador-icon">✨</div>
                            <div class="contador-info">
                                <span class="contador-numero" id="conteoAusente">0</span>
                                <span class="contador-label">Señales ausentes</span>
                            </div>
                        </div>
                    </div>

                    <div class="semaforo-resultado" id="resultadoSemaforo">
                        <div class="semaforo-luz verde" id="luzVerde">
                            <div class="luz-contenido">
                                <div class="luz-icon">🟢</div>
                                <div class="luz-texto">
                                    <h5>DESARROLLO NORMAL</h5>
                                </div>
                            </div>
                        </div>

                        <div class="semaforo-luz amarillo" id="luzAmarillo">
                            <div class="luz-contenido">
                                <div class="luz-icon">🟡</div>
                                <div class="luz-texto">
                                    <h5>ALTERACIÓN LEVE DEL DESARROLLO</h5>
                                </div>
                            </div>
                        </div>

                        <div class="semaforo-luz rojo" id="luzRojo">
                            <div class="luz-contenido">
                                <div class="luz-icon">🔴</div>
                                <div class="luz-texto">
                                    <h5>SOSPECHA DE ALTERACIÓN GRAVE DEL DESARROLLO</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Botones de Acción -->
                <div class="action-buttons">
                    <button type="button" class="btn btn-outline" id="limpiarDesarrollo">
                        <span>🗑️</span> Limpiar Formulario
                    </button>
                    <button type="button" class="btn btn-secondary" id="guardarBorradorDes">
                        <span>💾</span> Guardar Borrador
                    </button>
                    <button type="button" class="btn btn-primary" id="guardarDesarrollo">
                        <span>✅</span> Guardar Desarrollo
                    </button>
                </div>
            </div>

            <!-- TAB: Nutrición -->
            <div class="tab-content" id="nutricion">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">🍎</div>
                        <div class="section-info">
                            <h3>Evaluación Nutricional</h3>
                            <p class="section-description">Registro y seguimiento del estado nutricional del paciente
                            </p>
                        </div>
                    </div>

                    <form id="nutricionForm">
                        <div class="nutrition-form">
                            <!-- Selector de Edad -->
                            <div class="age-selector-section">
                                <h4>📅 Edad para Evaluación</h4>
                                <select id="edad_nutricion" name="edad_nutricion" class="age-select">
                                    <option value="">Selecciona la edad...</option>
                                    <option value="al_nacer">Al nacer</option>
                                    <option value="1mes">1 mes</option>
                                    <option value="2meses">2 meses</option>
                                    <option value="3meses">3 meses</option>
                                    <option value="4meses">4 meses</option>
                                    <option value="5meses">5 meses</option>
                                    <option value="6meses">6 meses</option>
                                    <option value="7meses">7 meses</option>
                                    <option value="8meses">8 meses</option>
                                    <option value="9meses">9 meses</option>
                                    <option value="10meses">10 meses</option>
                                    <option value="11meses">11 meses</option>
                                    <option value="1ano">1 año</option>
                                    <option value="2anos">2 años</option>
                                    <option value="3anos">3 años</option>
                                    <option value="4anos">4 años</option>
                                    <option value="5anos">5 años</option>
                                    <option value="6anos">6 años</option>
                                    <option value="7anos">7 años</option>
                                    <option value="8anos">8 años</option>
                                </select>
                            </div>

                            <!-- Datos de Medición -->
                            <div class="form-grid" style="margin-top: 30px;">
                                <div class="form-group">
                                    <label for="peso_nutricion" class="form-label">Peso <span
                                            class="required">*</span></label>
                                    <div class="input-group">
                                        <input type="number" id="peso_nutricion" name="peso_nutricion"
                                            class="form-input" placeholder="Ej. 15.5" min="0.1" max="999.9" step="0.1"
                                            required>
                                        <div class="input-addon">kg</div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="talla_nutricion" class="form-label">Talla <span
                                            class="required">*</span></label>
                                    <div class="input-group">
                                        <input type="number" id="talla_nutricion" name="talla_nutricion"
                                            class="form-input" placeholder="Ej. 98.5" min="0.1" max="999.9" step="0.1"
                                            required>
                                        <div class="input-addon">cm</div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="fecha_nutricion" class="form-label">Fecha de Medición <span
                                            class="required">*</span></label>
                                    <input type="date" id="fecha_nutricion" name="fecha_nutricion" class="form-input"
                                        required>
                                </div>

                                <div class="form-group">
                                    <label for="imc_nutricion" class="form-label">IMC</label>
                                    <div class="input-group">
                                        <input type="text" id="imc_nutricion" name="imc_nutricion" class="form-input"
                                            placeholder="Se calculará automáticamente" readonly
                                            style="background: #f8f9fa;">
                                        <div class="input-addon">kg/m²</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Resultado de Evaluación -->
                            <div id="resultado_nutricion" class="form-section" style="display: none; margin-top: 30px;">
                                <div class="section-header">
                                    <div class="section-icon">📊</div>
                                    <div class="section-info">
                                        <h3>Resultado de Evaluación</h3>
                                        <p class="section-description">Estado nutricional según IMC</p>
                                    </div>
                                </div>

                                <div id="estado_nutricional" class="nutrition-result">
                                    <!-- Aquí se mostrará el resultado -->
                                </div>
                            </div>

                            <div class="form-section" style="margin-top: 30px;">
                                <div class="section-header">
                                    <div class="section-icon">🤱</div>
                                    <div class="section-info">
                                        <h3>Tipo de Alimentación</h3>
                                        <p class="section-description">Registro obligatorio del tipo de alimentación del
                                            paciente</p>
                                    </div>
                                </div>

                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="tipo_alimentacion" class="form-label">Tipo de Alimentación <span
                                                class="required">*</span></label>
                                        <select id="tipo_alimentacion" name="tipo_alimentacion" class="form-input"
                                            required>
                                            <option value="">Selecciona el tipo de alimentación...</option>
                                            <option value="lactancia_exclusiva" data-edad-min="0" data-edad-max="6">
                                                Lactancia materna exclusiva</option>
                                            <option value="lactancia_complementaria" data-edad-min="6"
                                                data-edad-max="24">Lactancia materna complementaria</option>
                                            <option value="abandono_lactancia">Abandono de Lactancia materna</option>
                                            <option value="lactancia_mixta">Lactancia materna mixta</option>
                                            <option value="lactancia_mixta_complementaria">Lactancia materna mixta
                                                complementaria</option>
                                            <option value="sin_lactancia_medica">Sin lactancia materna por razón médica
                                            </option>
                                        </select>
                                        <div class="form-help" id="alimentacion_help"
                                            style="display: none; margin-top: 8px; font-size: 0.875rem; color: #666;">
                                            <!-- Aquí se mostrarán las restricciones de edad -->
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="fecha_alimentacion" class="form-label">Fecha de Registro <span
                                                class="required">*</span></label>
                                        <input type="date" id="fecha_alimentacion" name="fecha_alimentacion"
                                            class="form-input" required>
                                    </div>
                                </div>

                                <!-- Información adicional según el tipo seleccionado -->
                                <div id="info_alimentacion" class="nutrition-info"
                                    style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                                    <div id="contenido_info_alimentacion">
                                        <!-- Aquí se mostrará información específica según el tipo seleccionado -->
                                    </div>
                                </div>



                            </div>



                            <!-- Botones de Acción -->
                            <div class="action-buttons">
                                <button type="button" class="btn btn-outline" id="limpiarNutricion">
                                    <span>🗑️</span> Limpiar Formulario
                                </button>
                                <button type="button" class="btn btn-secondary" id="guardarBorradorNut">
                                    <span>💾</span> Guardar Borrador
                                </button>
                                <button type="submit" class="btn btn-primary" id="guardarNutricion">
                                    <span>✅</span> Guardar Evaluación
                                </button>
                            </div>

                            <!-- Historial de Evaluaciones -->
                            <div class="form-section" id="historialNutricion" style="display: none;">
                                <div class="section-header">
                                    <div class="section-icon">📈</div>
                                    <div class="section-info">
                                        <h3>Historial Nutricional</h3>
                                        <p class="section-description">Evaluaciones nutricionales registradas</p>
                                    </div>
                                </div>

                                <div id="historialEvaluaciones" class="historial-container">
                                    <!-- Aquí se mostrarán las evaluaciones guardadas -->
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- TAB: Vacunación -->
            <div class="tab-content" id="vacunacion">
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon">💉</div>
                        <div class="section-info">
                            <h3>Esquema de Vacunación</h3>
                            <p class="section-description">Control y registro de vacunas aplicadas según esquema
                                nacional</p>
                        </div>
                    </div>

                    <!-- Esquema Nacional de Vacunación -->
                    <div class="form-section">
                        <div class="section-header" style="border-bottom: 2px solid #3498db;">
                            <div class="section-icon" style="background: linear-gradient(135deg, #3498db, #5dade2);">📋
                            </div>
                            <div class="section-info">
                                <h3 style="color: #3498db;">Esquema Nacional de Vacunación</h3>
                                <p class="section-description">Vacunas del esquema básico de inmunización</p>
                            </div>
                        </div>

                        <div class="vacunas-grid">
                            <!-- BCG -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 BCG</h4>
                                    <span class="enfermedad-badge">Tuberculosis meníngea y miliar</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="bcg" data-dosis="unica">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">Única</span>
                                            <span class="edad-oportuna">Al nacer</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('bcg', 'unica')">➕</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hepatitis B -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 Hepatitis B</h4>
                                    <span class="enfermedad-badge">Hepatitis B</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="hepatitis_b" data-dosis="unica">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">Única</span>
                                            <span class="edad-oportuna">Al nacer</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('hepatitis_b', 'unica')">➕</button>
                                        </div>
                                    </div>

                                </div>
                            </div>


                            <!-- HEXAVALENTE -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 Hexavalente (DPaT + VPI + Hib + HepB)</h4>
                                    <span class="enfermedad-badge">Difteria, Tos ferina, Tétanos, Poliomielitis,
                                        Hepatitis B y Enfermedades graves por Haemophilus Influenzae tipo B (neumonía y
                                        meningitis)</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="hexavalente" data-dosis="primera">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">1era dosis</span>
                                            <span class="edad-oportuna">2 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('hexavalente', 'primera')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="hexavalente" data-dosis="segunda">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">2da dosis</span>
                                            <span class="edad-oportuna">4 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('hexavalente', 'segunda')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="hexavalente" data-dosis="tercera">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">3ra dosis</span>
                                            <span class="edad-oportuna">6 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('hexavalente', 'tercera')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="hexavalente" data-dosis="cuarta">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">4ta dosis</span>
                                            <span class="edad-oportuna">18 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('hexavalente', 'cuarta')">➕</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- DPT -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 DPT</h4>
                                    <span class="enfermedad-badge">Difteria, Tos ferina y Tétanos</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="dpt" data-dosis="refuerzo">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">Refuerzo</span>
                                            <span class="edad-oportuna">4 años</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('dpt', 'refuerzo')">➕</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Rotavirus -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 Rotavirus</h4>
                                    <span class="enfermedad-badge">Diarrea por Rotavirus</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="rotavirus" data-dosis="primera">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">1era dosis</span>
                                            <span class="edad-oportuna">2 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('rotavirus', 'primera')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="rotavirus" data-dosis="segunda">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">2da dosis</span>
                                            <span class="edad-oportuna">4 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('rotavirus', 'segunda')">➕</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Neumocócica conjugada -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 Neumocócica conjugada</h4>
                                    <span class="enfermedad-badge">Neumonía, Meningitis y otras enfermedades graves
                                        causadas por neumococo</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="neumococica" data-dosis="primera">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">1era dosis</span>
                                            <span class="edad-oportuna">2 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('neumococica', 'primera')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="neumococica" data-dosis="segunda">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">2da dosis</span>
                                            <span class="edad-oportuna">4 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('neumococica', 'segunda')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="neumococica" data-dosis="refuerzo">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">Refuerzo</span>
                                            <span class="edad-oportuna">12 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('neumococica', 'refuerzo')">➕</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- INFLUENZA -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 INFLUENZA</h4>
                                    <span class="enfermedad-badge">Neumonía por virus de la Influenza A y B</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="influenza" data-dosis="primera">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">1era dosis</span>
                                            <span class="edad-oportuna">6 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('influenza', 'primera')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="influenza" data-dosis="segunda">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">2da dosis</span>
                                            <span class="edad-oportuna">1 mes después</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('influenza', 'segunda')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="influenza" data-dosis="anual">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">Dosis Anual</span>
                                            <span class="edad-oportuna">Cada temporada invernal</span>
                                        </div>
                                        <div class="fecha-aplicacion"
                                            style="flex-direction: column; align-items: stretch; gap: 10px;">
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <select id="anio_influenza" class="form-select"
                                                    style="flex: 1; padding: 6px 10px; font-size: 13px;">
                                                    <option value="">Seleccionar año...</option>
                                                    <option value="1_ano">1 AÑO</option>
                                                    <option value="2_anos">2 AÑOS</option>
                                                    <option value="3_anos">3 AÑOS</option>
                                                    <option value="4_anos">4 AÑOS</option>
                                                </select>
                                                <button type="button" class="btn btn-outline"
                                                    onclick="agregarDosisAnualInfluenza()"
                                                    style="padding: 6px 12px; font-size: 12px;">➕ Agregar</button>
                                            </div>
                                            <div id="dosis_anuales_agregadas" style="margin-top: 10px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- SRP -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 SRP</h4>
                                    <span class="enfermedad-badge">Sarampión, Rubéola y Paperas</span>
                                </div>
                                <div class="dosis-container">
                                    <div class="dosis-item" data-vacuna="srp" data-dosis="primera">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">1era dosis</span>
                                            <span class="edad-oportuna">12 meses</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('srp', 'primera')">➕</button>
                                        </div>
                                    </div>
                                    <div class="dosis-item" data-vacuna="srp" data-dosis="segunda">
                                        <div class="dosis-info">
                                            <span class="dosis-numero">2da dosis</span>
                                            <span class="edad-oportuna">13 meses y 6 años</span>
                                        </div>
                                        <div class="fecha-aplicacion">
                                            <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                                            <button type="button" class="btn-detalles"
                                                onclick="abrirDetallesVacuna('srp', 'segunda')">➕</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- COVID-19 -->
                            <div class="vacuna-card">
                                <div class="vacuna-header">
                                    <h4>💉 COVID-19</h4>
                                    <span class="enfermedad-badge">Formas graves de la COVID-19</span>
                                </div>
                                <div class="dosis-container">
                                    <!-- Esquema Primario -->
                                    <div class="esquema-especial">
                                        <h5>📋 ESQUEMA PRIMARIO</h5>
                                        <div class="dosis-item" data-vacuna="covid19" data-dosis="primera_primaria">
                                            <div class="dosis-info">
                                                <span class="dosis-numero">1era dosis</span>
                                                <span class="edad-oportuna">A partir de los 5 años</span>
                                            </div>
                                            <div class="fecha-aplicacion">
                                                <input type="date" class="fecha-input"
                                                    placeholder="Fecha de aplicación">
                                                <button type="button" class="btn-detalles"
                                                    onclick="abrirDetallesVacuna('covid19', 'primera_primaria')">➕</button>
                                            </div>
                                        </div>
                                        <div class="dosis-item" data-vacuna="covid19" data-dosis="segunda_primaria">
                                            <div class="dosis-info">
                                                <span class="dosis-numero">2da dosis</span>
                                                <span class="edad-oportuna">21 días después de la 1ra dosis</span>
                                            </div>
                                            <div class="fecha-aplicacion">
                                                <input type="date" class="fecha-input"
                                                    placeholder="Fecha de aplicación">
                                                <button type="button" class="btn-detalles"
                                                    onclick="abrirDetallesVacuna('covid19', 'segunda_primaria')">➕</button>
                                            </div>
                                        </div>
                                        <div class="dosis-item" data-vacuna="covid19" data-dosis="tercera_primaria">
                                            <div class="dosis-info">
                                                <span class="dosis-numero">3ra dosis</span>
                                                <span class="edad-oportuna">21 días después de la 2da dosis</span>
                                            </div>
                                            <div class="fecha-aplicacion">
                                                <input type="date" class="fecha-input"
                                                    placeholder="Fecha de aplicación">
                                                <button type="button" class="btn-detalles"
                                                    onclick="abrirDetallesVacuna('covid19', 'tercera_primaria')">➕</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Refuerzo para niños con factores de riesgo -->
                                    <div class="esquema-especial"
                                        style="background: linear-gradient(135deg, #ffeaa7, #ffda94); border-color: #e17055;">
                                        <h5>⚠️ NIÑAS Y NIÑOS CON FACTORES DE RIESGO</h5>
                                        <div class="dosis-item" data-vacuna="covid19" data-dosis="refuerzo_riesgo">
                                            <div class="dosis-info">
                                                <span class="dosis-numero">Refuerzo</span>
                                                <span class="edad-oportuna">4 meses después de la última dosis</span>
                                            </div>
                                            <div class="fecha-aplicacion">
                                                <input type="date" class="fecha-input"
                                                    placeholder="Fecha de aplicación">
                                                <button type="button" class="btn-detalles"
                                                    onclick="abrirDetallesVacuna('covid19', 'refuerzo_riesgo')">➕</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>

                    <!-- Otras Vacunas -->
                    <div class="form-section">
                        <div class="section-header" style="border-bottom: 2px solid #9b59b6;">
                            <div class="section-icon" style="background: linear-gradient(135deg, #9b59b6, #bb73e0);">⭕
                            </div>
                            <div class="section-info">
                                <h3 style="color: #9b59b6;">Otras Vacunas</h3>
                                <p class="section-description">Vacunas adicionales y especiales</p>
                            </div>
                        </div>

                        <div class="otras-vacunas-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="otra_vacuna_select" class="form-label">Vacuna <span
                                            class="required">*</span></label>
                                    <select id="otra_vacuna_select" name="otra_vacuna" class="form-select">
                                        <option value="">Selecciona una vacuna...</option>
                                        <option value="antihepatitis_a">Antihepatitis A</option>
                                        <option value="antirrabica_humana">Antirrábica humana</option>
                                        <option value="antivaricela">Antivaricela</option>
                                        <option value="coccidioidina">Coccidioidina</option>
                                        <option value="faboter_antialacrán">Faboterápico antialacrán</option>
                                        <option value="faboter_antiaracnido">Faboterápico antiarácnido</option>
                                        <option value="faboter_anticoral">Faboterápico anticoral</option>
                                        <option value="faboter_antiloxoceles">Faboterápico antiloxoceles</option>
                                        <option value="faboter_antiviperino">Faboterápico antiviperino</option>
                                        <option value="histoplasmina">Histoplasmina</option>
                                        <option value="inmunoglobulina_antirrabica">Inmunoglobulina Antirrábica</option>
                                        <option value="inmunoglobulina_antitetanica">Inmunoglobulina Antitetánica
                                        </option>
                                        <option value="inmunoglobulina_simple">Inmunoglobulina Simple</option>
                                        <option value="neumococica_polisacarida">Neumocócica Polisacárida (23 valente)
                                        </option>
                                        <option value="otra">Otra</option>
                                        <option value="tdpa">TDPA</option>
                                        <option value="dengue">Vacuna contra el Dengue</option>
                                        <option value="herpes_zoster">Vacuna contra el Herpes Zoster</option>
                                        <option value="fiebre_amarilla">Vacuna contra la Fiebre amarilla</option>
                                        <option value="meningococo">Vacuna contra el Meningococo</option>
                                        <option value="vsr">Vacuna contra el Virus Sincicial Respiratorio (VSR)</option>
                                    </select>
                                    <div class="form-group" id="otra_vacuna_texto_group" style="display: none;">
                                        <label for="otra_vacuna_texto" class="form-label">Especificar vacuna <span
                                                class="required">*</span></label>
                                        <input type="text" id="otra_vacuna_texto" name="otra_vacuna_texto"
                                            class="form-input" placeholder="Escriba el nombre de la vacuna">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="otra_dosis_select" class="form-label">Dosis <span
                                            class="required">*</span></label>
                                    <select id="otra_dosis_select" name="otra_dosis" class="form-select">
                                        <option value="">Selecciona dosis...</option>
                                        <option value="primera">Primera</option>
                                        <option value="segunda">Segunda</option>
                                        <option value="tercera">Tercera</option>
                                        <option value="cuarta">Cuarta</option>
                                        <option value="refuerzo">Refuerzo</option>
                                        <option value="adicional">Adicional</option>
                                        <option value="intoxicacion_animal">Dosis atención intoxicación veneno animal
                                        </option>
                                        <option value="indicacion_medica">Dosis por indicación Médica</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="otra_fecha_vacunacion" class="form-label">Fecha de Vacunación <span
                                            class="required">*</span></label>
                                    <input type="date" id="otra_fecha_vacunacion" name="otra_fecha_vacunacion"
                                        class="form-input" required>
                                </div>

                                <div class="form-group">
                                    <label for="otra_lote" class="form-label">Lote de la Vacuna <span
                                            class="required">*</span></label>
                                    <input type="text" id="otra_lote" name="otra_lote" class="form-input"
                                        placeholder="Ingrese el número de lote" required>
                                </div>

                                <div class="form-group">
                                    <label for="otra_fecha_caducidad" class="form-label">Fecha de Caducidad <span
                                            class="required">*</span></label>
                                    <input type="date" id="otra_fecha_caducidad" name="otra_fecha_caducidad"
                                        class="form-input" required>
                                </div>

                            </div>

                            <div style="margin-top: 20px;">
                                <button type="button" class="btn btn-outline" id="agregarOtraVacuna">➕ Agregar
                                    Vacuna</button>
                            </div>

                            <!-- Lista de otras vacunas agregadas -->
                            <div id="otrasVacunasAgregadas" style="margin-top: 20px;"></div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-outline" id="limpiarVacunacion">
                            <span>🗑️</span> Limpiar Formulario
                        </button>
                        <button type="button" class="btn btn-secondary" id="guardarBorradorVac">
                            <span>💾</span> Guardar Borrador
                        </button>
                        <button type="button" class="btn btn-primary" id="guardarVacunacion">
                            <span>✅</span> Guardar Esquema
                        </button>
                    </div>

                    <!-- Historial de Vacunación -->
                    <div class="form-section" id="historialVacunacion" style="display: none;">
                        <div class="section-header">
                            <div class="section-icon">📊</div>
                            <div class="section-info">
                                <h3>Historial de Vacunación</h3>
                                <p class="section-description">Vacunas aplicadas y registradas previamente</p>
                            </div>
                        </div>

                        <div id="historialVacunas" class="historial-container">
                            <!-- Aquí se mostrarán las vacunas guardadas -->
                        </div>
                    </div>

                </div>
            </div>

            <!-- Modal para detalles de vacuna -->
            <div class="popup-overlay" id="detallesVacunaModal">
                <div class="popup-content" style="max-width: 800px;">
                    <div class="popup-header">
                        <h3 class="popup-title" id="tituloDetallesVacuna">Detalles de Vacunación</h3>
                        <button class="popup-close" onclick="cerrarDetallesVacuna()">×</button>
                    </div>
                    <div class="popup-body">
                        <form id="detallesVacunaForm">
                            <div class="form-grid">
                                <!-- Rescate -->
                                <div class="form-group">
                                    <label class="form-label">Rescate <span class="required">*</span></label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="rescate_si" name="rescate" value="si"
                                                class="radio-input">
                                            <label for="rescate_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="rescate_no" name="rescate" value="no"
                                                class="radio-input">
                                            <label for="rescate_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Fecha de Registro -->
                                <div class="form-group">
                                    <label for="fecha_registro" class="form-label">Fecha de Registro</label>
                                    <input type="date" id="fecha_registro" name="fecha_registro" class="form-input">
                                </div>

                                <!-- Fecha de Aplicación -->
                                <div class="form-group">
                                    <label for="fecha_aplicacion_detalle" class="form-label">Fecha de Aplicación</label>
                                    <input type="date" id="fecha_aplicacion_detalle" name="fecha_aplicacion_detalle"
                                        class="form-input">
                                </div>

                                <!-- Grupo de Riesgo -->
                                <div class="form-group">
                                    <label for="grupo_riesgo" class="form-label">Grupo de Riesgo</label>
                                    <select id="grupo_riesgo" name="grupo_riesgo" class="form-select">
                                        <option value="">Selecciona...</option>
                                        <option value="ninguno">Ninguno</option>
                                        <option value="inmunocompromiso">Inmunocompromiso</option>
                                        <option value="enfermedad_cronica">Enfermedad crónica</option>
                                        <option value="contacto_tb">Contacto TB</option>
                                        <option value="otros">Otros</option>
                                    </select>
                                </div>

                                <!-- Lote -->
                                <div class="form-group">
                                    <label for="lote" class="form-label">Lote</label>
                                    <input type="text" id="lote" name="lote" class="form-input"
                                        placeholder="Número de lote">
                                </div>

                                <!-- Fecha de Caducidad -->
                                <div class="form-group">
                                    <label for="fecha_caducidad" class="form-label">Fecha de Caducidad</label>
                                    <input type="date" id="fecha_caducidad" name="fecha_caducidad" class="form-input">
                                </div>

                                <!-- Lugar de Aplicación -->
                                <div class="form-group">
                                    <label class="form-label">Lugar de Aplicación</label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="intramuros" name="lugar_aplicacion"
                                                value="intramuros" class="radio-input">
                                            <label for="intramuros" class="radio-label">Intramuros</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="extramuros" name="lugar_aplicacion"
                                                value="extramuros" class="radio-input">
                                            <label for="extramuros" class="radio-label">Extramuros</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Reacciones Adversas -->
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label class="form-label">Evento Supuestamente Asociado a la Vacunación o
                                        Inmunización (ESAVI) </label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="reacciones_si" name="reacciones_adversas" value="si"
                                                class="radio-input">
                                            <label for="reacciones_si" class="radio-label">Sí</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="reacciones_no" name="reacciones_adversas" value="no"
                                                class="radio-input">
                                            <label for="reacciones_no" class="radio-label">No</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Molestias -->
                                <div class="form-group" id="molestias_section"
                                    style="grid-column: 1 / -1; display: none;">
                                    <label class="form-label">Seleccione las molestias:</label>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cefalea" name="molestias[]" value="cefalea"
                                                class="checkbox-input">
                                            <label for="cefalea" class="checkbox-label">Cefalea</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="fiebre" name="molestias[]" value="fiebre"
                                                class="checkbox-input">
                                            <label for="fiebre" class="checkbox-label">Fiebre</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor_sitio" name="molestias[]"
                                                value="dolor_sitio" class="checkbox-input">
                                            <label for="dolor_sitio" class="checkbox-label">Dolor en el sitio de
                                                aplicación</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="malestar_general" name="molestias[]"
                                                value="malestar_general" class="checkbox-input">
                                            <label for="malestar_general" class="checkbox-label">Malestar
                                                general</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="escalofrio" name="molestias[]" value="escalofrio"
                                                class="checkbox-input">
                                            <label for="escalofrio" class="checkbox-label">Escalofrío</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="cansancio" name="molestias[]" value="cansancio"
                                                class="checkbox-input">
                                            <label for="cansancio" class="checkbox-label">Cansancio</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="inflamacion" name="molestias[]"
                                                value="inflamacion" class="checkbox-input">
                                            <label for="inflamacion" class="checkbox-label">Inflamación o enrojecimiento
                                                en el sitio</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="dolor_muscular" name="molestias[]"
                                                value="dolor_muscular" class="checkbox-input">
                                            <label for="dolor_muscular" class="checkbox-label">Dolor muscular y
                                                articular</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="otra_molestia" name="molestias[]" value="otra"
                                                class="checkbox-input">
                                            <label for="otra_molestia" class="checkbox-label">Otra</label>
                                        </div>
                                    </div>

                                    <!-- Campo para especificar "otra" molestia -->
                                    <div id="otra_molestia_detalle" style="display: none; margin-top: 10px;">
                                        <input type="text" id="otra_molestia_texto" name="otra_molestia_texto"
                                            class="form-input" placeholder="Especifique la molestia">
                                    </div>
                                </div>
                            </div>

                            <div class="action-buttons" style="margin-top: 30px;">
                                <button type="button" class="btn btn-secondary"
                                    onclick="cerrarDetallesVacuna()">Cancelar</button>
                                <button type="button" class="btn btn-primary" onclick="guardarDetallesVacuna()">Guardar
                                    Detalles</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!--TAB: Prevención de enfermedades-->
            <div class="tab-content" id="prevencion">
                <form id="prevencionForm">

                    <!-- VITAMINA A - Solo checkbox -->
                    <div class="promocion-item">
                        <div class="promocion-header-with-date">
                            <div class="promocion-check-title">
                                <input type="checkbox" id="vitamina_a" name="prevencion[]" value="vitamina_a"
                                    class="promocion-checkbox">
                                <label for="vitamina_a" class="promocion-title">🍊 Administración de Vitamina
                                    "A"</label>
                                <span class="prevencion-badge">Dar cada 6 meses hasta los 4 años.</span>
                            </div>
                            <div class="promocion-date-inline">
                                <label for="fecha_vitamina_a" class="date-label">Fecha:</label>
                                <input type="date" id="fecha_vitamina_a" name="fecha_vitamina_a"
                                    class="date-input-header">
                            </div>
                        </div>
                    </div>

                    <!-- HIERRO - Mantener sección completa -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">🩸</div>
                            <div class="section-info">
                                <h3>Hierro</h3>
                                <p class="section-description">Suplementación de hierro para prevención y tratamiento
                                </p>
                            </div>
                        </div>

                        <!-- ANEMIA -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="hierro_anemia" name="prevencion[]" value="hierro_anemia"
                                        class="promocion-checkbox">
                                    <label for="hierro_anemia" class="promocion-title">🩸 ANEMIA</label>
                                    <span class="prevencion-badge">En bebés prematuros con bajo peso al nacer a partir
                                        de los 2 meses y hasta los 23 meses de edad.
                                        En bebés con peso normal al nacer a partir de los 4 meses y hasta los 9
                                        años.</span>
                                </div>

                                <div class="promocion-date-inline">
                                    <label for="fecha_hierro_anemia" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_hierro_anemia" name="fecha_hierro_anemia"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- PROFILAXIS -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="hierro_profilaxis" name="prevencion[]"
                                        value="hierro_profilaxis" class="promocion-checkbox">
                                    <label for="hierro_profilaxis" class="promocion-title">💊 PROFILAXIS</label>
                                    <span class="prevencion-badge">En bebés prematuros con bajo peso al nacer a partir
                                        de los 2 meses y hasta los 23 meses de edad.
                                        En bebés con peso normal al nacer a partir de los 4 meses y hasta los 9
                                        años.</span>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_hierro_profilaxis" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_hierro_profilaxis" name="fecha_hierro_profilaxis"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESPARASITACIÓN INTESTINAL - Solo checkbox -->
                    <div class="promocion-item">
                        <div class="promocion-header-with-date">
                            <div class="promocion-check-title">
                                <input type="checkbox" id="desparasitacion" name="prevencion[]" value="desparasitacion"
                                    class="promocion-checkbox">
                                <label for="desparasitacion" class="promocion-title">💊 Desparasitación
                                    Intestinal</label>
                                <span class="prevencion-badge">Cada 6 meses, a partir de los 2 años y hasta los 9 años
                                    de edad.</span>
                            </div>
                            <div class="promocion-date-inline">
                                <label for="fecha_desparasitacion" class="date-label">Fecha:</label>
                                <input type="date" id="fecha_desparasitacion" name="fecha_desparasitacion"
                                    class="date-input-header">
                            </div>
                        </div>
                    </div>

                    <!-- DOTACIÓN DE VIDA SUERO ORAL - Solo checkbox -->
                    <div class="promocion-item">
                        <div class="promocion-header-with-date">
                            <div class="promocion-check-title">
                                <input type="checkbox" id="vida_suero_oral" name="prevencion[]" value="vida_suero_oral"
                                    class="promocion-checkbox">
                                <label for="vida_suero_oral" class="promocion-title">💧 Dotación de Vida Suero
                                    Oral</label>
                                <span class="prevencion-badge">De 0 a 4 años de edad.</span>
                            </div>
                            <div class="promocion-date-inline">
                                <label for="fecha_vida_suero_oral" class="date-label">Fecha:</label>
                                <input type="date" id="fecha_vida_suero_oral" name="fecha_vida_suero_oral"
                                    class="date-input-header">
                            </div>
                        </div>
                    </div>

                    <!-- SALUD BUCAL - Mantener sección completa -->
                    <div class="form-section">
                        <div class="section-header" style="border-bottom: 2px solid #e91e63;">
                            <div class="section-icon" style="background: linear-gradient(135deg, #e91e63, #f06292);">🦷
                            </div>
                            <div class="section-info">
                                <h3 style="color: #e91e63;">Salud Bucal</h3>
                                <p class="section-description">Actividades de prevención y cuidado de la salud bucal</p>
                            </div>
                        </div>

                        <!-- Enseñanza de técnica del cepillado dental -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="ensenanza_cepillado" name="prevencion[]"
                                        value="ensenanza_cepillado" class="promocion-checkbox">
                                    <label for="ensenanza_cepillado" class="promocion-title">🦷 Enseñanza de técnica del
                                        cepillado dental</label>
                                    <span class="prevencion-badge">Desde que aparece el primer diente</span>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_ensenanza_cepillado" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_ensenanza_cepillado" name="fecha_ensenanza_cepillado"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- Detección de placa bacteriana -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="deteccion_placa" name="prevencion[]"
                                        value="deteccion_placa" class="promocion-checkbox">
                                    <label for="deteccion_placa" class="promocion-title">🔍 Detección de placa
                                        bacteriana</label>
                                    <span class="prevencion-badge">A partir de los 3 años</span>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_deteccion_placa" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_deteccion_placa" name="fecha_deteccion_placa"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- Aplicación de flúor -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="aplicacion_fluor" name="prevencion[]"
                                        value="aplicacion_fluor" class="promocion-checkbox">
                                    <label for="aplicacion_fluor" class="promocion-title">✨ Aplicación de flúor</label>
                                    <span class="prevencion-badge">A partir del primer año</span>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_aplicacion_fluor" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_aplicacion_fluor" name="fecha_aplicacion_fluor"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- Enseñanza de uso del hilo dental -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="ensenanza_hilo_dental" name="prevencion[]"
                                        value="ensenanza_hilo_dental" class="promocion-checkbox">
                                    <label for="ensenanza_hilo_dental" class="promocion-title">🧵 Enseñanza de uso del
                                        hilo dental</label>
                                    <span class="prevencion-badge">A partir de los 6 años</span>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_ensenanza_hilo_dental" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_ensenanza_hilo_dental"
                                        name="fecha_ensenanza_hilo_dental" class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- Autoaplicación de flúor -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="autoaplicacion_fluor" name="prevencion[]"
                                        value="autoaplicacion_fluor" class="promocion-checkbox">
                                    <label for="autoaplicacion_fluor" class="promocion-title">💪 Autoaplicación de
                                        flúor</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_autoaplicacion_fluor" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_autoaplicacion_fluor" name="fecha_autoaplicacion_fluor"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>

                        <!-- Aplicación de barniz de flúor -->
                        <div class="promocion-item">
                            <div class="promocion-header-with-date">
                                <div class="promocion-check-title">
                                    <input type="checkbox" id="barniz_fluor" name="prevencion[]" value="barniz_fluor"
                                        class="promocion-checkbox">
                                    <label for="barniz_fluor" class="promocion-title">🎨 Aplicación de barniz de
                                        flúor</label>
                                </div>
                                <div class="promocion-date-inline">
                                    <label for="fecha_barniz_fluor" class="date-label">Fecha:</label>
                                    <input type="date" id="fecha_barniz_fluor" name="fecha_barniz_fluor"
                                        class="date-input-header">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-outline" id="limpiarPrevencion">
                            <span>🗑️</span> Limpiar Formulario
                        </button>
                        <button type="button" class="btn btn-secondary" id="guardarBorradorPrev">
                            <span>💾</span> Guardar Borrador
                        </button>
                        <button type="submit" class="btn btn-primary" id="guardarPrevencion">
                            <span>✅</span> Guardar Prevención
                        </button>
                    </div>

                    <!-- Historial de Prevención -->
                    <div class="form-section" id="historialPrevencion" style="display: none;">
                        <div class="section-header">
                            <div class="section-icon">📚</div>
                            <div class="section-info">
                                <h3>Historial de Prevención de Enfermedades</h3>
                                <p class="section-description">Actividades de prevención registradas previamente</p>
                            </div>
                        </div>

                        <div id="historialPrevenciones" class="historial-container">
                            <!-- Aquí se mostrarán las prevenciones guardadas -->
                        </div>
                    </div>
                </form>
            </div>

            <!-- TAB: Detección de Enfermedades -->
            <div class="tab-content" id="deteccion">
                <form id="deteccionForm">
                    <!-- Sección: Detección de Enfermedades -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">🔍</div>
                            <div class="section-info">
                                <h3>Detección de Enfermedades</h3>
                                <p class="section-description">Indique qué enfermedades se detectaron o se están
                                    monitoreando</p>
                            </div>
                        </div>

                        <div class="alert alert-warning">
                            <span>⚠️</span>
                            <div><strong>Importante:</strong> La detección temprana de enfermedades es fundamental para
                                un tratamiento oportuno y efectivo.</div>
                        </div>

                        <div class="tamizajes-grid">
                            <!-- Enfermedades Respiratorias -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="enf_respiratorias" name="enfermedades[]"
                                        value="enf_respiratorias" class="tamiz-checkbox">
                                    <label for="enf_respiratorias" class="tamiz-label">🧪 Tamiz metabólico
                                        neonatal</label>
                                </div>
                                <div class="tamiz-details" id="details_enf_respiratorias">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_enf_respiratorias" class="form-label">Fecha de
                                                detección:</label>
                                            <input type="date" id="fecha_enf_respiratorias"
                                                name="fecha_enf_respiratorias" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_enf_respiratorias"
                                                class="form-label">Resultado:</label>
                                            <textarea id="observaciones_enf_respiratorias"
                                                name="observaciones_enf_respiratorias" class="form-input" rows="2"
                                                placeholder="Escriba aquí el resultado específico y observaciones..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enfermedades Gastrointestinales -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="enf_gastrointestinales" name="enfermedades[]"
                                        value="enf_gastrointestinales" class="tamiz-checkbox">
                                    <label for="enf_gastrointestinales" class="tamiz-label">👂 Tamiz auditivo</label>
                                </div>
                                <div class="tamiz-details" id="details_enf_gastrointestinales">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_enf_gastrointestinales" class="form-label">Fecha de
                                                detección:</label>
                                            <input type="date" id="fecha_enf_gastrointestinales"
                                                name="fecha_enf_gastrointestinales" class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_enf_gastrointestinales"
                                                class="form-label">Resultado:</label>
                                            <textarea id="observaciones_enf_gastrointestinales"
                                                name="observaciones_enf_gastrointestinales" class="form-input" rows="2"
                                                placeholder="Escriba aquí el resultado específico y observaciones..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enfermedades de la Piel -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="enf_piel" name="enfermedades[]" value="enf_piel"
                                        class="tamiz-checkbox">
                                    <label for="enf_piel" class="tamiz-label">👁️ Tamiz oftalmológico</label>
                                </div>
                                <div class="tamiz-details" id="details_enf_piel">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_enf_piel" class="form-label">Fecha de detección:</label>
                                            <input type="date" id="fecha_enf_piel" name="fecha_enf_piel"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_enf_piel" class="form-label">Resultado:</label>
                                            <textarea id="observaciones_enf_piel" name="observaciones_enf_piel"
                                                class="form-input" rows="2"
                                                placeholder="Escriba aquí el resultado específico y observaciones..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enfermedades Infecciosas -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="enf_infecciosas" name="enfermedades[]"
                                        value="enf_infecciosas" class="tamiz-checkbox">
                                    <label for="enf_infecciosas" class="tamiz-label">❤️Tamiz cardíaco</label>
                                </div>
                                <div class="tamiz-details" id="details_enf_infecciosas">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_enf_infecciosas" class="form-label">Fecha de
                                                detección:</label>
                                            <input type="date" id="fecha_enf_infecciosas" name="fecha_enf_infecciosas"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_enf_infecciosas"
                                                class="form-label">Resultado:</label>
                                            <textarea id="observaciones_enf_infecciosas"
                                                name="observaciones_enf_infecciosas" class="form-input" rows="2"
                                                placeholder="Escriba aquí el resultado específico y observaciones..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enfermedades Neurológicas -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="enf_neurologicas" name="enfermedades[]"
                                        value="enf_neurologicas" class="tamiz-checkbox">
                                    <label for="enf_neurologicas" class="tamiz-label"> 🦴Tamiz de cadera</label>
                                </div>
                                <div class="tamiz-details" id="details_enf_neurologicas">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="fecha_enf_neurologicas" class="form-label">Fecha de
                                                detección:</label>
                                            <input type="date" id="fecha_enf_neurologicas" name="fecha_enf_neurologicas"
                                                class="form-input">
                                        </div>
                                        <div class="form-group">
                                            <label for="observaciones_enf_neurologicas"
                                                class="form-label">Resultado:</label>
                                            <textarea id="observaciones_enf_neurologicas"
                                                name="observaciones_enf_neurologicas" class="form-input" rows="2"
                                                placeholder="Escriba aquí el resultado específico y observaciones..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Atresia de vias biliares -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="atresia-biliares" name="enfermedades[]"
                                        value="atresia-biliares" class="tamiz-checkbox">
                                    <label for="atresia-biliares" class="tamiz-label">💛 Atresia de vías
                                        biliares</label>
                                </div>
                                <div class="tamiz-details" id="details_atresia-biliares">
                                    <div class="atresia-container">
                                        <div class="registros-atresia" id="registros_atresia">
                                            <!-- Aquí se agregarán los registros -->

                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label class="form-label">Fecha de detección:</label>
                                                    <input type="date" name="fecha_atresia[]"
                                                        class="form-input fecha-atresia" data-registro="${registroId}"
                                                        required>
                                                    <small class="error-message"
                                                        style="color: #e74c3c; font-size: 12px; display: none;"></small>
                                                </div>
                                                <div class="radio-group">
                                                    <div class="radio-item ">
                                                        <input type="radio" id="atresianormal" name="tipoatresia"
                                                            value="normal" class="radio-input" required>
                                                        <label for="atresianormal" class="radio-label">Normal</label>
                                                    </div>

                                                    <div class="radio-item">
                                                        <input type="radio" id="atresiaanormal" name="tipoatresia"
                                                            value="anormal" class="radio-input" required>
                                                        <label for="atresiaanormal" class="radio-label">Anormal</label>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Detección de defectos de agudeza visual -->
                            <div class="tamiz-item">
                                <div class="tamiz-header">
                                    <input type="checkbox" id="agudeza_visual" name="enfermedades[]"
                                        value="agudeza_visual" class="tamiz-checkbox">
                                    <label for="agudeza_visual" class="tamiz-label">👁️ Detección de defectos de agudeza
                                        visual (4 a 6 años)</label>
                                </div>
                                <div class="tamiz-details" id="details_agudeza_visual">
                                    <div class="agudeza-visual-container">
                                        <div class="registros-agudeza" id="registros_agudeza">
                                            <!-- Aquí se agregarán los registros -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-outline" id="limpiarDeteccion">
                            <span>🗑️</span> Limpiar Formulario
                        </button>
                        <button type="button" class="btn btn-secondary" id="guardarBorradorDet">
                            <span>💾</span> Guardar Borrador
                        </button>
                        <button type="submit" class="btn btn-primary" id="guardarDeteccion">
                            <span>✅</span> Guardar Detección
                        </button>
                    </div>

                    <!-- Historial de Detección -->
                    <div class="form-section" id="historialDeteccion" style="display: none;">
                        <div class="section-header">
                            <div class="section-icon">📚</div>
                            <div class="section-info">
                                <h3>Historial de Detección de Enfermedades</h3>
                                <p class="section-description">Enfermedades detectadas registradas previamente</p>
                            </div>
                        </div>

                        <div id="historialDetecciones" class="historial-container">
                            <!-- Aquí se mostrarán las detecciones guardadas -->
                        </div>
                    </div>
                </form>
            </div>

            <!--TAB: Derivaciones-->
            <div class="tab-content" id="derivacion">
                <form id="derivacionForm">
                    <div id="alertContainer"></div>

                    <!-- SECCIÓN: Tipo de Derivación -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon">📋</div>
                            <div class="section-info">
                                <h3>Tipo de Derivación</h3>
                                <p class="section-description">Seleccione el tipo de derivación médica a realizar</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="tipoDerivacion">Seleccione el tipo de derivación <span
                                    class="required">*</span></label>
                            <select id="tipoDerivacion" name="tipoDerivacion" required>
                                <option value="">-- Seleccione una opción --</option>
                                <option value="4.30.200">Derivación a través de 4.30.200</option>
                                <option value="4.30.8">Derivación a través de 4.30.8</option>
                            </select>
                        </div>
                    </div>

                    <!-- SECCIÓN: Motivo de Derivación -->
                    <div class="form-section">
                        <div class="section-header" style="border-bottom: 2px solid #e67e22;">
                            <div class="section-icon" style="background: linear-gradient(135deg, #e67e22, #f39c12);">🎯
                            </div>
                            <div class="section-info">
                                <h3 style="color: #e67e22;">Motivo de Derivación</h3>
                                <p class="section-description">Especifique la razón médica para la derivación</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="motivoDerivacion">Seleccione el motivo <span class="required">*</span></label>
                            <select id="motivoDerivacion" name="motivoDerivacion" disabled required>
                                <option value="">-- Primero seleccione el tipo de derivación --</option>
                            </select>
                        </div>
                    </div>

                    <!-- SECCIÓN: Especialista para Derivar -->
                    <div class="form-section">
                        <div class="section-header" style="border-bottom: 2px solid #27ae60;">
                            <div class="section-icon" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                                👨‍⚕️</div>
                            <div class="section-info">
                                <h3 style="color: #27ae60;">Derivar con</h3>
                                <p class="section-description">Seleccione el área o especialista de destino</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="especialista">Seleccione el especialista <span class="required">*</span></label>
                            <select id="especialista" name="especialista" required>
                                <option value="">-- Seleccione una opción --</option>
                                <option value="centro_seguridad_social">Centro de Seguridad Social</option>
                                <option value="enfermera_geriatria">Enfermera Especialista en Geriatría</option>
                                <option value="enfermera_medicina_familiar">Enfermera Especialista en Medicina de
                                    Familia</option>
                                <option value="estomatologia">Estomatología</option>
                                <option value="medico_familiar">Médico Familiar</option>
                                <option value="nutricion_dietetica">Nutrición y Dietética</option>
                                <option value="otros">Otros</option>
                                <option value="planificacion_familiar">Planificación Familiar</option>
                                <option value="prevenimss">PREVENIMSS</option>
                                <option value="trabajo_social">Trabajo Social</option>
                            </select>
                        </div>
                    </div>


                    <!-- Botones de Acción -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-outline" id="limpiarDerivacion">
                            <span>🗑️</span> Limpiar Formulario
                        </button>
                        <button type="button" class="btn btn-secondary" id="guardarBorradorDer">
                            <span>💾</span> Guardar Borrador
                        </button>
                        <button type="submit" class="btn btn-primary" id="guardarDerivacion">
                            <span>✅</span> Guardar Derivación
                        </button>
                    </div>

                    <!-- Historial de Derivaciones -->
                    <div class="form-section" id="historialDerivaciones" style="display: none;">
                        <div class="section-header">
                            <div class="section-icon">📚</div>
                            <div class="section-info">
                                <h3>Historial de Derivaciones</h3>
                                <p class="section-description">Derivaciones médicas registradas previamente</p>
                            </div>
                        </div>

                        <div id="historialDerivacionesContainer" class="historial-container">
                            <!-- Aquí se mostrarán las derivaciones guardadas -->
                        </div>
                    </div>
                </form>
            </div>


            <script>

                // Funcionalidad de pestañas
                document.addEventListener('DOMContentLoaded', function () {
                    const tabButtons = document.querySelectorAll('.tab-btn');
                    const tabContents = document.querySelectorAll('.tab-content');

                    tabButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            const targetTab = this.getAttribute('data-tab');
                            // Remover clase active de todos los botones y contenidos
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            tabContents.forEach(content => content.classList.remove('active'));
                            // Agregar clase active al botón clickeado y su contenido correspondiente
                            this.classList.add('active');
                            document.getElementById(targetTab).classList.add('active');
                        });
                    });

                    // Funcionalidad para checkboxes de promoción
                    const promocionCheckboxes = document.querySelectorAll('.promocion-checkbox');
                    promocionCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            const parentItem = this.closest('.promocion-item');
                            const dateGroup = parentItem.querySelector('.promocion-date-group');
                            if (this.checked) {
                                parentItem.classList.add('selected');
                                dateGroup.classList.add('show');
                            } else {
                                parentItem.classList.remove('selected');
                                dateGroup.classList.remove('show');
                                // Limpiar la fecha cuando se desmarca
                                const dateInput = dateGroup.querySelector('.date-input');
                                if (dateInput) {
                                    dateInput.value = '';
                                }
                            }
                        });
                    });

                    // Funcionalidad para checkboxes normales
                    const checkboxItems = document.querySelectorAll('.checkbox-item');
                    checkboxItems.forEach(item => {
                        const checkbox = item.querySelector('.checkbox-input');
                        if (checkbox) {
                            checkbox.addEventListener('change', function () {
                                if (this.checked) {
                                    item.classList.add('checked');
                                } else {
                                    item.classList.remove('checked');
                                }
                            });
                        }
                    });

                    // Funcionalidad del selector de edad
                    const edadSelector = document.getElementById('edad_nino');
                    const ageQuestionsSections = document.querySelectorAll('.age-questions-section');
                    const noAgeMessage = document.getElementById('no-age-message');

                    edadSelector?.addEventListener('change', function () {
                        const selectedAge = this.value;
                        // Ocultar todas las secciones de preguntas
                        ageQuestionsSections.forEach(section => {
                            section.style.display = 'none';
                        });

                        if (selectedAge) {
                            // Ocultar mensaje de "no edad seleccionada"
                            noAgeMessage.style.display = 'none';
                            // Mostrar la sección correspondiente a la edad seleccionada
                            const targetSection = document.getElementById(`questions-${selectedAge}`);
                            if (targetSection) {
                                targetSection.style.display = 'block';
                            }
                        } else {
                            // Mostrar mensaje de "no edad seleccionada"
                            noAgeMessage.style.display = 'block';
                        }
                    });

                    // Funcionalidad para radio buttons de desarrollo
                    const radioItems = document.querySelectorAll('.radio-item');
                    radioItems.forEach(item => {
                        const radio = item.querySelector('.radio-input');
                        if (radio) {
                            radio.addEventListener('change', function () {
                                // Remover clase selected de todos los radio items del mismo grupo
                                const groupName = this.name;
                                const sameGroupItems = document.querySelectorAll(`input[name="${groupName}"]`);
                                sameGroupItems.forEach(groupRadio => {
                                    const parentItem = groupRadio.closest('.radio-item');
                                    if (parentItem) {
                                        parentItem.classList.remove('selected');
                                    }
                                });
                                // Agregar clase selected al item actual
                                item.classList.add('selected');
                            });
                        }
                    });

                    // Funcionalidad para tamizajes
                    const tamizCheckboxes = document.querySelectorAll('.tamiz-checkbox');
                    tamizCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            const tamizItem = this.closest('.tamiz-item');
                            const details = tamizItem.querySelector('.tamiz-details');
                            if (this.checked) {
                                tamizItem.classList.add('selected');
                                details.classList.add('show');
                            } else {
                                tamizItem.classList.remove('selected');
                                details.classList.remove('show');
                                // Limpiar campos cuando se desmarca
                                const dateInput = details.querySelector('input[type="date"]');
                                const textArea = details.querySelector('textarea');
                                if (dateInput) dateInput.value = '';
                                if (textArea) textArea.value = '';
                            }
                        });
                    });

                    // Funcionalidad de botones de limpiar
                    document.getElementById('limpiarAntecedentes')?.addEventListener('click', function () {
                        if (confirm('¿Está seguro de que desea limpiar todos los campos del formulario de antecedentes?')) {
                            document.getElementById('antecedentesForm').reset();
                            // Remover clases checked de los checkboxes
                            document.querySelectorAll('#antecedentes .checkbox-item').forEach(item => {
                                item.classList.remove('checked');
                            });
                            // Remover clases selected de tamizajes
                            document.querySelectorAll('#antecedentes .tamiz-item').forEach(item => {
                                item.classList.remove('selected');
                                const details = item.querySelector('.tamiz-details');
                                if (details) details.classList.remove('show');
                            });
                        }
                    });

                    document.getElementById('limpiarPromocion')?.addEventListener('click', function () {
                        if (confirm('¿Está seguro de que desea limpiar todos los campos del formulario de promoción?')) {
                            limpiarFormularioPromocion();


                        }
                    });

                    document.getElementById('limpiarDesarrollo')?.addEventListener('click', function () {
                        if (confirm('¿Está seguro de que desea limpiar todos los campos del formulario de desarrollo?')) {
                            // Limpiar campos básicos
                            document.getElementById('fecha_evaluacion_desarrollo').value = '';
                            // Resetear selector de edad
                            document.getElementById('edad_nino').value = '';
                            // Ocultar todas las secciones de preguntas y mostrar mensaje por defecto
                            ageQuestionsSections.forEach(section => {
                                section.style.display = 'none';
                            });
                            noAgeMessage.style.display = 'block';
                            // Limpiar todos los radio buttons y remover clases selected
                            document.querySelectorAll('#desarrollo .radio-input').forEach(radio => {
                                radio.checked = false;
                            });
                            document.querySelectorAll('#desarrollo .radio-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                        }
                    });

                    // Funcionalidad de botones de guardar
                    document.getElementById('guardarAntecedentes')?.addEventListener('click', function (e) {
                        e.preventDefault();
                        alert('Antecedentes guardados correctamente');
                    });

                    document.getElementById('guardarPromocion')?.addEventListener('click', function (e) {
                        e.preventDefault();
                        guardarPromocionesAlHistorial();
                    });

                    document.getElementById('guardarDesarrollo')?.addEventListener('click', function () {
                        alert('Datos de desarrollo infantil guardados correctamente');
                    });

                    // Funcionalidad de borradores
                    document.getElementById('guardarBorradorAnt')?.addEventListener('click', function () {
                        alert('Borrador de antecedentes guardado');
                    });

                    document.getElementById('guardarBorradorProm')?.addEventListener('click', function () {
                        alert('Borrador de promoción guardado');
                    });

                    document.getElementById('guardarBorradorDes')?.addEventListener('click', function () {
                        alert('Borrador de desarrollo guardado');
                    });

                    // Funcionalidad de agregar otros
                    document.getElementById('agregarOtro')?.addEventListener('click', function () {
                        const select = document.getElementById('otrosSelect');
                        const fecha = document.getElementById('fecha_otros').value;
                        const container = document.getElementById('otrosAgregados');
                        const texto = select.options[select.selectedIndex].text;
                        const valor = select.value;

                        if (!valor || !fecha) {
                            alert('Por favor selecciona una acción y una fecha.');
                            return;
                        }

                        const nuevoItem = document.createElement('div');
                        nuevoItem.classList.add('promocion-item', 'selected');
                        nuevoItem.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <strong>${texto}</strong><br>
                            <span style="color:#7f8c8d;">Fecha: ${fecha}</span>
                        </div>
                        <button type="button" class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="this.parentElement.parentElement.remove()">🗑️</button>
                    </div>
                `;
                        container.appendChild(nuevoItem);

                        // Limpiar selección
                        select.selectedIndex = 0;
                        document.getElementById('fecha_otros').value = '';
                    });
                });

                // Funciones corregidas para el historial de promociones

                function guardarPromocionesAlHistorial() {
                    const estadoCartilla = document.getElementById('estadoCartilla').value;
                    const estadoCartillaTexto = document.getElementById('estadoCartilla').options[document.getElementById('estadoCartilla').selectedIndex].text;

                    if (!estadoCartilla) {
                        alert('Por favor seleccione el estado de la Cartilla Nacional de Salud');
                        return;
                    }

                    let promocionesSeleccionadas = [];

                    // Obtener promociones principales seleccionadas (NUEVA ESTRUCTURA)
                    const promocionesCheckboxes = document.querySelectorAll('.promocion-checkbox');
                    promocionesCheckboxes.forEach(checkbox => {
                        if (checkbox.checked && checkbox.id !== 'otros') {
                            // Buscar el item padre
                            const parentItem = checkbox.closest('.promocion-item');

                            // Obtener el texto del label
                            const labelElement = parentItem.querySelector('.promocion-title');
                            const label = labelElement ? labelElement.textContent : '';

                            // Buscar el input de fecha correspondiente
                            const dateInput = parentItem.querySelector('.date-input-header');
                            const fecha = dateInput ? dateInput.value : '';

                            if (fecha) {
                                promocionesSeleccionadas.push({
                                    titulo: label,
                                    fecha: fecha,
                                    estadoCartilla: estadoCartillaTexto
                                });
                            }
                        }
                    });

                    // Obtener promociones de "otros" agregadas (esta parte sigue igual)
                    const otrosAgregados = document.getElementById('otrosAgregados').children;
                    for (let item of otrosAgregados) {
                        const texto = item.querySelector('strong').textContent;
                        const fechaTexto = item.querySelector('span').textContent.replace('Fecha: ', '');

                        promocionesSeleccionadas.push({
                            titulo: `📋 ${texto}`,
                            fecha: fechaTexto,
                            estadoCartilla: estadoCartillaTexto
                        });
                    }

                    if (promocionesSeleccionadas.length === 0) {
                        alert('Por favor seleccione al menos una actividad de promoción con su fecha');
                        return;
                    }

                    // Agregar al historial
                    promocionesSeleccionadas.forEach(promocion => {
                        agregarAlHistorialPromocion(promocion);
                    });

                    // Limpiar formulario después de guardar
                    limpiarFormularioPromocion();

                    alert(`${promocionesSeleccionadas.length} actividad(es) de promoción guardada(s) correctamente`);

                    // Mostrar sección de historial
                    document.getElementById('historialPromocion').style.display = 'block';
                }

                function limpiarFormularioPromocion() {
                    // Limpiar estado de cartilla
                    document.getElementById('estadoCartilla').value = '';

                    // Desmarcar checkboxes y limpiar fechas (NUEVA ESTRUCTURA)
                    document.querySelectorAll('.promocion-item').forEach(item => {
                        const checkbox = item.querySelector('.promocion-checkbox');
                        const dateInput = item.querySelector('.date-input-header');

                        if (checkbox) checkbox.checked = false;
                        if (dateInput) dateInput.value = '';
                        item.classList.remove('selected');
                    });

                    // Limpiar otros agregados
                    document.getElementById('otrosAgregados').innerHTML = '';
                    document.getElementById('otrosSelect').selectedIndex = 0;
                    document.getElementById('fecha_otros').value = '';
                    document.getElementById('otros').checked = false;
                }

                // Actualizar los event listeners para la nueva estructura
                document.addEventListener('DOMContentLoaded', function () {

                    // Event listener corregido para checkboxes de promoción
                    const promocionCheckboxes = document.querySelectorAll('.promocion-checkbox');
                    promocionCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            const parentItem = this.closest('.promocion-item');

                            if (this.checked) {
                                parentItem.classList.add('selected');
                            } else {
                                parentItem.classList.remove('selected');
                                // Limpiar la fecha cuando se desmarca
                                const dateInput = parentItem.querySelector('.date-input-header');
                                if (dateInput) {
                                    dateInput.value = '';
                                }
                            }
                        });
                    });
                });

                // Las demás funciones permanecen iguales
                function agregarAlHistorialPromocion(promocion) {
                    const container = document.getElementById('historialPromociones');

                    const historialItem = document.createElement('div');
                    historialItem.classList.add('historial-item');
                    historialItem.innerHTML = `
        <div class="historial-content">
            
            <div class="historial-title">${promocion.titulo}</div>
            <div class="historial-fecha">📅 Fecha: ${promocion.fecha}</div>
        </div>
    `;

                    container.appendChild(historialItem);
                }

                function eliminarDelHistorial(button) {
                    if (confirm('¿Está seguro de eliminar esta actividad del historial?')) {
                        button.parentElement.remove();

                        // Ocultar sección de historial si no hay elementos
                        const container = document.getElementById('historialPromociones');
                        if (container.children.length === 0) {
                            document.getElementById('historialPromocion').style.display = 'none';
                        }
                    }
                }

                function limpiarFormularioPromocion() {
                    // Limpiar estado de cartilla
                    document.getElementById('estadoCartilla').value = '';

                    // Desmarcar y ocultar fechas de promociones principales
                    document.querySelectorAll('.promocion-item').forEach(item => {
                        const checkbox = item.querySelector('.promocion-checkbox');
                        const dateGroup = item.querySelector('.promocion-date-group');
                        const dateInput = item.querySelector('.date-input');

                        if (checkbox) checkbox.checked = false;
                        if (dateGroup) dateGroup.classList.remove('show');
                        if (dateInput) dateInput.value = '';
                        item.classList.remove('selected');
                    });

                    // Limpiar otros agregados
                    document.getElementById('otrosAgregados').innerHTML = '';
                    document.getElementById('otrosSelect').selectedIndex = 0;
                    document.getElementById('fecha_otros').value = '';
                    document.getElementById('otros').checked = false;
                }

                // Opciones que tienen información adicional
                const opcionesConInfo = [
                    'prevencion-adicciones',
                    'consejos-crianza-salud-mental',
                    'higiene-sueno',
                    'prevencion-acoso-escolar',
                    'prevencion-colapso-cuidador',
                    'prevencion-posvencion',
                    'tecnicas-relajacion-olvidos',
                    'tecnicas-relajacion-irritabilidad',
                    'tecnicas-relajacion-ansiedad',
                    'orientacion-emociones-depresion',
                    'prevencion-autolesion-suicida',
                    'mejoramiento-conducta-comportamiento',
                    'resolucion-problemas-familiar'
                ];

                // Información para cada opción
                const informacionOpciones = {
                    'prevencion-adicciones': {
                        titulo: 'Prevención de adicciones',
                        contenido: `
            <div class="contenido-formato">
    <div class="contenido-card">
        <p class="texto-destacado">
            <strong>Estimado papá, estimada mamá:</strong> De mucho amor, atención y tiempo de calidad a su hijo.
        </p>
        
        <div class="punto-clave">
            <span class="icono-punto">🛡️</span>
            <p>Los niños que se sienten queridos y seguros tienen menos probabilidades de buscar consuelo en otras cosas más adelante.</p>
        </div>
        
        <div class="punto-clave">
            <span class="icono-punto">🎯</span>
            <p>Juegue con él, lean cuentos juntos y ayúdale a expresar sus emociones.</p>
        </div>
        
        
            <span class="icono-corazon">💖</span>
            <strong>¡Su amor es su mejor protección!</strong>
    </div>
</div>
        `
                    },
                    'prevencion-acoso-escolar': {
                        titulo: 'Prevención de acoso escolar',
                        contenido: `
        <div class="contenido-formato">
    
    <div class="introduccion-importante">
        <div class="alerta-info">
            <span class="icono-alerta">⚠️</span>
            <p><strong>El acoso escolar no es un problema que deba esperar a la adolescencia.</strong> Se manifiesta desde edades tempranas, y es nuestra responsabilidad como adultos, ya seamos padres, maestros o cuidadores, reconocerlo y actuar. La prevención del acoso en niños de preescolar hasta los 9 años es fundamental para construir una base sólida de respeto y empatía.</p>
        </div>
    </div>
    
    <div class="pregunta-central">
        <h5>🤔 ¿Cómo podemos lograrlo?</h5>
    </div>
    
    <div class="estrategias-container">
        <div class="estrategia-card">
            <div class="estrategia-header">
                <span class="icono-estrategia">❤️</span>
                <h6>Fomentando la Empatía</h6>
            </div>
            <p>Hablemos con los niños sobre los sentimientos de los demás. Preguntemos: <span class="pregunta-ejemplo">"¿Cómo crees que se siente tu amigo cuando le quitan un juguete?"</span>. Esto les ayuda a ponerse en el lugar del otro.</p>
        </div>
        
        <div class="estrategia-card">
            <div class="estrategia-header">
                <span class="icono-estrategia">👥</span>
                <h6>Modelando un Comportamiento Respetuoso</h6>
            </div>
            <p>Los niños aprenden lo que ven. Seamos un ejemplo de respeto, amabilidad y resolución pacífica de conflictos en nuestras propias interacciones.</p>
        </div>
        
        <div class="estrategia-card">
            <div class="estrategia-header">
                <span class="icono-estrategia">📋</span>
                <h6>Estableciendo Reglas Claras</h6>
            </div>
            <p>Expliquemos que no está permitido agredir, insultar o excluir a nadie. Reforcemos positivamente el buen comportamiento y hablemos de las consecuencias de las acciones negativas.</p>
        </div>
        
        <div class="estrategia-card">
            <div class="estrategia-header">
                <span class="icono-estrategia">💬</span>
                <h6>Promoviendo la Comunicación Abierta</h6>
            </div>
            <p>Creemos un espacio donde los niños se sientan seguros para contarnos si alguien los está molestando o si ven que a otro niño le hacen daño. Escuchemos sin juzgar y actuemos de inmediato.</p>
        </div>
    </div>
    
    <div class="conclusion">
        <div class="mensaje-motivacional">
            <span class="icono-estrella">⭐</span>
            <p><strong>Al tomar estas medidas, no solo prevenimos el acoso, sino que estamos cultivando un ambiente de respeto y seguridad.</strong> Les estamos enseñando a nuestros hijos a ser defensores, no agresores, y a valorar la importancia de un trato digno para todos.</p>
        </div>
    </div>
</div>


        `
                    },
                    // Agregar más información para las otras opciones según sea necesario
                    'higiene-sueno': {
                        titulo: 'Higiene del sueño',
                        contenido: `
            <div class="contenido-formato">  
    <div class="introduccion">
        <p><em>A esta edad, puedes hacer la actividad más participativa, dándole al niño un poco más de control.</em></p>
    </div>
    
    <div class="actividades-container">
        <div class="actividad-card">
            <div class="actividad-header">
                <span class="icono-actividad">📖</span>
                <h5>Crea un "Pasaporte del Sueño"</h5>
            </div>
            <p>Haz un pequeño librillo o una cartulina dividida en casillas. Cada casilla representa un paso de la rutina: <span class="highlight">"cena ligera"</span>, <span class="highlight">"baño"</span>, <span class="highlight">"pijama"</span>, <span class="highlight">"lavarse los dientes"</span>, <span class="highlight">"cuento"</span>. Puedes pedirle al niño que coloree o ponga una calcomanía en la casilla de cada paso que completen.</p>
        </div>
        
        <div class="actividad-card">
            <div class="actividad-header">
                <span class="icono-actividad">⏳</span>
                <h5>Usa el Reloj de Arena</h5>
            </div>
            <p>Explícale que, después de un tiempo específico (por ejemplo, 15 minutos), las <span class="highlight">"aventuras"</span> del día deben terminar. El reloj de arena visualiza el tiempo y ayuda a que la transición sea más fácil.</p>
        </div>
        
        <div class="actividad-card">
            <div class="actividad-header">
                <span class="icono-actividad">📚</span>
                <h5>Elige el Cuento</h5>
            </div>
            <p>Permite que el niño elija el cuento que leerán juntos. Esto le da un sentido de autonomía y hace que el momento de la lectura sea más placentero.</p>
        </div>
    </div>
</div>  
        `
                    }
                };

                // Función para mostrar el botón de información
                function mostrarBotonInfo(valor) {
                    const container = document.querySelector('#otrosPromocion .age-selector-section');
                    const botonExistente = document.getElementById('btnMasInfo');

                    // Remover botón existente si lo hay
                    if (botonExistente) {
                        botonExistente.remove();
                    }

                    // Agregar botón si la opción tiene información
                    if (opcionesConInfo.includes(valor)) {
                        const boton = document.createElement('button');
                        boton.type = 'button';
                        boton.id = 'btnMasInfo';
                        boton.className = 'btn-info';
                        boton.innerHTML = 'ℹ️ Más información';
                        boton.onclick = () => mostrarPopup(valor);
                        container.appendChild(boton);
                    }
                }

                // Función para mostrar el popup
                function mostrarPopup(valor) {
                    const info = informacionOpciones[valor];
                    if (info) {
                        document.getElementById('popupTitle').textContent = info.titulo;
                        document.getElementById('popupBody').innerHTML = info.contenido;
                        document.getElementById('infoPopup').style.display = 'flex';
                    }
                }

                // Función para cerrar el popup
                function cerrarPopup() {
                    document.getElementById('infoPopup').style.display = 'none';
                }

                // Cerrar popup al hacer clic fuera de él
                document.getElementById('infoPopup').addEventListener('click', function (e) {
                    if (e.target === this) {
                        cerrarPopup();
                    }
                });

                // Modificar el event listener del select para mostrar/ocultar el botón
                document.addEventListener('DOMContentLoaded', function () {
                    const otrosSelect = document.getElementById('otrosSelect');
                    if (otrosSelect) {
                        otrosSelect.addEventListener('change', function () {
                            mostrarBotonInfo(this.value);
                        });
                    }
                });

                // Variables para conteo
                let contadores = {
                    si: 0,
                    no: 0,
                    ausente: 0,
                    presente: 0
                };

                // Función para contar respuestas
                function contarRespuestas() {
                    const edadSeleccionada = document.getElementById('edad_nino').value;

                    if (!edadSeleccionada) {
                        document.getElementById('semaforoDesarrollo').style.display = 'none';
                        return;
                    }

                    // Resetear contadores
                    contadores = { si: 0, no: 0, ausente: 0, presente: 0 };

                    // Obtener todas las respuestas de la edad seleccionada
                    const seccionActual = document.getElementById(`questions-${edadSeleccionada}`);
                    if (!seccionActual) return;

                    // Contar respuestas en categorías normales (motor, lenguaje, social, conocimiento)
                    const preguntasNormales = seccionActual.querySelectorAll('.motor-category .radio-input:checked, .lenguaje-category .radio-input:checked, .social-category .radio-input:checked, .conocimiento-category .radio-input:checked');

                    preguntasNormales.forEach(radio => {
                        if (radio.value === 'si') contadores.si++;
                        if (radio.value === 'no') contadores.no++;
                    });

                    // Contar respuestas en signos de alarma
                    const preguntasAlarma = seccionActual.querySelectorAll('.alarma-category .radio-input:checked');

                    preguntasAlarma.forEach(radio => {
                        if (radio.value === 'ausente') contadores.ausente++;
                        if (radio.value === 'presente') contadores.presente++;
                    });

                    // Actualizar contadores en la interfaz
                    document.getElementById('conteoSi').textContent = contadores.si;
                    document.getElementById('conteoNo').textContent = contadores.no;
                    document.getElementById('conteoAusente').textContent = contadores.ausente;
                    document.getElementById('conteoPresente').textContent = contadores.presente;

                    // Mostrar semáforo
                    document.getElementById('semaforoDesarrollo').style.display = 'block';

                    // Determinar resultado
                    determinarResultadoSemaforo();
                }

                // Función para determinar el resultado del semáforo
                function determinarResultadoSemaforo() {
                    // Ocultar todas las luces
                    document.querySelectorAll('.semaforo-luz').forEach(luz => {
                        luz.classList.remove('activa');
                    });

                    // Lógica del semáforo
                    if (contadores.presente > 0) {
                        // ROJO: Tiene uno o más signos de alarma presentes
                        document.getElementById('luzRojo').classList.add('activa');
                    } else if (contadores.no > 0) {
                        // AMARILLO: No hace algún ítem, pero sin signos de alarma
                        document.getElementById('luzAmarillo').classList.add('activa');
                    } else if (contadores.si > 0 && contadores.presente === 0) {
                        // VERDE: Todo sí lo hace sin signos de alarma
                        document.getElementById('luzVerde').classList.add('activa');
                    } else {
                        // No hay suficientes respuestas para evaluar
                        document.getElementById('semaforoDesarrollo').style.display = 'none';
                    }
                }

                // Función para recalcular
                function recalcularSemaforo() {
                    contarRespuestas();
                }

                // Event listeners para respuestas
                document.addEventListener('DOMContentLoaded', function () {
                    // Agregar listeners a todos los radio buttons de desarrollo
                    document.addEventListener('change', function (e) {
                        if (e.target.classList.contains('radio-input') &&
                            e.target.closest('.age-questions-section')) {
                            contarRespuestas();
                        }
                    });

                    // Listener para cambio de edad
                    const edadSelector = document.getElementById('edad_nino');
                    if (edadSelector) {
                        edadSelector.addEventListener('change', function () {
                            setTimeout(() => {
                                contarRespuestas();
                            }, 100);
                        });
                    }
                });

                // Función modificada para agregar al historial con múltiples fechas
                function agregarAlHistorialPromocion(promocion) {
                    const container = document.getElementById('historialPromociones');

                    // Buscar si ya existe una actividad con el mismo título
                    const actividadExistente = Array.from(container.children).find(item => {
                        const titulo = item.querySelector('.historial-title').textContent;
                        return titulo === promocion.titulo;
                    });

                    if (actividadExistente) {
                        // Si existe, agregar la fecha al contenedor de fechas
                        agregarFechaAActividad(actividadExistente, promocion.fecha);
                    } else {
                        // Si no existe, crear nueva actividad
                        crearNuevaActividadHistorial(promocion);
                    }
                }

                // Función modificada para crear una nueva actividad en el historial (versión compacta)
                function crearNuevaActividadHistorial(promocion) {
                    const container = document.getElementById('historialPromociones');

                    const historialItem = document.createElement('div');
                    historialItem.classList.add('historial-item');
                    historialItem.innerHTML = `
        <div class="historial-content">
            <div class="actividad-info">
                <div class="actividad-titulo">
                    <span class="historial-title">${promocion.titulo}</span>
                    <span class="fechas-contador">1</span>
                </div>
                <div class="fechas-scroll-compacto">
                    <div class="fecha-item-compacto">${promocion.fecha}</div>
                </div>
            </div>
        </div>
        <div class="historial-actions">
        </div>
    `;

                    container.appendChild(historialItem);
                }

                // Función modificada para agregar fecha a una actividad existente (versión compacta)
                function agregarFechaAActividad(actividadItem, nuevaFecha) {
                    const fechasScroll = actividadItem.querySelector('.fechas-scroll-compacto');
                    const contador = actividadItem.querySelector('.fechas-contador');

                    // Verificar que la fecha no esté duplicada
                    const fechasExistentes = Array.from(fechasScroll.children).map(item => item.textContent.replace('×', '').trim());
                    if (fechasExistentes.includes(nuevaFecha)) {
                        alert('Esta fecha ya está registrada para esta actividad');
                        return;
                    }

                    // Crear nuevo elemento de fecha
                    const fechaItem = document.createElement('div');
                    fechaItem.classList.add('fecha-item-compacto');
                    fechaItem.innerHTML = `
        ${nuevaFecha}
    `;

                    fechasScroll.appendChild(fechaItem);

                    // Actualizar contador
                    const totalFechas = fechasScroll.children.length;
                    contador.textContent = totalFechas;

                    // Hacer scroll automático al final
                    fechasScroll.scrollTop = fechasScroll.scrollHeight;
                }

                // Función para eliminar una fecha específica (actualizada para versión compacta)
                function eliminarFecha(button) {
                    if (confirm('¿Está seguro de eliminar esta fecha?')) {
                        const fechaItem = button.parentElement;
                        const fechasScroll = fechaItem.parentElement;
                        const contador = fechasScroll.parentElement.querySelector('.fechas-contador');

                        fechaItem.remove();

                        // Actualizar contador
                        const totalFechas = fechasScroll.children.length;
                        contador.textContent = totalFechas;

                        // Si no quedan fechas, eliminar toda la actividad
                        if (totalFechas === 0) {
                            const actividadCompleta = fechasScroll.closest('.historial-item');
                            actividadCompleta.remove();

                            // Ocultar sección de historial si no hay elementos
                            const container = document.getElementById('historialPromociones');
                            if (container.children.length === 0) {
                                document.getElementById('historialPromocion').style.display = 'none';
                            }
                        }
                    }
                }
                // Función modificada para eliminar del historial (elimina toda la actividad)
                function eliminarDelHistorial(button) {
                    if (confirm('¿Está seguro de eliminar esta actividad completa con todas sus fechas?')) {
                        const historialItem = button.closest('.historial-item');
                        historialItem.remove();

                        // Ocultar sección de historial si no hay elementos
                        const container = document.getElementById('historialPromociones');
                        if (container.children.length === 0) {
                            document.getElementById('historialPromocion').style.display = 'none';
                        }
                    }
                }

                document.addEventListener('DOMContentLoaded', function () {

                    // Funcionalidad para checkboxes de antecedentes (similar a promoción)
                    const antecedentesCheckboxes = document.querySelectorAll('#antecedentes .promocion-checkbox');
                    antecedentesCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            const parentItem = this.closest('.promocion-item');
                            const dateInput = parentItem.querySelector('.date-input-header');

                            if (this.checked) {
                                parentItem.classList.add('selected');
                                // Opcional: enfocar el campo de fecha cuando se marca el checkbox
                                if (dateInput) {
                                    dateInput.focus();
                                }
                            } else {
                                parentItem.classList.remove('selected');
                                // Limpiar la fecha cuando se desmarca
                                if (dateInput) {
                                    dateInput.value = '';
                                }
                            }
                        });
                    });

                    // Actualizar la función de limpiar antecedentes para incluir estos nuevos campos
                    const limpiarAntecedentesBtn = document.getElementById('limpiarAntecedentes');
                    if (limpiarAntecedentesBtn) {
                        limpiarAntecedentesBtn.addEventListener('click', function () {
                            if (confirm('¿Está seguro de que desea limpiar todos los campos del formulario de antecedentes?')) {
                                document.getElementById('antecedentesForm').reset();

                                // Remover clases checked de los checkboxes
                                document.querySelectorAll('#antecedentes .checkbox-item').forEach(item => {
                                    item.classList.remove('checked');
                                });

                                // Remover clases selected de tamizajes
                                document.querySelectorAll('#antecedentes .tamiz-item').forEach(item => {
                                    item.classList.remove('selected');
                                    const details = item.querySelector('.tamiz-details');
                                    if (details) details.classList.remove('show');
                                });

                                // Limpiar nuevos campos de checkbox con fecha
                                document.querySelectorAll('#antecedentes .promocion-item').forEach(item => {
                                    item.classList.remove('selected');
                                    const checkbox = item.querySelector('.promocion-checkbox');
                                    const dateInput = item.querySelector('.date-input-header');
                                    if (checkbox) checkbox.checked = false;
                                    if (dateInput) dateInput.value = '';
                                });
                            }
                        });
                    }

                    // Función para obtener datos de antecedentes (incluyendo nuevos campos)
                    function obtenerDatosAntecedentes() {
                        const datos = {};

                        // Datos básicos del formulario
                        const formData = new FormData(document.getElementById('antecedentesForm'));
                        for (let [key, value] of formData.entries()) {
                            datos[key] = value;
                        }

                        // Datos específicos de checkbox con fecha
                        const profilaxisCheckbox = document.getElementById('profilaxisOftalmica');
                        const profilaxisFecha = document.getElementById('fecha_profilaxis_oftalmica');
                        if (profilaxisCheckbox && profilaxisCheckbox.checked) {
                            datos.profilaxis_oftalmica = {
                                aplicada: true,
                                fecha: profilaxisFecha.value
                            };
                        }

                        const vitaminaCheckbox = document.getElementById('vitaminaK');
                        const vitaminaFecha = document.getElementById('fecha_vitamina_k');
                        if (vitaminaCheckbox && vitaminaCheckbox.checked) {
                            datos.vitamina_k = {
                                aplicada: true,
                                fecha: vitaminaFecha.value
                            };
                        }

                        return datos;
                    }

                    // Actualizar función de guardar antecedentes
                    const guardarAntecedentesBtn = document.getElementById('guardarAntecedentes');
                    if (guardarAntecedentesBtn) {
                        guardarAntecedentesBtn.addEventListener('click', function (e) {
                            e.preventDefault();

                            const datos = obtenerDatosAntecedentes();
                            console.log('Datos de antecedentes:', datos);

                            // Validar que si se marca un checkbox, tenga fecha
                            let errores = [];

                            if (document.getElementById('profilaxisOftalmica').checked && !document.getElementById('fecha_profilaxis_oftalmica').value) {
                                errores.push('Debe especificar la fecha de aplicación de la Profilaxis Oftálmica');
                            }

                            if (document.getElementById('vitaminaK').checked && !document.getElementById('fecha_vitamina_k').value) {
                                errores.push('Debe especificar la fecha de aplicación de la Vitamina K');
                            }

                            if (errores.length > 0) {
                                alert('Errores encontrados:\n' + errores.join('\n'));
                                return;
                            }
                        });
                    }
                });

                document.addEventListener('DOMContentLoaded', function () {
                    // Referencias a elementos
                    const pesoInput = document.getElementById('peso_nutricion');
                    const tallaInput = document.getElementById('talla_nutricion');
                    const edadSelect = document.getElementById('edad_nutricion');
                    const imcInput = document.getElementById('imc_nutricion');
                    const resultadoDiv = document.getElementById('resultado_nutricion');
                    const estadoDiv = document.getElementById('estado_nutricional');

                    // Rangos de IMC por edad (simplificados para el ejemplo)
                    const rangosIMC = {
                        'al_nacer': { min: 10, max: 18 },
                        '1mes': { min: 12, max: 20 },
                        '2meses': { min: 13, max: 21 },
                        '3meses': { min: 14, max: 22 },
                        '4meses': { min: 14.5, max: 22.5 },
                        '5meses': { min: 15, max: 23 },
                        '6meses': { min: 15.5, max: 23.5 },
                        '7meses': { min: 16, max: 24 },
                        '8meses': { min: 16.2, max: 24.2 },
                        '9meses': { min: 16.4, max: 24.4 },
                        '10meses': { min: 16.6, max: 24.6 },
                        '11meses': { min: 16.8, max: 24.8 },
                        '1ano': { min: 17, max: 25 },
                        '2anos': { min: 15, max: 18 },
                        '3anos': { min: 14, max: 17 },
                        '4anos': { min: 14, max: 17 },
                        '5anos': { min: 14, max: 17 }
                        // Para mayores de 5 años no hay rangos específicos, solo se calcula IMC
                    };

                    // Función para calcular IMC
                    function calcularIMC() {
                        const peso = parseFloat(pesoInput.value);
                        const talla = parseFloat(tallaInput.value);
                        const edad = edadSelect.value;

                        if (peso && talla && edad) {
                            // Convertir talla de cm a metros
                            const tallaMetros = talla / 100;
                            const imc = peso / (tallaMetros * tallaMetros);

                            imcInput.value = imc.toFixed(2);
                            evaluarEstadoNutricional(imc, edad);
                        } else {
                            imcInput.value = '';
                            resultadoDiv.style.display = 'none';
                        }
                    }

                    // Función para evaluar estado nutricional
                    function evaluarEstadoNutricional(imc, edad) {
                        let estado = '';
                        let clase = '';
                        let icono = '';
                        let mensaje = '';
                        let derivacion = '';

                        // Para mayores de 5 años
                        if (['6anos', '7anos', '8anos'].includes(edad)) {
                            if (imc < 18.5) {
                                estado = 'Peso bajo';
                                clase = 'peso-bajo';
                                icono = '⬇️';
                            } else if (imc >= 18.5 && imc < 25) {
                                estado = 'Peso normal';
                                clase = 'peso-normal';
                                icono = '✅';
                            } else if (imc >= 25 && imc < 30) {
                                estado = 'Sobrepeso';
                                clase = 'sobrepeso';
                                icono = '⬆️';
                            } else {
                                estado = 'Obesidad';
                                clase = 'obesidad';
                                icono = '🔴';
                            }
                        } else {
                            // Para menores de 5 años
                            const rangos = rangosIMC[edad];
                            if (!rangos) return;

                            if (imc < rangos.min * 0.85) {
                                estado = 'Peso bajo';
                                clase = 'peso-bajo';
                                icono = '⬇️';
                                derivacion = 'Derivar a Medicina Familiar y Nutricionista';
                            } else if (imc < rangos.min) {
                                estado = 'Riesgo de Peso bajo';
                                clase = 'riesgo-peso-bajo';
                                icono = '⚠️';
                                derivacion = 'Derivar a Medicina Familiar y Nutricionista';
                            } else if (imc <= rangos.max) {
                                estado = 'Peso normal';
                                clase = 'peso-normal';
                                icono = '✅';
                            } else if (imc <= rangos.max * 1.15) {
                                estado = 'Sobrepeso';
                                clase = 'sobrepeso';
                                icono = '⬆️';
                                derivacion = 'Derivar a EEMF, Nutricionista o Medicina Familiar';
                            } else {
                                estado = 'Obesidad';
                                clase = 'obesidad';
                                icono = '🔴';
                                derivacion = 'Derivar a Medicina Familiar y Nutricionista';
                            }
                        }

                        // Mostrar resultado
                        estadoDiv.className = `nutrition-result ${clase}`;
                        estadoDiv.innerHTML = `
            <div class="nutrition-icon">${icono}</div>
            <h4>${estado}</h4>
            <p>IMC: ${imc.toFixed(2)} kg/m²</p>
            ${derivacion ? `
                <div class="alerta-derivacion">
                    <span class="icono">👨‍⚕️</span>
                    <span class="texto">${derivacion}</span>
                </div>
            ` : ''}
        `;

                        resultadoDiv.style.display = 'block';
                    }

                    // Event listeners
                    pesoInput.addEventListener('input', calcularIMC);
                    tallaInput.addEventListener('input', calcularIMC);
                    edadSelect.addEventListener('change', calcularIMC);

                    // Botón limpiar
                    document.getElementById('limpiarNutricion')?.addEventListener('click', function () {
                        if (confirm('¿Está seguro de que desea limpiar todos los campos?')) {
                            document.getElementById('nutricionForm').reset();
                            imcInput.value = '';
                            resultadoDiv.style.display = 'none';
                        }
                    });

                    // Botón guardar
                    document.getElementById('guardarNutricion')?.addEventListener('click', function (e) {
                        e.preventDefault();

                        const peso = pesoInput.value;
                        const talla = tallaInput.value;
                        const edad = edadSelect.value;
                        const fecha = document.getElementById('fecha_nutricion').value;
                        const imc = imcInput.value;

                        if (!peso || !talla || !edad || !fecha) {
                            alert('Por favor complete todos los campos obligatorios');
                            return;
                        }

                        // Agregar al historial
                        agregarAlHistorialNutricion({
                            peso: peso,
                            talla: talla,
                            edad: edad,
                            fecha: fecha,
                            imc: imc,
                            estado: estadoDiv.querySelector('h4')?.textContent || ''
                        });

                        alert('Evaluación nutricional guardada correctamente');

                        // Limpiar formulario
                        document.getElementById('nutricionForm').reset();
                        imcInput.value = '';
                        resultadoDiv.style.display = 'none';
                    });

                    // Botón borrador
                    document.getElementById('guardarBorradorNut')?.addEventListener('click', function () {
                        alert('Borrador de evaluación nutricional guardado');
                    });
                });

                // 1. Modificar la función guardarNutricion para incluir tipo de alimentación
                document.getElementById('guardarNutricion')?.addEventListener('click', function (e) {
                    e.preventDefault();

                    const peso = pesoInput.value;
                    const talla = tallaInput.value;
                    const edad = edadSelect.value;
                    const fecha = document.getElementById('fecha_nutricion').value;
                    const imc = imcInput.value;

                    // Obtener tipo de alimentación (opcional)
                    const tipoAlimentacion = document.getElementById('tipo_alimentacion').value;
                    const tipoAlimentacionTexto = tipoAlimentacion ?
                        document.getElementById('tipo_alimentacion').options[document.getElementById('tipo_alimentacion').selectedIndex].text : '';

                    if (!peso || !talla || !edad || !fecha) {
                        alert('Por favor complete todos los campos obligatorios');
                        return;
                    }

                    // Agregar al historial
                    agregarAlHistorialNutricion({
                        peso: peso,
                        talla: talla,
                        edad: edad,
                        fecha: fecha,
                        imc: imc,
                        estado: estadoDiv.querySelector('h4')?.textContent || '',
                        tipoAlimentacion: tipoAlimentacion,
                        tipoAlimentacionTexto: tipoAlimentacionTexto
                    });

                    alert('Evaluación nutricional guardada correctamente');

                    // Limpiar formulario
                    document.getElementById('nutricionForm').reset();
                    imcInput.value = '';
                    resultadoDiv.style.display = 'none';
                    // Limpiar también la información de alimentación
                    document.getElementById('info_alimentacion').style.display = 'none';
                    document.getElementById('alimentacion_help').style.display = 'none';
                });

                // 2. Modificar la función agregarAlHistorialNutricion
                function agregarAlHistorialNutricion(datos) {
                    const container = document.getElementById('historialEvaluaciones');

                    const historialItem = document.createElement('div');
                    historialItem.classList.add('historial-item');
                    historialItem.innerHTML = `
        <div class="historial-content">
            <div class="historial-title">📊 Evaluación Nutricional - ${datos.edad.replace('_', ' ')}</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 10px;">
                <div><strong>Peso:</strong> ${datos.peso} kg</div>
                <div><strong>Talla:</strong> ${datos.talla} cm</div>
                <div><strong>IMC:</strong> ${datos.imc} kg/m²</div>
                <div><strong>Estado:</strong> ${datos.estado}</div>
                <div><strong>Fecha:</strong> ${datos.fecha}</div>
                ${datos.tipoAlimentacionTexto ? `
                    <div style="grid-column: 1 / -1; margin-top: 8px; padding: 8px; background: #f0f8f0; border-radius: 6px; border-left: 3px solid #27ae60;">
                        <strong>🤱Tipo de Alimentación:</strong> ${datos.tipoAlimentacionTexto}
                    </div>
                ` : ''}
            </div>
        </div>
            `;

                    container.appendChild(historialItem);
                    document.getElementById('historialNutricion').style.display = 'block';
                }


                // Event listeners
                document.addEventListener('DOMContentLoaded', function () {
                    // Mostrar/ocultar sección de molestias
                    document.querySelectorAll('input[name="reacciones_adversas"]').forEach(radio => {
                        radio.addEventListener('change', function () {
                            const molestiaSection = document.getElementById('molestias_section');
                            if (this.value === 'si') {
                                molestiaSection.style.display = 'block';
                            } else {
                                molestiaSection.style.display = 'none';
                                // Limpiar molestias seleccionadas
                                document.querySelectorAll('input[name="molestias[]"]').forEach(cb => {
                                    cb.checked = false;
                                });
                                document.getElementById('otra_molestia_detalle').style.display = 'none';
                            }
                        });
                    });

                    // Mostrar/ocultar campo "otra molestia"
                    document.getElementById('otra_molestia').addEventListener('change', function () {
                        const otraDetalle = document.getElementById('otra_molestia_detalle');
                        if (this.checked) {
                            otraDetalle.style.display = 'block';
                        } else {
                            otraDetalle.style.display = 'none';
                            document.getElementById('otra_molestia_texto').value = '';
                        }
                    });

                    // Funcionalidad para checkboxes de molestias
                    document.querySelectorAll('#molestias_section .checkbox-item').forEach(item => {
                        const checkbox = item.querySelector('.checkbox-input');
                        if (checkbox) {
                            checkbox.addEventListener('change', function () {
                                if (this.checked) {
                                    item.classList.add('checked');
                                } else {
                                    item.classList.remove('checked');
                                }
                            });
                        }
                    });

                    // Agregar otra vacuna
                    document.getElementById('agregarOtraVacuna')?.addEventListener('click', function () {
                        const vacunaSelect = document.getElementById('otra_vacuna_select');
                        const dosisSelect = document.getElementById('otra_dosis_select');
                        const fechaInput = document.getElementById('otra_fecha_vacunacion');

                        if (!vacunaSelect.value || !dosisSelect.value || !fechaInput.value) {
                            alert('Por favor complete todos los campos para agregar la vacuna');
                            return;
                        }

                        const vacunaTexto = vacunaSelect.options[vacunaSelect.selectedIndex].text;
                        const dosisTexto = dosisSelect.options[dosisSelect.selectedIndex].text;
                        const fecha = fechaInput.value;

                        agregarOtraVacunaALista(vacunaTexto, dosisTexto, fecha);

                        // Limpiar campos
                        vacunaSelect.value = '';
                        dosisSelect.value = '';
                        fechaInput.value = '';
                    });

                    // Cerrar modal al hacer clic fuera
                    document.getElementById('detallesVacunaModal').addEventListener('click', function (e) {
                        if (e.target === this) {
                            cerrarDetallesVacuna();
                        }
                    });

                    // Botón limpiar
                    document.getElementById('limpiarVacunacion')?.addEventListener('click', function () {
                        if (confirm('¿Está seguro de que desea limpiar todos los datos de vacunación incluyendo los detalles guardados?')) {
                            // Limpiar fechas de vacunas del esquema
                            document.querySelectorAll('.fecha-input').forEach(input => {
                                input.value = '';
                                input.classList.remove('completada');
                            });

                            // Limpiar estados visuales
                            document.querySelectorAll('.dosis-item').forEach(item => {
                                item.classList.remove('completada');
                            });

                            document.querySelectorAll('.btn-detalles').forEach(btn => {
                                btn.classList.remove('completado', 'con-detalles');
                                btn.innerHTML = '➕';
                                btn.title = '';
                            });

                            // Limpiar detalles guardados
                            detallesVacunas = {};
                        }
                    });



                    // Botón borrador
                    document.getElementById('guardarBorradorVac')?.addEventListener('click', function () {
                        alert('Borrador de esquema de vacunación guardado');
                    });
                });

                // Función para agregar otra vacuna a la lista
                function agregarOtraVacunaALista(vacuna, dosis, fecha) {
                    const container = document.getElementById('otrasVacunasAgregadas');

                    const vacunaItem = document.createElement('div');
                    vacunaItem.classList.add('vacuna-agregada');
                    vacunaItem.innerHTML = `
        <div class="vacuna-agregada-info">
            <div class="vacuna-agregada-titulo">💉 ${vacuna}</div>
            <div class="vacuna-agregada-detalles">
                <strong>Dosis:</strong> ${dosis} • <strong>Fecha:</strong> ${fecha}
            </div>
        </div>
        <button type="button" class="btn-eliminar-vacuna" onclick="eliminarOtraVacuna(this)">
            🗑️ Eliminar
        </button>
    `;

                    container.appendChild(vacunaItem);
                }

                // Función para eliminar otra vacuna
                function eliminarOtraVacuna(button) {
                    if (confirm('¿Está seguro de eliminar esta vacuna?')) {
                        button.parentElement.remove();
                    }
                }

                // Event listener para mostrar/ocultar campo de texto de "otra vacuna"
                document.getElementById('otra_vacuna_select').addEventListener('change', function () {
                    const otraVacunaGroup = document.getElementById('otra_vacuna_texto_group');
                    const otraVacunaInput = document.getElementById('otra_vacuna_texto');

                    if (this.value === 'otra') {
                        otraVacunaGroup.style.display = 'block';
                        otraVacunaInput.required = true;
                    } else {
                        otraVacunaGroup.style.display = 'none';
                        otraVacunaInput.required = false;
                        otraVacunaInput.value = '';
                    }
                });

                // Modificar la función agregarOtraVacunaALista para manejar "otra"
                // Actualizar esta parte en tu función existente donde obtienes el texto de la vacuna:
                /*
                const vacunaTexto = vacunaSelect.value === 'otra' 
                    ? document.getElementById('otra_vacuna_texto').value 
                    : vacunaSelect.options[vacunaSelect.selectedIndex].text;
                */

                // Script para manejar las validaciones y restricciones
                document.addEventListener('DOMContentLoaded', function () {
                    const tipoAlimentacion = document.getElementById('tipo_alimentacion');
                    const fechaAlimentacion = document.getElementById('fecha_alimentacion');
                    const edadNutricion = document.getElementById('edad_nutricion');
                    const alimentacionHelp = document.getElementById('alimentacion_help');
                    const infoAlimentacion = document.getElementById('info_alimentacion');
                    const contenidoInfo = document.getElementById('contenido_info_alimentacion');

                    // Establecer fecha máxima como hoy
                    const hoy = new Date().toISOString().split('T')[0];
                    fechaAlimentacion.setAttribute('max', hoy);

                    // Manejar cambios en el tipo de alimentación
                    tipoAlimentacion.addEventListener('change', function () {
                        const selectedOption = this.options[this.selectedIndex];
                        const edadMin = selectedOption.getAttribute('data-edad-min');
                        const edadMax = selectedOption.getAttribute('data-edad-max');

                        // Mostrar información de restricciones de edad
                        if (edadMin !== null || edadMax !== null) {
                            let restriccionTexto = '';
                            if (edadMin && edadMax) {
                                restriccionTexto = `Registro válido de ${edadMin} a ${edadMax} meses de edad`;
                            } else if (edadMin) {
                                restriccionTexto = `Registro válido desde ${edadMin} meses de edad`;
                            } else if (edadMax) {
                                restriccionTexto = `Registro válido hasta ${edadMax} meses de edad`;
                            }

                            alimentacionHelp.textContent = restriccionTexto;
                            alimentacionHelp.style.display = 'block';
                        } else {
                            alimentacionHelp.style.display = 'none';
                        }

                        // Mostrar información adicional
                        mostrarInfoAlimentacion(this.value);
                    });

                    function mostrarInfoAlimentacion(tipo) {
                        let info = '';

                        switch (tipo) {
                            case 'lactancia_exclusiva':
                                info = `
                    <h4 style="margin: 0 0 10px 0; color: #007bff;">🤱 Lactancia Materna Exclusiva</h4>
                    <p><strong>Edad recomendada:</strong> 0 a 6 meses</p>
                    <p><strong>Descripción:</strong> El lactante recibe únicamente leche materna, sin otros líquidos o sólidos, excepto medicamentos o vitaminas.</p>
                `;
                                break;
                            case 'lactancia_complementaria':
                                info = `
                    <h4 style="margin: 0 0 10px 0; color: #28a745;">🥄 Lactancia Materna Complementaria</h4>
                    <p><strong>Edad recomendada:</strong> 6 meses a 2 años</p>
                    <p><strong>Descripción:</strong> Lactancia materna junto con alimentación complementaria apropiada para la edad.</p>
                `;
                                break;
                            case 'abandono_lactancia':
                                info = `
                    <h4 style="margin: 0 0 10px 0; color: #ffc107;">⚠️ Abandono de Lactancia Materna</h4>
                    <p><strong>Descripción:</strong> Cese completo de la lactancia materna antes del tiempo recomendado.</p>
                `;
                                break;
                            case 'lactancia_mixta':
                                info = `
                    <h4 style="margin: 0 0 10px 0; color: #17a2b8;">🤱 Lactancia Materna Mixta</h4>
                    <p><strong>Descripción:</strong> Combinación de lactancia materna con fórmula artificial.</p>
                `;
                                break;
                            case 'lactancia_mixta_complementaria':
                                info = `
                    <h4 style="margin: 0 0 10px 0; color: #6f42c1;">🤱🥄 Lactancia Materna Mixta Complementaria</h4>
                    <p><strong>Descripción:</strong> Lactancia materna, fórmula artificial y alimentación complementaria.</p>
                `;
                                break;
                            case 'sin_lactancia_medica':
                                info = `
                    <h4 style="margin: 0 0 10px 0; color: #dc3545;">🏥 Sin Lactancia Materna por Razón Médica</h4>
                    <p><strong>Descripción:</strong> Ausencia de lactancia materna debido a contraindicaciones médicas.</p>
                `;
                                break;
                        }

                        if (info) {
                            contenidoInfo.innerHTML = info;
                            infoAlimentacion.style.display = 'block';
                        } else {
                            infoAlimentacion.style.display = 'none';
                        }
                    }

                    // Validar edad según tipo de alimentación seleccionado
                    function validarEdadAlimentacion() {
                        const tipoSeleccionado = tipoAlimentacion.value;
                        const edadSeleccionada = edadNutricion.value;

                        if (!tipoSeleccionado || !edadSeleccionada) return true;

                        const selectedOption = tipoAlimentacion.options[tipoAlimentacion.selectedIndex];
                        const edadMin = selectedOption.getAttribute('data-edad-min');
                        const edadMax = selectedOption.getAttribute('data-edad-max');

                        // Convertir edad seleccionada a meses para comparación
                        const edadEnMeses = convertirEdadAMeses(edadSeleccionada);

                        if (edadMin && edadEnMeses < parseInt(edadMin)) {
                            return false;
                        }

                        if (edadMax && edadEnMeses > parseInt(edadMax)) {
                            return false;
                        }

                        return true;
                    }

                    function convertirEdadAMeses(edad) {
                        if (edad === 'al_nacer') return 0;
                        if (edad.includes('mes')) return parseInt(edad);
                        if (edad.includes('ano')) return parseInt(edad) * 12;
                        return 0;
                    }

                    // Validar al cambiar la edad
                    edadNutricion.addEventListener('change', function () {
                        if (tipoAlimentacion.value && !validarEdadAlimentacion()) {
                            alert('La edad seleccionada no es compatible con el tipo de alimentación elegido.');
                            tipoAlimentacion.value = '';
                            alimentacionHelp.style.display = 'none';
                            infoAlimentacion.style.display = 'none';
                        }
                    });
                });

                //script Vacunas
                // Objeto para almacenar los detalles de las vacunas
                let detallesVacunas = {};

                // Variables globales para el modal de detalles
                let vacunaActual = '';
                let dosisActual = '';

                // Función para abrir detalles de vacuna
                function abrirDetallesVacuna(vacuna, dosis) {
                    vacunaActual = vacuna;
                    dosisActual = dosis;

                    // Configurar título del modal
                    const dosisElement = document.querySelector(`[data-vacuna="${vacuna}"][data-dosis="${dosis}"]`);
                    let nombreVacuna, dosisTexto;

                    if (dosisElement) {
                        nombreVacuna = dosisElement.closest('.vacuna-card').querySelector('h4').textContent;

                        // Para dosis anuales de influenza, obtener el texto del span dosis-numero
                        if (vacuna === 'influenza' && dosis.startsWith('anual_')) {
                            dosisTexto = dosisElement.querySelector('.dosis-numero').textContent;
                        } else {
                            dosisTexto = dosis;
                        }
                    } else {
                        nombreVacuna = "Vacuna";
                        dosisTexto = dosis;
                    }

                    document.getElementById('tituloDetallesVacuna').textContent = `${nombreVacuna} - ${dosisTexto}`;

                    // Cargar datos existentes si los hay
                    cargarDetallesExistentes(vacuna, dosis);

                    // Mostrar modal
                    document.getElementById('detallesVacunaModal').style.display = 'flex';
                }

                // Función para cargar detalles existentes
                function cargarDetallesExistentes(vacuna, dosis) {
                    const clave = `${vacuna}_${dosis}`;
                    const detalles = detallesVacunas[clave];

                    if (detalles) {
                        // Cargar datos básicos
                        document.getElementById('fecha_aplicacion_detalle').value = detalles.fechaAplicacion || '';
                        document.getElementById('fecha_registro').value = detalles.fechaRegistro || '';
                        document.getElementById('grupo_riesgo').value = detalles.grupoRiesgo || '';
                        document.getElementById('lote').value = detalles.lote || '';
                        document.getElementById('fecha_caducidad').value = detalles.fechaCaducidad || '';

                        // Cargar radio buttons
                        if (detalles.rescate) {
                            const rescateRadio = document.querySelector(`input[name="rescate"][value="${detalles.rescate}"]`);
                            if (rescateRadio) rescateRadio.checked = true;
                        }

                        if (detalles.lugarAplicacion) {
                            const lugarRadio = document.querySelector(`input[name="lugar_aplicacion"][value="${detalles.lugarAplicacion}"]`);
                            if (lugarRadio) lugarRadio.checked = true;
                        }

                        if (detalles.reaccionesAdversas) {
                            const reaccionRadio = document.querySelector(`input[name="reacciones_adversas"][value="${detalles.reaccionesAdversas}"]`);
                            if (reaccionRadio) {
                                reaccionRadio.checked = true;
                                // Mostrar sección de molestias si es necesario
                                if (detalles.reaccionesAdversas === 'si') {
                                    document.getElementById('molestias_section').style.display = 'block';
                                }
                            }
                        }

                        // Cargar molestias
                        if (detalles.molestias && detalles.molestias.length > 0) {
                            detalles.molestias.forEach(molestia => {
                                const checkbox = document.querySelector(`input[name="molestias[]"][value="${molestia}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                    checkbox.closest('.checkbox-item').classList.add('checked');
                                }
                            });
                        }

                        // Cargar "otra molestia"
                        if (detalles.otraMolestia) {
                            const otraCheckbox = document.querySelector(`input[name="molestias[]"][value="otra"]`);
                            if (otraCheckbox) {
                                otraCheckbox.checked = true;
                                otraCheckbox.closest('.checkbox-item').classList.add('checked');
                                document.getElementById('otra_molestia_detalle').style.display = 'block';
                                document.getElementById('otra_molestia_texto').value = detalles.otraMolestia;
                            }
                        }
                    } else {
                        // Si no hay detalles previos, copiar fecha si ya existe en el input principal
                        const fechaExistente = document.querySelector(`[data-vacuna="${vacuna}"][data-dosis="${dosis}"] .fecha-input`).value;
                        if (fechaExistente) {
                            document.getElementById('fecha_aplicacion_detalle').value = fechaExistente;
                        }
                    }
                }

                // Función para cerrar detalles de vacuna
                function cerrarDetallesVacuna() {
                    document.getElementById('detallesVacunaModal').style.display = 'none';
                    limpiarFormularioDetalles();
                }

                // Función para limpiar formulario de detalles
                function limpiarFormularioDetalles() {
                    document.getElementById('detallesVacunaForm').reset();
                    document.getElementById('molestias_section').style.display = 'none';
                    document.getElementById('otra_molestia_detalle').style.display = 'none';

                    // Limpiar checkboxes
                    document.querySelectorAll('#molestias_section .checkbox-item').forEach(item => {
                        item.classList.remove('checked');
                    });
                }

                // Función para guardar detalles de vacuna
                function guardarDetallesVacuna() {
                    const fechaAplicacion = document.getElementById('fecha_aplicacion_detalle').value;
                    const rescate = document.querySelector('input[name="rescate"]:checked')?.value;

                    if (!fechaAplicacion) {
                        alert('La fecha de aplicación es obligatoria');
                        return;
                    }

                    if (!rescate) {
                        alert('Debe indicar si es rescate o no');
                        return;
                    }

                    // Recopilar todos los datos del formulario
                    const datosVacuna = {
                        vacuna: vacunaActual,
                        dosis: dosisActual,
                        fechaAplicacion: fechaAplicacion,
                        rescate: rescate,
                        fechaRegistro: document.getElementById('fecha_registro').value,
                        grupoRiesgo: document.getElementById('grupo_riesgo').value,
                        lote: document.getElementById('lote').value,
                        fechaCaducidad: document.getElementById('fecha_caducidad').value,
                        lugarAplicacion: document.querySelector('input[name="lugar_aplicacion"]:checked')?.value,
                        reaccionesAdversas: document.querySelector('input[name="reacciones_adversas"]:checked')?.value,
                        molestias: Array.from(document.querySelectorAll('input[name="molestias[]"]:checked')).map(cb => cb.value),
                        otraMolestia: document.getElementById('otra_molestia_texto').value
                    };

                    // Guardar en el objeto global
                    const clave = `${vacunaActual}_${dosisActual}`;
                    detallesVacunas[clave] = datosVacuna;

                    // Actualizar fecha en la tarjeta principal
                    const dosisElement = document.querySelector(`[data-vacuna="${vacunaActual}"][data-dosis="${dosisActual}"]`);
                    const fechaInput = dosisElement.querySelector('.fecha-input');
                    const btnDetalles = dosisElement.querySelector('.btn-detalles');

                    fechaInput.value = fechaAplicacion;
                    fechaInput.classList.add('completada');
                    btnDetalles.classList.add('con-detalles');
                    dosisElement.classList.add('completada');

                    // Cambiar icono del botón para indicar que tiene detalles
                    btnDetalles.innerHTML = '📋';
                    btnDetalles.title = 'Ver/Editar detalles';

                    console.log('Datos de vacuna guardados:', datosVacuna);

                    alert('Detalles de vacuna guardados correctamente');
                    cerrarDetallesVacuna();
                }

                // Función para obtener resumen de vacunas con detalles
                function obtenerResumenVacunas() {
                    const resumen = [];

                    for (const [clave, detalles] of Object.entries(detallesVacunas)) {
                        resumen.push({
                            vacuna: detalles.vacuna,
                            dosis: detalles.dosis,
                            fechaAplicacion: detalles.fechaAplicacion,
                            rescate: detalles.rescate,
                            tieneDetallesCompletos: Boolean(detalles.lote || detalles.grupoRiesgo || detalles.reaccionesAdversas)
                        });
                    }

                    return resumen;
                }

                // Event listeners
                document.addEventListener('DOMContentLoaded', function () {
                    // Mostrar/ocultar sección de molestias
                    document.querySelectorAll('input[name="reacciones_adversas"]').forEach(radio => {
                        radio.addEventListener('change', function () {
                            const molestiaSection = document.getElementById('molestias_section');
                            if (this.value === 'si') {
                                molestiaSection.style.display = 'block';
                            } else {
                                molestiaSection.style.display = 'none';
                                // Limpiar molestias seleccionadas
                                document.querySelectorAll('input[name="molestias[]"]').forEach(cb => {
                                    cb.checked = false;
                                    cb.closest('.checkbox-item').classList.remove('checked');
                                });
                                document.getElementById('otra_molestia_detalle').style.display = 'none';
                                document.getElementById('otra_molestia_texto').value = '';
                            }
                        });
                    });

                    // Mostrar/ocultar campo "otra molestia"
                    document.getElementById('otra_molestia').addEventListener('change', function () {
                        const otraDetalle = document.getElementById('otra_molestia_detalle');
                        if (this.checked) {
                            otraDetalle.style.display = 'block';
                        } else {
                            otraDetalle.style.display = 'none';
                            document.getElementById('otra_molestia_texto').value = '';
                        }
                    });

                    // Funcionalidad para checkboxes de molestias
                    document.querySelectorAll('#molestias_section .checkbox-item').forEach(item => {
                        const checkbox = item.querySelector('.checkbox-input');
                        if (checkbox) {
                            checkbox.addEventListener('change', function () {
                                if (this.checked) {
                                    item.classList.add('checked');
                                } else {
                                    item.classList.remove('checked');
                                }
                            });
                        }
                    });

                    // Cerrar modal al hacer clic fuera
                    document.getElementById('detallesVacunaModal').addEventListener('click', function (e) {
                        if (e.target === this) {
                            cerrarDetallesVacuna();
                        }
                    });


                    // Botón guardar
                    document.getElementById('guardarVacunacion')?.addEventListener('click', function () {
                        const resumen = obtenerResumenVacunas();
                        console.log('Esquema de vacunación completo:', resumen);
                        console.log('Detalles completos:', detallesVacunas);

                        if (resumen.length > 0) {
                            alert(`Esquema de vacunación guardado. ${resumen.length} vacuna(s) registrada(s) con detalles.`);
                        }
                        // Guardar en el historial
                        guardarVacunasAlHistorial();

                        // Limpiar formulario después de guardar exitosamente
                        limpiarFormularioVacunacion();
                    });

                    function limpiarFormularioVacunacion() {
                        // Limpiar fechas de vacunas del esquema
                        document.querySelectorAll('.fecha-input').forEach(input => {
                            input.value = '';
                            input.classList.remove('completada');
                        });

                        // Limpiar estados visuales
                        document.querySelectorAll('.dosis-item').forEach(item => {
                            item.classList.remove('completada');
                        });

                        document.querySelectorAll('.btn-detalles').forEach(btn => {
                            btn.classList.remove('completado', 'con-detalles');
                            btn.innerHTML = '➕';
                            btn.title = '';
                        });

                        // Limpiar otras vacunas
                        document.getElementById('otrasVacunasAgregadas').innerHTML = '';
                        document.getElementById('otra_vacuna_select').value = '';
                        document.getElementById('otra_dosis_select').value = '';
                        document.getElementById('otra_fecha_vacunacion').value = '';
                        document.getElementById('otra_lote').value = '';
                        document.getElementById('otra_fecha_caducidad').value = '';

                        // Limpiar dosis anuales de influenza
                        document.getElementById('dosis_anuales_agregadas').innerHTML = '';
                        document.getElementById('anio_influenza').value = '';

                        // Limpiar detalles guardados
                        detallesVacunas = {};
                    }

                    // Botón borrador
                    document.getElementById('guardarBorradorVac')?.addEventListener('click', function () {
                        alert('Borrador de esquema de vacunación guardado');
                    });

                    // Actualizar fecha principal cuando se cambia en el modal
                    document.getElementById('fecha_aplicacion_detalle').addEventListener('change', function () {
                        if (vacunaActual && dosisActual) {
                            const dosisElement = document.querySelector(`[data-vacuna="${vacunaActual}"][data-dosis="${dosisActual}"]`);
                            const fechaInput = dosisElement.querySelector('.fecha-input');
                            fechaInput.value = this.value;
                        }
                    });

                    // Sincronizar fecha principal con el modal cuando se cambia directamente
                    document.querySelectorAll('.fecha-input').forEach(input => {
                        input.addEventListener('change', function () {
                            const dosisItem = this.closest('.dosis-item');
                            const vacuna = dosisItem.dataset.vacuna;
                            const dosis = dosisItem.dataset.dosis;
                            const clave = `${vacuna}_${dosis}`;

                            // Si ya existen detalles, actualizar la fecha
                            if (detallesVacunas[clave]) {
                                detallesVacunas[clave].fechaAplicacion = this.value;
                            }

                            // Actualizar estado visual
                            if (this.value) {
                                this.classList.add('completada');
                                dosisItem.classList.add('completada');
                            } else {
                                this.classList.remove('completada');
                                dosisItem.classList.remove('completada');
                                // Si se borra la fecha, eliminar los detalles también
                                delete detallesVacunas[clave];
                                const btnDetalles = dosisItem.querySelector('.btn-detalles');
                                btnDetalles.classList.remove('con-detalles');
                                btnDetalles.innerHTML = '➕';
                                btnDetalles.title = '';
                            }
                        });
                    });
                });

                //Solo para Influenza 
                // Función para agregar dosis anual de influenza
                function agregarDosisAnualInfluenza() {
                    const select = document.getElementById('anio_influenza');
                    const container = document.getElementById('dosis_anuales_agregadas');

                    if (!select.value) {
                        alert('Por favor seleccione un año');
                        return;
                    }

                    const año = select.value;
                    const textoAño = select.options[select.selectedIndex].text;

                    // Verificar que no esté duplicado
                    const existente = container.querySelector(`[data-año="${año}"]`);
                    if (existente) {
                        alert('Este año ya ha sido agregado');
                        return;
                    }

                    // Crear nuevo elemento
                    const dosisItem = document.createElement('div');
                    dosisItem.className = 'dosis-item';
                    dosisItem.setAttribute('data-vacuna', 'influenza');
                    dosisItem.setAttribute('data-dosis', `anual_${año}`);
                    dosisItem.setAttribute('data-año', año);
                    dosisItem.style.backgroundColor = '#f8f9fa';
                    dosisItem.style.borderRadius = '8px';
                    dosisItem.style.padding = '10px';
                    dosisItem.style.marginBottom = '8px';

                    dosisItem.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div class="dosis-info">
                <span class="dosis-numero">Dosis Anual - ${textoAño}</span>
                <span class="edad-oportuna">Temporada invernal</span>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="date" class="fecha-input" placeholder="Fecha de aplicación">
                <button type="button" class="btn-detalles"
                    onclick="abrirDetallesVacuna('influenza', 'anual_${año}')">➕</button>
                <button type="button" class="btn btn-outline" 
                        onclick="eliminarDosisAnualInfluenza('${año}')"
                        style="padding: 4px 8px; font-size: 11px; background: #e74c3c; color: white; border: none;">🗑️</button>
            </div>
        </div>
    `;

                    container.appendChild(dosisItem);

                    // Limpiar selector
                    select.value = '';

                    // Agregar event listener para la fecha
                    const fechaInput = dosisItem.querySelector('.fecha-input');
                    fechaInput.addEventListener('change', function () {
                        if (this.value) {
                            this.classList.add('completada');
                            dosisItem.classList.add('completada');
                        } else {
                            this.classList.remove('completada');
                            dosisItem.classList.remove('completada');
                        }
                    });
                }

                // Función para eliminar dosis anual de influenza
                function eliminarDosisAnualInfluenza(año) {
                    if (confirm('¿Está seguro de eliminar esta dosis anual?')) {
                        const container = document.getElementById('dosis_anuales_agregadas');
                        const elemento = container.querySelector(`[data-año="${año}"]`);
                        if (elemento) {
                            elemento.remove();

                            // Eliminar también de los detalles guardados
                            const clave = `influenza_anual_${año}`;
                            delete detallesVacunas[clave];
                        }
                    }
                }


                //Historial de vacunacion
                // CÓDIGO CORREGIDO PARA DETALLES DE VACUNACIÓN
                // REEMPLAZAR las funciones del historial de vacunación

                // Variable global para almacenar detalles con información adicional para el historial
                let historialVacunasConDetalles = {};

                // Función corregida para guardar vacunas al historial
                function guardarVacunasAlHistorial() {
                    let vacunasGuardadas = [];

                    // Limpiar historial anterior de esta sesión
                    historialVacunasConDetalles = {};

                    // Obtener vacunas del esquema nacional completadas
                    document.querySelectorAll('.dosis-item').forEach(item => {
                        const fechaInput = item.querySelector('.fecha-input');
                        if (fechaInput && fechaInput.value) {
                            const vacuna = item.dataset.vacuna;
                            const dosis = item.dataset.dosis;
                            const fecha = fechaInput.value;

                            // Obtener nombre de la vacuna
                            const vacunaCard = item.closest('.vacuna-card');
                            const nombreVacuna = vacunaCard ? vacunaCard.querySelector('h4').textContent : vacuna;

                            // Obtener texto de la dosis
                            const dosisInfo = item.querySelector('.dosis-numero');
                            const textosDosis = dosisInfo ? dosisInfo.textContent : dosis;

                            // Verificar si tiene detalles guardados
                            const clave = `${vacuna}_${dosis}`;
                            const tieneDetalles = detallesVacunas[clave] ? true : false;

                            // Crear identificador único para el historial
                            const historialId = `historial_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

                            const datosVacuna = {
                                titulo: `${nombreVacuna} - ${textosDosis}`,
                                fecha: fecha,
                                tipo: 'esquema_nacional',
                                vacuna: vacuna,
                                dosis: dosis,
                                tieneDetalles: tieneDetalles,
                                historialId: historialId,
                                clave: clave
                            };

                            // Si tiene detalles, guardarlos en el historial especial
                            if (tieneDetalles) {
                                historialVacunasConDetalles[historialId] = {
                                    ...detallesVacunas[clave],
                                    vacuna: vacuna,
                                    dosis: dosis,
                                    nombreVacuna: nombreVacuna,
                                    textosDosis: textosDosis
                                };
                            }

                            vacunasGuardadas.push(datosVacuna);
                        }
                    });

                    // Debug: Mostrar qué se está guardando
                    console.log('Vacunas guardadas:', vacunasGuardadas);
                    console.log('Detalles originales:', detallesVacunas);
                    console.log('Historial con detalles:', historialVacunasConDetalles);

                    // Obtener otras vacunas agregadas
                    document.querySelectorAll('.vacuna-agregada').forEach(item => {
                        const titulo = item.querySelector('.vacuna-agregada-titulo').textContent;
                        const detallesText = item.querySelector('.vacuna-agregada-detalles').textContent;
                        // Extraer fecha del texto de detalles
                        const fechaMatch = detallesText.match(/Fecha:\s*(\d{4}-\d{2}-\d{2})/);
                        const fecha = fechaMatch ? fechaMatch[1] : '';

                        if (fecha) {
                            vacunasGuardadas.push({
                                titulo: titulo,
                                fecha: fecha,
                                tipo: 'otra_vacuna',
                                tieneDetalles: false,
                                historialId: null
                            });
                        }
                    });

                    if (vacunasGuardadas.length === 0) {
                        alert('No hay vacunas registradas para guardar en el historial');
                        return;
                    }

                    // Agregar al historial
                    vacunasGuardadas.forEach(vacuna => {
                        agregarAlHistorialVacunaConDetalles(vacuna);
                    });

                    // Mostrar sección de historial
                    document.getElementById('historialVacunacion').style.display = 'block';

                    alert(`${vacunasGuardadas.length} vacuna(s) guardada(s) en el historial`);
                }

                function agregarAlHistorialVacunaConDetalles(vacuna) {
                    const container = document.getElementById('historialVacunas');

                    // Buscar si ya existe una vacuna con el mismo título
                    const vacunaExistente = Array.from(container.children).find(item => {
                        const titulo = item.querySelector('.historial-title').textContent;
                        return titulo === vacuna.titulo;
                    });

                    if (vacunaExistente) {
                        // Si existe, agregar la fecha al contenedor de fechas
                        agregarFechaAVacunaConDetalles(vacunaExistente, vacuna);
                    } else {
                        // Si no existe, crear nueva vacuna
                        crearNuevaVacunaHistorialConDetalles(vacuna);
                    }
                }

                function crearNuevaVacunaHistorialConDetalles(vacuna) {
                    const container = document.getElementById('historialVacunas');

                    const historialItem = document.createElement('div');
                    historialItem.classList.add('historial-item');

                    // Crear el contenido de la fecha con indicador de detalles
                    const fechaContent = crearElementoFechaConDetalles(vacuna);

                    historialItem.innerHTML = `
        <div class="historial-content">
            <div class="actividad-info">
                <div class="actividad-titulo">
                    <span class="historial-title">${vacuna.titulo}</span>
                    <span class="fechas-contador">1</span>
                </div>
                <div class="fechas-scroll-compacto">
                    ${fechaContent}
                </div>
            </div>
        </div>
    `;

                    container.appendChild(historialItem);
                }

                function agregarFechaAVacunaConDetalles(vacunaItem, nuevaVacuna) {
                    const fechasScroll = vacunaItem.querySelector('.fechas-scroll-compacto');
                    const contador = vacunaItem.querySelector('.fechas-contador');

                    // Verificar que la fecha no esté duplicada
                    const fechasExistentes = Array.from(fechasScroll.children).map(item => {
                        const fechaElement = item.querySelector('.fecha-texto') || item;
                        return fechaElement.textContent.replace(/[📋❌]/g, '').trim();
                    });

                    if (fechasExistentes.includes(nuevaVacuna.fecha)) {
                        alert('Esta fecha ya está registrada para esta vacuna');
                        return;
                    }

                    // Crear nuevo elemento de fecha
                    const fechaContent = crearElementoFechaConDetalles(nuevaVacuna);
                    const fechaDiv = document.createElement('div');
                    fechaDiv.className = 'fecha-item-compacto';
                    fechaDiv.innerHTML = fechaContent;

                    fechasScroll.appendChild(fechaDiv);

                    // Actualizar contador
                    const totalFechas = fechasScroll.children.length;
                    contador.textContent = totalFechas;

                    // Hacer scroll automático al final
                    fechasScroll.scrollTop = fechasScroll.scrollHeight;
                }

                function crearElementoFechaConDetalles(vacuna) {
                    const iconoDetalles = vacuna.tieneDetalles ? '📋' : '';
                    const claseDetalles = vacuna.tieneDetalles ? 'con-detalles-disponibles' : '';
                    const clickHandler = vacuna.tieneDetalles ? `onclick="mostrarDetallesVacunaHistorial('${vacuna.historialId}')"` : '';
                    const cursor = vacuna.tieneDetalles ? 'cursor: pointer;' : '';
                    const title = vacuna.tieneDetalles ? 'Haz clic para ver detalles' : '';

                    return `
        <div class="fecha-item-compacto ${claseDetalles}" 
             style="${cursor}" 
             ${clickHandler}
             title="${title}">
            <span class="fecha-texto">${vacuna.fecha}</span>
            ${iconoDetalles ? `<span class="icono-detalles">${iconoDetalles}</span>` : ''}
        </div>
    `;
                }

                // Función corregida para mostrar detalles de vacuna desde el historial
                function mostrarDetallesVacunaHistorial(historialId) {
                    console.log('Buscando detalles para historialId:', historialId);
                    console.log('Historial disponible:', Object.keys(historialVacunasConDetalles));

                    const detalles = historialVacunasConDetalles[historialId];

                    if (!detalles) {
                        alert('No se encontraron detalles para esta vacuna. ID: ' + historialId);
                        console.error('Detalles no encontrados para:', historialId);
                        console.log('Historial completo:', historialVacunasConDetalles);
                        return;
                    }

                    // Crear modal personalizado para mostrar detalles
                    const modalOverlay = document.createElement('div');
                    modalOverlay.className = 'popup-overlay';
                    modalOverlay.style.display = 'flex';
                    modalOverlay.id = 'modalDetallesHistorial';

                    modalOverlay.innerHTML = `
        <div class="popup-content" style="max-width: 700px;">
            <div class="popup-header">
                <h3 class="popup-title">📋 Detalles de Vacunación</h3>
                <button class="popup-close" onclick="cerrarModalDetallesHistorial()">×</button>
            </div>
            <div class="popup-body">
                <div class="detalles-vacuna-container">
                    <div class="detalle-header">
                        <h4 style="color: #3498db; margin-bottom: 15px;">
                            ${detalles.nombreVacuna} - ${detalles.textosDosis}
                        </h4>
                    </div>
                    
                    <div class="detalles-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        
                        <div class="detalle-item">
                            <strong>📅 Fecha de Aplicación:</strong>
                            <div class="detalle-valor">${detalles.fechaAplicacion || 'No especificada'}</div>
                        </div>

                        <div class="detalle-item">
                            <strong>🔄 Rescate:</strong>
                            <div class="detalle-valor ${detalles.rescate === 'si' ? 'rescate-si' : 'rescate-no'}">
                                ${detalles.rescate === 'si' ? '✅ Sí' : '❌ No'}
                            </div>
                        </div>

                        <div class="detalle-item">
                            <strong>📝 Fecha de Registro:</strong>
                            <div class="detalle-valor">${detalles.fechaRegistro || 'No especificada'}</div>
                        </div>

                        <div class="detalle-item">
                            <strong>⚠️ Grupo de Riesgo:</strong>
                            <div class="detalle-valor">${obtenerTextoGrupoRiesgo(detalles.grupoRiesgo)}</div>
                        </div>

                        <div class="detalle-item">
                            <strong>🏷️ Lote:</strong>
                            <div class="detalle-valor">${detalles.lote || 'No especificado'}</div>
                        </div>

                        <div class="detalle-item">
                            <strong>⏰ Fecha de Caducidad:</strong>
                            <div class="detalle-valor">${detalles.fechaCaducidad || 'No especificada'}</div>
                        </div>

                        <div class="detalle-item">
                            <strong>🏥 Lugar de Aplicación:</strong>
                            <div class="detalle-valor">${obtenerTextoLugarAplicacion(detalles.lugarAplicacion)}</div>
                        </div>

                        <div class="detalle-item">
                            <strong>🩺 Reacciones Adversas:</strong>
                            <div class="detalle-valor ${detalles.reaccionesAdversas === 'si' ? 'reaccion-si' : 'reaccion-no'}">
                                ${detalles.reaccionesAdversas === 'si' ? '⚠️ Sí' : '✅ No'}
                            </div>
                        </div>

                    </div>

                    ${detalles.molestias && detalles.molestias.length > 0 ? `
                        <div class="molestias-section" style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <h5 style="color: #856404; margin-bottom: 10px;">⚠️ Molestias Reportadas:</h5>
                            <div class="molestias-lista" style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${detalles.molestias.map(molestia => `
                                    <span class="molestia-badge" style="background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                        ${molestia === 'otra' ? (detalles.otraMolestia || 'Otra') : formatearMolestia(molestia)}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            </div>
        </div>
    `;

                    document.body.appendChild(modalOverlay);

                    // Cerrar modal al hacer clic fuera
                    modalOverlay.addEventListener('click', function (e) {
                        if (e.target === this) {
                            cerrarModalDetallesHistorial();
                        }
                    });
                }

                // Funciones auxiliares mejoradas
                function obtenerTextoGrupoRiesgo(grupoRiesgo) {
                    const grupos = {
                        'ninguno': 'Ninguno',
                        'inmunocompromiso': 'Inmunocompromiso',
                        'enfermedad_cronica': 'Enfermedad crónica',
                        'contacto_tb': 'Contacto TB',
                        'otros': 'Otros'
                    };
                    return grupos[grupoRiesgo] || grupoRiesgo || 'No especificado';
                }

                function obtenerTextoLugarAplicacion(lugar) {
                    const lugares = {
                        'intramuros': 'Intramuros',
                        'extramuros': 'Extramuros'
                    };
                    return lugares[lugar] || lugar || 'No especificado';
                }

                function formatearMolestia(molestia) {
                    const molestias = {
                        'cefalea': 'Cefalea',
                        'fiebre': 'Fiebre',
                        'dolor_sitio': 'Dolor en sitio de aplicación',
                        'malestar_general': 'Malestar general',
                        'escalofrio': 'Escalofrío',
                        'cansancio': 'Cansancio',
                        'inflamacion': 'Inflamación o enrojecimiento',
                        'dolor_muscular': 'Dolor muscular y articular'
                    };
                    return molestias[molestia] || molestia;
                }

                function cerrarModalDetallesHistorial() {
                    const modal = document.getElementById('modalDetallesHistorial');
                    if (modal) {
                        modal.remove();
                    }
                }

                // Función para debug - agregar botón de test (opcional)
                function testDetallesVacunas() {
                    console.log('=== DEBUG DETALLES VACUNAS ===');
                    console.log('detallesVacunas:', detallesVacunas);
                    console.log('historialVacunasConDetalles:', historialVacunasConDetalles);
                    console.log('Cantidad de detalles guardados:', Object.keys(detallesVacunas).length);
                    console.log('Cantidad en historial:', Object.keys(historialVacunasConDetalles).length);

                    // Mostrar todas las claves disponibles
                    console.log('Claves en detallesVacunas:', Object.keys(detallesVacunas));
                    console.log('Claves en historial:', Object.keys(historialVacunasConDetalles));
                }

                // Función para eliminar fecha específica del historial (mantener igual)
                function eliminarFechaVacuna(button) {
                    if (confirm('¿Está seguro de eliminar esta fecha?')) {
                        const fechaItem = button.parentElement;
                        const fechasScroll = fechaItem.parentElement;
                        const contador = fechasScroll.parentElement.querySelector('.fechas-contador');

                        fechaItem.remove();

                        // Actualizar contador
                        const totalFechas = fechasScroll.children.length;
                        contador.textContent = totalFechas;

                        // Si no quedan fechas, eliminar toda la vacuna
                        if (totalFechas === 0) {
                            const vacunaCompleta = fechasScroll.closest('.historial-item');
                            vacunaCompleta.remove();

                            // Ocultar sección de historial si no hay elementos
                            const container = document.getElementById('historialVacunas');
                            if (container.children.length === 0) {
                                document.getElementById('historialVacunacion').style.display = 'none';
                            }
                        }
                    }
                }

                // Funciones auxiliares
                function obtenerNombreVacuna(vacuna) {
                    const nombres = {
                        'bcg': 'BCG',
                        'hepatitis_b': 'Hepatitis B',
                        'hexavalente': 'Hexavalente',
                        'dpt': 'DPT',
                        'rotavirus': 'Rotavirus',
                        'neumococica': 'Neumocócica conjugada',
                        'influenza': 'Influenza',
                        'srp': 'SRP',
                        'covid19': 'COVID-19'
                    };
                    return nombres[vacuna] || vacuna;
                }

                function obtenerTextoDosis(vacuna, dosis) {
                    if (vacuna === 'influenza' && dosis.startsWith('anual_')) {
                        const año = dosis.replace('anual_', '').replace('_', ' ');
                        return `Dosis Anual - ${año.toUpperCase()}`;
                    }

                    const textos = {
                        'unica': 'Única',
                        'primera': '1era dosis',
                        'segunda': '2da dosis',
                        'tercera': '3ra dosis',
                        'cuarta': '4ta dosis',
                        'refuerzo': 'Refuerzo',
                        'primera_primaria': '1era dosis (Esquema Primario)',
                        'segunda_primaria': '2da dosis (Esquema Primario)',
                        'tercera_primaria': '3ra dosis (Esquema Primario)',
                        'refuerzo_riesgo': 'Refuerzo (Grupo de Riesgo)'
                    };
                    return textos[dosis] || dosis;
                }

                function formatearMolestia(molestia) {
                    const molestias = {
                        'cefalea': 'Cefalea',
                        'fiebre': 'Fiebre',
                        'dolor_sitio': 'Dolor en sitio de aplicación',
                        'malestar_general': 'Malestar general',
                        'escalofrio': 'Escalofrío',
                        'cansancio': 'Cansancio',
                        'inflamacion': 'Inflamación o enrojecimiento',
                        'dolor_muscular': 'Dolor muscular y articular'
                    };
                    return molestias[molestia] || molestia;
                }

                function cerrarModalDetallesHistorial() {
                    const modal = document.getElementById('modalDetallesHistorial');
                    if (modal) {
                        modal.remove();
                    }
                }

                // Eliminar fecha específica del historial
                function eliminarFechaVacuna(button) {
                    if (confirm('¿Está seguro de eliminar esta fecha?')) {
                        const fechaItem = button.parentElement;
                        const fechasScroll = fechaItem.parentElement;
                        const contador = fechasScroll.parentElement.querySelector('.fechas-contador');

                        fechaItem.remove();

                        // Actualizar contador
                        const totalFechas = fechasScroll.children.length;
                        contador.textContent = totalFechas;

                        // Si no quedan fechas, eliminar toda la vacuna
                        if (totalFechas === 0) {
                            const vacunaCompleta = fechasScroll.closest('.historial-item');
                            vacunaCompleta.remove();

                            // Ocultar sección de historial si no hay elementos
                            const container = document.getElementById('historialVacunas');
                            if (container.children.length === 0) {
                                document.getElementById('historialVacunacion').style.display = 'none';
                            }
                        }
                    }
                }

                // JavaScript para el TAB de Prevención de Enfermedades
                document.addEventListener('DOMContentLoaded', function () {

                    // Event listeners para checkboxes de prevención (similar a promoción)
                    const prevencionCheckboxes = document.querySelectorAll('#prevencion .promocion-checkbox');
                    prevencionCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            const parentItem = this.closest('.promocion-item');
                            const dateInput = parentItem.querySelector('.date-input-header');

                            if (this.checked) {
                                parentItem.classList.add('selected');
                                // Opcional: enfocar el campo de fecha cuando se marca el checkbox
                                if (dateInput) {
                                    dateInput.focus();
                                }
                            } else {
                                parentItem.classList.remove('selected');
                                // Limpiar la fecha cuando se desmarca
                                if (dateInput) {
                                    dateInput.value = '';
                                }
                            }
                        });
                    });

                    // Botón limpiar
                    document.getElementById('limpiarPrevencion')?.addEventListener('click', function () {
                        if (confirm('¿Está seguro de que desea limpiar todos los campos del formulario de prevención?')) {
                            limpiarFormularioPrevencion();
                        }
                    });

                    // Botón guardar
                    document.getElementById('guardarPrevencion')?.addEventListener('click', function (e) {
                        e.preventDefault();
                        guardarPrevencionesAlHistorial();
                    });

                    // Botón borrador
                    document.getElementById('guardarBorradorPrev')?.addEventListener('click', function () {
                        alert('Borrador de prevención guardado');
                    });
                });

                // Función para limpiar formulario de prevención
                function limpiarFormularioPrevencion() {
                    // Desmarcar checkboxes y limpiar fechas
                    document.querySelectorAll('#prevencion .promocion-item').forEach(item => {
                        const checkbox = item.querySelector('.promocion-checkbox');
                        const dateInput = item.querySelector('.date-input-header');

                        if (checkbox) checkbox.checked = false;
                        if (dateInput) dateInput.value = '';
                        item.classList.remove('selected');
                    });
                }

                // Función para guardar prevenciones al historial
                function guardarPrevencionesAlHistorial() {
                    let prevencionesSeleccionadas = [];

                    // Obtener prevenciones seleccionadas
                    const prevencionCheckboxes = document.querySelectorAll('#prevencion .promocion-checkbox');
                    prevencionCheckboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            // Buscar el item padre
                            const parentItem = checkbox.closest('.promocion-item');

                            // Obtener el texto del label
                            const labelElement = parentItem.querySelector('.promocion-title');
                            const label = labelElement ? labelElement.textContent : '';

                            // Buscar el input de fecha correspondiente
                            const dateInput = parentItem.querySelector('.date-input-header');
                            const fecha = dateInput ? dateInput.value : '';

                            if (fecha) {
                                prevencionesSeleccionadas.push({
                                    titulo: label,
                                    fecha: fecha
                                });
                            }
                        }
                    });

                    if (prevencionesSeleccionadas.length === 0) {
                        alert('Por favor seleccione al menos una actividad de prevención con su fecha');
                        return;
                    }

                    // Agregar al historial
                    prevencionesSeleccionadas.forEach(prevencion => {
                        agregarAlHistorialPrevencion(prevencion);
                    });

                    // Limpiar formulario después de guardar
                    limpiarFormularioPrevencion();

                    alert(`${prevencionesSeleccionadas.length} actividad(es) de prevención guardada(s) correctamente`);

                    // Mostrar sección de historial
                    document.getElementById('historialPrevencion').style.display = 'block';
                }

                // Función para agregar al historial de prevención (reutiliza la estructura de promoción)
                function agregarAlHistorialPrevencion(prevencion) {
                    const container = document.getElementById('historialPrevenciones');

                    // Buscar si ya existe una actividad con el mismo título
                    const actividadExistente = Array.from(container.children).find(item => {
                        const titulo = item.querySelector('.historial-title').textContent;
                        return titulo === prevencion.titulo;
                    });

                    if (actividadExistente) {
                        // Si existe, agregar la fecha al contenedor de fechas
                        agregarFechaAActividadPrevencion(actividadExistente, prevencion.fecha);
                    } else {
                        // Si no existe, crear nueva actividad
                        crearNuevaActividadHistorialPrevencion(prevencion);
                    }
                }

                // Función para crear nueva actividad en el historial de prevención
                function crearNuevaActividadHistorialPrevencion(prevencion) {
                    const container = document.getElementById('historialPrevenciones');

                    const historialItem = document.createElement('div');
                    historialItem.classList.add('historial-item');
                    historialItem.innerHTML = `
        <div class="historial-content">
            <div class="actividad-info">
                <div class="actividad-titulo">
                    <span class="historial-title">${prevencion.titulo}</span>
                    <span class="fechas-contador">1</span>
                </div>
                <div class="fechas-scroll-compacto">
                    <div class="fecha-item-compacto">${prevencion.fecha}</div>
                </div>
            </div>
        </div>
    `;

                    container.appendChild(historialItem);
                }

                // Función para agregar fecha a una actividad existente de prevención
                function agregarFechaAActividadPrevencion(actividadItem, nuevaFecha) {
                    const fechasScroll = actividadItem.querySelector('.fechas-scroll-compacto');
                    const contador = actividadItem.querySelector('.fechas-contador');

                    // Verificar que la fecha no esté duplicada
                    const fechasExistentes = Array.from(fechasScroll.children).map(item => item.textContent.replace('×', '').trim());
                    if (fechasExistentes.includes(nuevaFecha)) {
                        alert('Esta fecha ya está registrada para esta actividad');
                        return;
                    }

                    // Crear nuevo elemento de fecha
                    const fechaItem = document.createElement('div');
                    fechaItem.classList.add('fecha-item-compacto');
                    fechaItem.innerHTML = `${nuevaFecha}`;

                    fechasScroll.appendChild(fechaItem);

                    // Actualizar contador
                    const totalFechas = fechasScroll.children.length;
                    contador.textContent = totalFechas;

                    // Hacer scroll automático al final
                    fechasScroll.scrollTop = fechasScroll.scrollHeight;
                }

                // Función para eliminar del historial de prevención
                function eliminarDelHistorialPrevencion(button) {
                    if (confirm('¿Está seguro de eliminar esta actividad completa con todas sus fechas?')) {
                        const historialItem = button.closest('.historial-item');
                        historialItem.remove();

                        // Ocultar sección de historial si no hay elementos
                        const container = document.getElementById('historialPrevenciones');
                        if (container.children.length === 0) {
                            document.getElementById('historialPrevencion').style.display = 'none';
                        }
                    }
                }

                document.addEventListener('DOMContentLoaded', function () {
                    // Fecha de nacimiento del paciente (esto debería venir del sistema)
                    // Para la demo, usemos una fecha de ejemplo
                    let fechaNacimientoPaciente = new Date('2018-01-01'); // Ejemplo: niño de 6 años

                    // Contador para IDs únicos de registros de agudeza visual
                    let contadorRegistrosAgudeza = 0;

                    // Función para validar fechas de agudeza visual
                    function validarFechaAgudeza(fecha) {
                        const fechaIngresada = new Date(fecha);
                        const fechaActual = new Date();

                        // No permitir fechas futuras
                        if (fechaIngresada > fechaActual) {
                            return { valida: false, mensaje: 'No se permite registrar una fecha mayor a la actual' };
                        }

                        // No permitir fechas menores a la fecha de nacimiento
                        if (fechaIngresada < fechaNacimientoPaciente) {
                            return { valida: false, mensaje: 'No se permite registrar una fecha menor a la fecha de nacimiento del paciente' };
                        }

                        return { valida: true, mensaje: '' };
                    }

                    // Función para formatear fecha a dd/mm/aaaa
                    function formatearFecha(fecha) {
                        const date = new Date(fecha);
                        const dia = String(date.getDate()).padStart(2, '0');
                        const mes = String(date.getMonth() + 1).padStart(2, '0');
                        const año = date.getFullYear();
                        return `${dia}/${mes}/${año}`;
                    }

                    // Función para crear un nuevo registro de agudeza visual
                    function crearRegistroAgudeza() {
                        contadorRegistrosAgudeza++;
                        const registroId = `registro_agudeza_${contadorRegistrosAgudeza}`;

                        const registroDiv = document.createElement('div');
                        registroDiv.className = 'registro-agudeza';
                        registroDiv.id = registroId;

                        registroDiv.innerHTML = `
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha de detección:</label>
                            <input type="date" name="fecha_agudeza_visual[]" class="form-input fecha-agudeza" 
                                   data-registro="${registroId}" required>
                            <small class="error-message" style="color: #e74c3c; font-size: 12px; display: none;"></small>
                        </div>

                    <div class="radio-group">
                                                    <div class="radio-item ">
                                                        <input type="radio" id="normal" name="tipovisual"
                                                            value="normal" class="radio-input" required>
                                                        <label for="normal" class="radio-label">Normal</label>
                                                    </div>
                                                
                                                    <div class="radio-item">
                                                        <input type="radio" id="anormal" name="tipovisual"
                                                            value="anormal" class="radio-input" required>
                                                        <label for="anormal" class="radio-label">Anormal</label>
                                                    </div>
                                                </div>
                `;

                        return registroDiv;
                    }

                    // Función para eliminar un registro de agudeza visual
                    window.eliminarRegistroAgudeza = function (registroId) {
                        const registro = document.getElementById(registroId);
                        if (registro) {
                            registro.remove();
                        }

                        // Si no quedan registros, ocultar la sección
                        const registrosContainer = document.getElementById('registros_agudeza');
                        if (registrosContainer.children.length === 0) {
                            const checkbox = document.getElementById('agudeza_visual');
                            checkbox.checked = false;
                            toggleTamizDetails(checkbox);
                        }
                    };

                    // Event listener para agregar registros de agudeza visual (removido el botón)
                    // Función para mostrar/ocultar detalles cuando se marca/desmarca un checkbox
                    function toggleTamizDetails(checkbox) {
                        const detailsId = 'details_' + checkbox.id;
                        const detailsDiv = document.getElementById(detailsId);

                        if (detailsDiv) {
                            if (checkbox.checked) {
                                detailsDiv.classList.add('active');

                                // Si es agudeza visual y no hay registros, crear el primero automáticamente
                                if (checkbox.id === 'agudeza_visual') {
                                    const registrosContainer = document.getElementById('registros_agudeza');
                                    if (registrosContainer.children.length === 0) {
                                        const nuevoRegistro = crearRegistroAgudeza();
                                        registrosContainer.appendChild(nuevoRegistro);

                                        // Agregar validación a la nueva fecha
                                        const fechaInput = nuevoRegistro.querySelector('.fecha-agudeza');
                                        fechaInput.addEventListener('change', function () {
                                            const validacion = validarFechaAgudeza(this.value);
                                            const errorMessage = this.parentNode.querySelector('.error-message');

                                            if (!validacion.valida) {
                                                this.style.borderColor = '#e74c3c';
                                                errorMessage.textContent = validacion.mensaje;
                                                errorMessage.style.display = 'block';
                                                this.value = ''; // Limpiar el campo
                                            } else {
                                                this.style.borderColor = '#27ae60';
                                                errorMessage.style.display = 'none';
                                            }
                                        });
                                    }
                                }
                            } else {
                                detailsDiv.classList.remove('active');
                                // Limpiar los campos cuando se desmarca
                                if (checkbox.id === 'agudeza_visual') {
                                    // Limpiar todos los registros de agudeza visual
                                    const registrosContainer = document.getElementById('registros_agudeza');
                                    registrosContainer.innerHTML = '';
                                    contadorRegistrosAgudeza = 0;
                                } else {
                                    const inputs = detailsDiv.querySelectorAll('input, textarea');
                                    inputs.forEach(input => input.value = '');
                                }
                            }
                        }
                    }

                    // Agregar event listeners a todos los checkboxes de tamizajes
                    const tamizCheckboxes = document.querySelectorAll('.tamiz-checkbox');
                    tamizCheckboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function () {
                            toggleTamizDetails(this);
                        });
                    });

                    // Funcionalidad del botón limpiar
                    document.getElementById('limpiarDeteccion').addEventListener('click', function () {
                        const form = document.getElementById('deteccionForm');
                        form.reset();

                        // Ocultar todos los detalles
                        const allDetails = document.querySelectorAll('.tamiz-details');
                        allDetails.forEach(detail => {
                            detail.classList.remove('active');
                        });
                    });

                    // Funcionalidad del botón guardar borrador
                    document.getElementById('guardarBorradorDet').addEventListener('click', function () {
                        const formData = new FormData(document.getElementById('deteccionForm'));
                        const data = {};

                        // Recopilar datos del formulario
                        for (let [key, value] of formData.entries()) {
                            if (data[key]) {
                                if (Array.isArray(data[key])) {
                                    data[key].push(value);
                                } else {
                                    data[key] = [data[key], value];
                                }
                            } else {
                                data[key] = value;
                            }
                        }

                        console.log('Guardando borrador:', data);

                        // Aquí podrías guardar en localStorage o enviar al servidor
                        localStorage.setItem('deteccionBorrador', JSON.stringify(data));

                        alert('Borrador guardado exitosamente');
                    });

                    // Funcionalidad del botón guardar
                    document.getElementById('guardarDeteccion').addEventListener('click', function (e) {
                        e.preventDefault();

                        const form = document.getElementById('deteccionForm');
                        const formData = new FormData(form);
                        const data = {};

                        // Validar que al menos una enfermedad esté seleccionada
                        const checkboxes = form.querySelectorAll('.tamiz-checkbox:checked');
                        if (checkboxes.length === 0) {
                            alert('Por favor, seleccione al menos una enfermedad para detectar.');
                            return;
                        }

                        // Validación especial para agudeza visual
                        const agudezaVisualChecked = document.getElementById('agudeza_visual').checked;
                        if (agudezaVisualChecked) {
                            const registrosAgudeza = document.querySelectorAll('#registros_agudeza .registro-agudeza');
                            let validacionAgudezaOk = true;

                            registrosAgudeza.forEach(registro => {
                                const fechaInput = registro.querySelector('.fecha-agudeza');
                                const resultadoSelect = registro.querySelector('.resultado-select');

                                if (!fechaInput.value || !resultadoSelect.value) {
                                    alert('Por favor, complete todos los campos de los registros de agudeza visual.');
                                    validacionAgudezaOk = false;
                                    return;
                                }

                                const validacion = validarFechaAgudeza(fechaInput.value);
                                if (!validacion.valida) {
                                    alert(`Error en fecha de agudeza visual: ${validacion.mensaje}`);
                                    validacionAgudezaOk = false;
                                    return;
                                }
                            });

                            if (!validacionAgudezaOk) return;
                        }

                        // Validar que las otras enfermedades seleccionadas tengan fecha
                        let validationError = false;
                        checkboxes.forEach(checkbox => {
                            if (checkbox.id !== 'agudeza_visual') {
                                const fechaInput = form.querySelector(`#fecha_${checkbox.id}`);
                                if (fechaInput && !fechaInput.value) {
                                    alert(`Por favor, ingrese la fecha de detección para: ${checkbox.nextElementSibling.textContent}`);
                                    validationError = true;
                                    return;
                                }
                            }
                        });

                        if (validationError) return;

                        // Recopilar datos del formulario
                        for (let [key, value] of formData.entries()) {
                            if (data[key]) {
                                if (Array.isArray(data[key])) {
                                    data[key].push(value);
                                } else {
                                    data[key] = [data[key], value];
                                }
                            } else {
                                data[key] = value;
                            }
                        }

                        console.log('Guardando detección:', data);

                        // Aquí podrías enviar los datos al servidor
                        // fetch('/api/guardar-deteccion', { method: 'POST', body: JSON.stringify(data) })

                        alert('Detección de enfermedades guardada exitosamente');

                        // Mostrar historial (esto sería dinámico en una aplicación real)
                        mostrarHistorial(data);

                        // Limpiar borrador guardado
                        localStorage.removeItem('deteccionBorrador');
                    });

                    // Función para mostrar el historial
                    function mostrarHistorial(data) {
                        const historialDiv = document.getElementById('historialDeteccion');
                        const historialContainer = document.getElementById('historialDetecciones');

                        const fecha = new Date().toLocaleDateString();
                        const enfermedades = data.enfermedades || [];

                        if (enfermedades.length > 0) {
                            const historialItem = document.createElement('div');
                            historialItem.style.cssText = `
                        background: #f8f9fa;
                        border: 1px solid #dee2e6;
                        border-radius: 8px;
                        padding: 15px;
                        margin-bottom: 10px;
                    `;

                            historialItem.innerHTML = `
                        <h4 style="margin: 0 0 10px 0; color: #495057;">Registro del ${fecha}</h4>
                        <p><strong>Enfermedades detectadas:</strong> ${enfermedades.join(', ')}</p>
                    `;

                            historialContainer.appendChild(historialItem);
                            historialDiv.style.display = 'block';
                        }
                    }
                });
   
                document.addEventListener('DOMContentLoaded', function () {
                    // Definir los motivos para cada tipo de derivación
                    const motivosPorTipo = {
                        '4.30.200': [
                            'Atresia de Vías Biliares',
                            'Evaluación drrollo Infantil sospecha de alteración grave del desarrollo',
                            'Falta de realización de tamiz auditivo del niño sano',
                            'Falta de realización de tamiz de cadera',
                            'Falta de realización de tamiz oftalmológico del niño sano',
                            'Tamiz auditivo No pasa',
                            'Tamiz Metabólico Neonatal caso probable'
                        ],
                        '4.30.8': [
                            'Evaluación de Desarrollo Infantil sospecha alteración leve desarrollo',
                            'Falta de toma de tamiz metabólico',
                            'Falta de realización de tamiz auditivo'
                        ]
                    };

                    // Referencias a elementos del DOM
                    const tipoDerivacionSelect = document.getElementById('tipoDerivacion');
                    const motivoDerivacionSelect = document.getElementById('motivoDerivacion');
                    const especialistaSelect = document.getElementById('especialista');
                    const form = document.getElementById('derivacionForm');
                    const alertContainer = document.getElementById('alertContainer');

                    // Función para mostrar alertas
                    function mostrarAlerta(mensaje, tipo = 'success') {
                        const alertClass = tipo === 'success' ? 'alert-success' : 'alert-error';
                        alertContainer.innerHTML = `
            <div class="alert alert-info" style="margin-bottom: 20px; padding: 15px; border-radius: 8px; ${tipo === 'success' ? 'background: #d4edda; color: #155724; border: 1px solid #c3e6cb;' : 'background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;'}">
                <span style="margin-right: 10px;">${tipo === 'success' ? '✅' : '❌'}</span>
                ${mensaje}
            </div>
        `;

                        // Hacer scroll hacia la alerta
                        alertContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                        // Ocultar alerta después de 5 segundos
                        setTimeout(() => {
                            alertContainer.innerHTML = '';
                        }, 5000);
                    }

                    // Manejar cambio en tipo de derivación
                    if (tipoDerivacionSelect) {
                        tipoDerivacionSelect.addEventListener('change', function () {
                            const tipoSeleccionado = this.value;

                            // Limpiar motivos anteriores
                            motivoDerivacionSelect.innerHTML = '<option value="">-- Seleccione un motivo --</option>';

                            if (tipoSeleccionado && motivosPorTipo[tipoSeleccionado]) {
                                // Habilitar el select de motivos
                                motivoDerivacionSelect.disabled = false;

                                // Agregar motivos correspondientes
                                motivosPorTipo[tipoSeleccionado].forEach(motivo => {
                                    const option = document.createElement('option');
                                    option.value = motivo.toLowerCase().replace(/\s+/g, '_').replace(/[^\w_]/g, '');
                                    option.textContent = motivo;
                                    motivoDerivacionSelect.appendChild(option);
                                });
                            } else {
                                // Deshabilitar el select de motivos
                                motivoDerivacionSelect.disabled = true;
                                motivoDerivacionSelect.innerHTML = '<option value="">-- Primero seleccione el tipo de derivación --</option>';
                            }

                            // Limpiar selección de motivo al cambiar tipo
                            motivoDerivacionSelect.value = '';
                        });
                    }

                    // Botón limpiar derivación
                    const limpiarBtn = document.getElementById('limpiarDerivacion');
                    if (limpiarBtn) {
                        limpiarBtn.addEventListener('click', function (e) {
                            e.preventDefault();
                            if (confirm('¿Está seguro de que desea limpiar el formulario?')) {
                                form.reset();
                                motivoDerivacionSelect.disabled = true;
                                motivoDerivacionSelect.innerHTML = '<option value="">-- Primero seleccione el tipo de derivación --</option>';
                                alertContainer.innerHTML = '';
                                mostrarAlerta('Formulario limpiado correctamente', 'success');
                            }
                        });
                    }

                    // Botón guardar borrador
                    const borradorBtn = document.getElementById('guardarBorradorDer');
                    if (borradorBtn) {
                        borradorBtn.addEventListener('click', function (e) {
                            e.preventDefault();

                            const formData = new FormData(form);
                            const derivacionData = {};

                            for (let [key, value] of formData.entries()) {
                                derivacionData[key] = value;
                            }

                            // Guardar en localStorage como borrador
                            localStorage.setItem('derivacionBorrador', JSON.stringify(derivacionData));
                            console.log('Borrador guardado:', derivacionData);
                            mostrarAlerta('Borrador guardado correctamente', 'success');
                        });
                    }

                    // Botón guardar derivación - CORREGIDO
                    const guardarBtn = document.getElementById('guardarDerivacion');
                    if (guardarBtn) {
                        guardarBtn.addEventListener('click', function (e) {
                            e.preventDefault(); // IMPORTANTE: Prevenir el comportamiento por defecto del formulario

                            // Validar campos requeridos
                            const tipoDerivacion = tipoDerivacionSelect.value;
                            const motivoDerivacion = motivoDerivacionSelect.value;
                            const especialista = especialistaSelect.value;

                            if (!tipoDerivacion) {
                                mostrarAlerta('Por favor, seleccione el tipo de derivación.', 'error');
                                tipoDerivacionSelect.focus();
                                return;
                            }

                            if (!motivoDerivacion) {
                                mostrarAlerta('Por favor, seleccione el motivo de derivación.', 'error');
                                motivoDerivacionSelect.focus();
                                return;
                            }

                            if (!especialista) {
                                mostrarAlerta('Por favor, seleccione el especialista.', 'error');
                                especialistaSelect.focus();
                                return;
                            }

                            // Recopilar datos del formulario
                            const formData = new FormData(form);
                            const derivacionData = {};

                            for (let [key, value] of formData.entries()) {
                                derivacionData[key] = value;
                            }

                            // Agregar texto del motivo seleccionado para mejor legibilidad
                            const motivoTexto = motivoDerivacionSelect.options[motivoDerivacionSelect.selectedIndex].text;
                            derivacionData.motivoTexto = motivoTexto;

                            // Agregar texto del tipo de derivación
                            const tipoTexto = tipoDerivacionSelect.options[tipoDerivacionSelect.selectedIndex].text;
                            derivacionData.tipoTexto = tipoTexto;

                            // Agregar texto del especialista seleccionado
                            const especialistaTexto = especialistaSelect.options[especialistaSelect.selectedIndex].text;
                            derivacionData.especialistaTexto = especialistaTexto;

                            // Agregar fecha de registro (hoy)
                            derivacionData.fechaRegistro = new Date().toLocaleDateString('es-ES');

                            // Simular envío exitoso
                            console.log('Datos de derivación guardados:', derivacionData);

                            // Mostrar mensaje de éxito
                            mostrarAlerta('✅ Derivación registrada exitosamente. Los datos han sido guardados correctamente.');

                            // Agregar al historial
                            agregarDerivacionAlHistorial(derivacionData);

                            // Mostrar historial
                            document.getElementById('historialDerivaciones').style.display = 'block';

                            // Limpiar borrador guardado
                            localStorage.removeItem('derivacionBorrador');

                            // Opcional: Limpiar formulario después de guardar
                            // form.reset();
                            // motivoDerivacionSelect.disabled = true;
                        });
                    }

                    // También prevenir el envío tradicional del formulario
                    if (form) {
                        form.addEventListener('submit', function (e) {
                            e.preventDefault(); // Prevenir envío tradicional
                            // El manejo se hace en el botón guardar
                        });
                    }

                    // Función para agregar al historial
                    function agregarDerivacionAlHistorial(datos) {
                        const container = document.getElementById('historialDerivacionesContainer');

                        if (!container) {
                            console.error('Container del historial no encontrado');
                            return;
                        }

                        const historialItem = document.createElement('div');
                        historialItem.classList.add('historial-item');
                        historialItem.style.cssText = `
            background: white;
            border: 2px solid #3498db;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.1);
            transition: all 0.3s ease;
        `;

                        historialItem.innerHTML = `
            <div class="historial-content">
                <div class="historial-title" style="font-weight: 600; color: #2c3e50; font-size: 16px; margin-bottom: 12px;">
                    📄 Derivación - ${datos.tipoTexto}
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 15px;">
                    <div><strong>Motivo:</strong> ${datos.motivoTexto}</div>
                    <div><strong>Especialista:</strong> ${datos.especialistaTexto}</div>
                    <div><strong>Fecha:</strong> ${datos.fechaRegistro}</div>
                </div>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border-left: 3px solid #3498db;">
                    <small style="color: #6c757d;">Derivación registrada exitosamente</small>
                </div>
            </div>
        `;

                        // Agregar efecto hover
                        historialItem.addEventListener('mouseenter', function () {
                            this.style.transform = 'translateY(-2px)';
                            this.style.boxShadow = '0 4px 15px rgba(52, 152, 219, 0.2)';
                        });

                        historialItem.addEventListener('mouseleave', function () {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = '0 2px 8px rgba(52, 152, 219, 0.1)';
                        });

                        container.appendChild(historialItem);

                        // Hacer scroll al nuevo elemento
                        historialItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }

                    // Cargar borrador si existe
                    const borradorGuardado = localStorage.getItem('derivacionBorrador');
                    if (borradorGuardado) {
                        try {
                            const datos = JSON.parse(borradorGuardado);

                            // Mostrar opción de cargar borrador
                            mostrarAlerta('Se encontró un borrador guardado. Los datos han sido restaurados.', 'success');

                            // Cargar datos del borrador
                            Object.keys(datos).forEach(key => {
                                const elemento = document.getElementById(key);
                                if (elemento) {
                                    elemento.value = datos[key];
                                    // Disparar evento change para actualizar dependencias
                                    elemento.dispatchEvent(new Event('change'));
                                }
                            });
                        } catch (e) {
                            console.error('Error al cargar borrador:', e);
                            localStorage.removeItem('derivacionBorrador');
                        }
                    }
                });

                // API pública para integración externa
                window.derivacionesAPI = {
                    obtenerDatos: function () {
                        const form = document.getElementById('derivacionForm');
                        const formData = new FormData(form);
                        const datos = {};
                        for (let [key, value] of formData.entries()) {
                            datos[key] = value;
                        }
                        return datos;
                    },

                    limpiarFormulario: function () {
                        const limpiarBtn = document.getElementById('limpiarDerivacion');
                        if (limpiarBtn) {
                            limpiarBtn.click();
                        }
                    },

                    cargarDatos: function (datos) {
                        Object.keys(datos).forEach(key => {
                            const elemento = document.getElementById(key);
                            if (elemento) {
                                elemento.value = datos[key];
                                elemento.dispatchEvent(new Event('change'));
                            }
                        });
                    }
                };
            </script>
</body>

</html>